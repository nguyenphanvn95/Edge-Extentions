import{T as d,a as f,b as g}from"./const-Bl3AZojp.js";import{L as v,H as x,I as b,J as w,K as k,N as E,O as L,P as M,Q as C,R as I}from"./utils-CBRNvm1S.js";import{l as H,I as T}from"./lodash-D3Y-mkk_.js";let a=!1,r=!1,u=0,l=!1,m=0,y=0,e=null,n=null;const c=480;function $(){if(e)e.style.display="block",i();else{const t=chrome.runtime.getURL("src/app/index.html");e=document.createElement("iframe"),e.id=f,e.src=t,e.title="Notion Exporter",e.style.display="block",e.style.width=`${c}px`,e.style.height="100%",e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.borderLeft="1px solid #e2e8f0",e.style.borderTop="0",e.style.borderBottom="0",e.style.borderRight="0",e.style.backgroundColor="white",e.style.zIndex="999999",e.style.overflowX="hidden",e.allow="clipboard-write;",document.body.append(e)}n?n.style.display="block":(n=document.createElement("div"),n.id=g,n.style.position="fixed",n.style.top="0",n.style.right=`${c}px`,n.style.width="4px",n.style.height="100%",n.style.backgroundColor="transparent",n.style.cursor="ew-resize",n.style.zIndex="1000000",document.body.append(n),n.addEventListener("mousedown",t=>B(t)),n.addEventListener("mouseenter",O),n.addEventListener("mouseleave",R))}function p(t){if(!e||!n||!l)return;const o=m-t.clientX,s=Math.max(c,y+o);e.style.width=`${s}px`,n.style.right=`${s}px`}function B(t){e&&(l=!0,m=t.clientX,y=parseInt(e.style.width),e.style.pointerEvents="none",document.addEventListener("mousemove",p),document.addEventListener("mouseup",h),t.preventDefault())}function h(){e&&(l=!1,e.style.pointerEvents="auto",document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",h))}function O(){n&&(n.style.backgroundColor="rgba(0, 0, 0, 0.1)")}function R(){n&&(n.style.backgroundColor="transparent")}function z(){e&&(e.style.display="none"),n&&(n.style.display="none")}async function K(){return await chrome.runtime.sendMessage({action:L})===T.sidePanel}function N(){a?chrome.runtime.sendMessage({action:M}):chrome.runtime.sendMessage({action:C})}function P(){const t=document.querySelector(".notion-topbar-action-buttons");if(t){const o=document.createElement("div");o.id=d,o.role="button",o.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="notion-exporter-icon">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" x2="12" y1="3" y2="15"/>
            </svg>
        `,o.style.padding="4px 8px",o.style.margin="0px 2px",o.style.cursor="pointer",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.addEventListener("click",N),t.appendChild(o);const s=document.createElement("style");return s.textContent=`
            @media (prefers-color-scheme: dark) {
                .notion-exporter-icon {
                    stroke: white;
                }
            }
            @media (prefers-color-scheme: light) {
                .notion-exporter-icon {
                    stroke: black;
                }
            }
        `,document.head.appendChild(s),!0}else return!1}function i(){chrome.runtime.sendMessage({action:I,html:document.body.outerHTML,url:window.location.href,isIframe:r})}const S=H.debounce((t,o)=>{if(document.getElementById(d)){o.disconnect();return}try{P()&&o.disconnect()}catch{}u>1e4&&o.disconnect(),u++},100);async function X(){new MutationObserver((t,o)=>{S(t,o)}).observe(document.body,{childList:!0,subtree:!0}),chrome.runtime.onMessage.addListener(t=>{v(`[Content] message: ${t.action}`),t.action===x&&(r=!0,$()),t.action===b&&(r=!1,z()),t.action===w&&i(),t.action===k&&i()}),document.addEventListener("keydown",t=>{let o=E();t.ctrlKey&&t.key==="s"&&(o==="Windows"||o==="Linux")&&i(),t.metaKey&&t.key==="s"&&o==="MacOS"&&i()}),a=await K()}X();
