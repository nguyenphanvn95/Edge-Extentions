var k=Object.defineProperty;var Q=(a,e,t)=>e in a?k(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>(Q(a,typeof e!="symbol"?e+"":e,t),t);import{L as I,aq as $,H as T,X as A,ar as J,aj as R,P as V,Q as q,c as G,I as W,e as X,J as K,R as _,d as E,ah as H,ao as z,ap as B,K as v,$ as F,s as P,af as U,m as Y,n as Z,o as aa,p as ta,q as ea,r as na,k as sa,l as oa,ag as ra,y as ia,x as ca,B as ua,C as da,A as ha,a0 as la,M as fa,b as ma,D as pa,as as wa,G as ya,at as ba,h as ga,f as Ia,au as Ta,av as Ea,O as va,j as Pa,i as Sa,a as Ma,ak as ja,T as Da,E as Ca}from"./utils-CBRNvm1S.js";import{bK as S,bL as M,bM as La,bN as j,bO as D,bx as Na,bP as Oa,T as xa,bv as ka,bQ as Qa,bR as $a,x as C,O as Aa,bS as Ja,N as Ra,bT as Va,bU as qa,K as m,bV as Ga,bW as Wa,J as Xa,bX as Ka}from"./config-Br0JWhEe.js";import{A as l,N as _a}from"./const-Bl3AZojp.js";import{n as Ha,o as za,p as Ba,q as Fa,a as Ua,r as Ya,c as Za,t as at,u as tt,v as et,d as nt,e as st,h as ot,j as rt,l as it,w as ct,x as ut,y as dt,z as ht}from"./config-Hi3Bg2Cg.js";var L=(a=>(a[a.INVALID_LICENSE=2001]="INVALID_LICENSE",a[a.LICENSE_EXPIRED=2002]="LICENSE_EXPIRED",a[a.DEVICE_LIMIT=2003]="DEVICE_LIMIT",a))(L||{});async function lt(a,e){return null}async function ft(a){return!0}async function mt(a,e){return!0}async function N(){return!0}async function pt(a){return a}async function wt(a,e,t,s,r){return!0}const d=class d{constructor(){h(this,"downloadQueue",[]);h(this,"isProcessing",!1);h(this,"maxConcurrent",3)}static getInstance(){return d.instance||(d.instance=new d),d.instance}async addToQueue(e){return new Promise((t,s)=>{this.downloadQueue.push({url:e,resolve:t,reject:s}),this.processQueue()})}isInQueue(e){return this.downloadQueue.some(t=>t.url===e)}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.downloadQueue.length>0;){const e=this.downloadQueue.splice(0,this.maxConcurrent);await Promise.all(e.map(t=>this.download(t)))}this.isProcessing=!1}}async download(e){try{const t=await this.downloadImage(e.url);e.resolve(t)}catch(t){e.reject(t)}}async downloadImage(e){try{const t=await S(e);if(t)return t;const s=await fetch(e);if(I(`[IMAGE_DOWNLOADER] Fetch Image: ${e}`),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.blob(),i=await $(r);return{url:e,data:i,date:new Date}}catch(t){throw console.error(`Error downloading image from ${e}:`,t),t}}};h(d,"instance");let p=d;const yt=p.getInstance(),O=chrome.runtime.getManifest().version;let u=null;chrome.action.onClicked.addListener(async a=>{var e;(e=a.url)!=null&&e.startsWith(_a)&&a.id?(u=a.id,chrome.tabs.sendMessage(a.id,{action:T})):(chrome.action.setPopup({popup:"src/popup/index.html"}),chrome.action.openPopup(),setTimeout(()=>{chrome.action.setPopup({popup:""})},100))}),chrome.runtime.onInstalled.addListener(async()=>{if(!await M()){const a=A();await La(a)}}),chrome.runtime.onMessage.addListener((a,e,t)=>{var s,r,i,f,w,y,b,g;if(I(`[MESSAGE] ${a.action}`),a.action===J)return bt(a.html,a.url).then(()=>{t({ok:!0})}),!0;if(a.action===R)return gt().then(n=>{t({text:n})}),!0;if(a.action===V&&((s=e.tab)!=null&&s.id)&&(u=(r=e.tab)==null?void 0:r.id,chrome.sidePanel.open({tabId:u})),a.action===q&&((i=e.tab)!=null&&i.id)&&(u=(f=e.tab)==null?void 0:f.id,chrome.tabs.sendMessage(u,{action:T})),a.action===G&&((w=e.tab)!=null&&w.id)&&chrome.tabs.sendMessage(e.tab.id,{action:W}),a.action===X&&u&&chrome.tabs.sendMessage(u,{action:K}),a.action===_&&((y=e.tab)!=null&&y.id)&&(j(a.url),D({url:a.url,html:a.html,date:new Date}),a.isIframe?chrome.tabs.sendMessage(e.tab.id,{action:E,html:a.html,tabId:(b=e.tab)==null?void 0:b.id,isIframe:a.isIframe}):chrome.runtime.sendMessage({action:E,html:a.html,tabId:(g=e.tab)==null?void 0:g.id,isIframe:a.isIframe})),a.action===H)return c().then(n=>{n?Na().then(o=>{t(o)}):t([])}),!0;if(a.action===z)return Ha(a.data).then(()=>{t({ok:!0})}),!0;if(a.action===B)return za(a.data).then(()=>{t({ok:!0})}),!0;if(a.action===v&&chrome.tabs.sendMessage(a.tabId,{action:v}),a.action===F&&Oa(a.medias).then(()=>{chrome.runtime.sendMessage({action:P})}),a.action===U)return c().then(n=>{n?xa().then(o=>{t(o)}):t([])}),!0;if(a.action===Y)return Ba().then(n=>{t(n)}),!0;if(a.action===Z&&Fa(a.data),a.action===aa)return Ua().then(n=>{t(n)}),!0;if(a.action===ta&&Ya(a.data),a.action===ea)return Za().then(n=>{t(n)}),!0;if(a.action===na&&at(a.data),a.action===sa)return tt().then(n=>{t(n)}),!0;if(a.action===oa&&et(a.data),a.action===ra)return c().then(n=>{n?ka().then(o=>{t(o)}):t([])}),!0;if(a.action===ia)return c().then(n=>{n?nt().then(o=>{t(o)}):t([])}),!0;if(a.action===ca)return c().then(n=>{n?st().then(o=>{t(o)}):t([])}),!0;if(a.action===ua)return c().then(n=>{n?ot().then(o=>{t(o)}):t([])}),!0;if(a.action===da)return c().then(n=>{n?rt().then(o=>{t(o)}):t([])}),!0;if(a.action===ha)return c().then(n=>{n?it().then(o=>{t(o)}):t([])}),!0;if(a.action===la)return Qa(a.data.medias,a.data.index).then(n=>{chrome.runtime.sendMessage({action:P}),t(n)}),!0;if(a.action===fa)return It().then(n=>{t(n)}),!0;if(a.action===ma&&$a(O),a.action===pa)return C().then(n=>{t(n)}),!0;if(a.action===wa&&Aa(a.data),a.action===ya)return c().then(n=>{t(n)}),!0;if(a.action===ba)return vt(a.url).then(n=>{t(n)}),!0;if(a.action===ga&&ct(a.data),a.action===Ia)return ut().then(n=>{t(n)}),!0;if(a.action===Ta&&Ja(a.data),a.action===Ea)return S(a.url).then(n=>{t(n)}),!0;if(a.action===va)return Ra().then(n=>{t(n)}),!0;if(a.action===Pa&&dt(a.data),a.action===Sa)return ht().then(n=>{t(n)}),!0;if(a.action===Ma&&Et(a.activityType,a.activityDetails),a.action===ja)return Va(a.id).then(n=>{t(n)}),!0});async function bt(a,e){await j(e),await D({url:e,html:a,date:new Date})}async function gt(){const a=await chrome.tabs.query({active:!0,currentWindow:!0});return a.length===0||!a[0].id?null:(await chrome.scripting.executeScript({target:{tabId:a[0].id},func:()=>{var e;return(e=window.getSelection())==null?void 0:e.toString()}}))[0].result}async function It(){const a=await qa();return!(a&&a===O)}async function Tt(){}function x(a){return!0}async function c(){return!0}async function Et(a,e){}async function vt(a){try{return await yt.addToQueue(a)}catch{return null}}async function Pt(){Tt(),Ga()}Pt();export{L,lt as a,N as c,mt as f,x as i,ft as r};
