var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,a,i,n){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof s[i]&&s[i],l=o.cache||{},u="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,r){if(!l[e]){if(!t[e]){var a="function"==typeof s[i]&&s[i];if(!r&&a)return a(e,!0);if(o)return o(e,!0);if(u&&"string"==typeof e)return u(e);var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}h.resolve=function(r){var a=t[e][1][r];return null!=a?a:r},h.cache={};var d=l[e]=new c.Module(e);t[e][0].call(d.exports,h,d,d.exports,this)}return l[e].exports;function h(e){var t=h.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=o,c.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return s[i]}}),s[i]=c;for(var d=0;d<r.length;d++)c(r[d]);if(a){var h=c(a);"object"==typeof exports&&"undefined"!=typeof module?module.exports=h:"function"==typeof e&&e.amd&&e(function(){return h})}}({dlll3:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"FewShotPromptTemplate",()=>l),a.export(r,"FewShotChatMessagePromptTemplate",()=>u);var i=e("./string.js"),n=e("./template.js"),s=e("./prompt.js"),o=e("./chat.js");class l extends i.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new l({...this,inputVariables:t,partialVariables:r})}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(e=>this.examplePrompt.format(e))),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,n.renderTemplate)(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t;let{example_prompt:r}=e;if(!r)throw Error("Missing example prompt");let a=await (0,s.PromptTemplate).deserialize(r);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new l({inputVariables:e.input_variables,examplePrompt:a,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class u extends o.BaseChatPromptTemplate{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(e=>{let t={};return this.examplePrompt.inputVariables.forEach(r=>{t[r]=e[r]}),t});let a=[];for(let e of r){let t=await this.examplePrompt.formatMessages(e);a.push(...t)}return a}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(e=>this.examplePrompt.formatMessages(e)))).flat().map(e=>e.content),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,n.renderTemplate)(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new u({...this,inputVariables:t,partialVariables:r})}}},{"./string.js":"GINku","./template.js":"2ZN2o","./prompt.js":"2Oph6","./chat.js":"e9TQ6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],GINku:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseStringPromptTemplate",()=>s);var i=e("../prompt_values.js"),n=e("./base.js");class s extends n.BasePromptTemplate{async formatPromptValue(e){let t=await this.format(e);return new i.StringPromptValue(t)}}},{"../prompt_values.js":"lGT4D","./base.js":"579yP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lGT4D:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptValue",()=>s),a.export(r,"StringPromptValue",()=>o),a.export(r,"ChatPromptValue",()=>l);var i=e("./load/serializable.js"),n=e("./messages/index.js");class s extends i.Serializable{}class o extends s{constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.HumanMessage(this.value)]}}class l extends s{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.getBufferString)(this.messages)}toChatMessages(){return this.messages}}},{"./load/serializable.js":"ihLrn","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ihLrn:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"get_lc_unique_name",()=>s),a.export(r,"Serializable",()=>o);var i=e("./map_keys.js");function n(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[i,...n]=e.split(".").reverse();for(let e of n.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}i in t&&void 0!==t[i]&&(a[i]=a[i]||t[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:(0,i.mapKeys)(Object.keys(t).length?function(e,t){let r=n(e);for(let[e,a]of Object.entries(t)){let[t,...i]=e.split(".").reverse(),s=r;for(let e of i.reverse()){if(void 0===s[e])break;s[e]=n(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,i.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},{"./map_keys.js":"icngQ","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],icngQ:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"keyToJson",()=>l),a.export(r,"keyFromJson",()=>u),a.export(r,"mapKeys",()=>c);var i=e("decamelize"),n=a.interopDefault(i),s=e("camelcase"),o=a.interopDefault(s);function l(e,t){return t?.[e]||(0,n.default)(e)}function u(e,t){return t?.[e]||(0,o.default)(e)}function c(e,t,r){let a={};for(let i in e)Object.hasOwn(e,i)&&(a[t(i,r)]=e[i]);return a}},{decamelize:"ilxwq",camelcase:"9qpt6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ilxwq:[function(e,t,r){t.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},{}],"9qpt6":[function(e,t,r){let a=/[\p{Lu}]/u,i=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,s=/([\p{Alpha}\p{N}_]|$)/u,o=/[_.\- ]+/,l=RegExp("^"+o.source),u=RegExp(o.source+s.source,"gu"),c=RegExp("\\d+"+s.source,"gu"),d=(e,t,r)=>{let n=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];n&&a.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,o=s,s=!0,l++):s&&o&&i.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,n=!0):(n=t(u)===u&&r(u)!==u,o=s,s=r(u)===u&&t(u)!==u)}return e},h=(e,t)=>(n.lastIndex=0,e.replace(n,e=>t(e))),p=(e,t)=>(u.lastIndex=0,c.lastIndex=0,e.replace(u,(e,r)=>t(r)).replace(c,e=>t(e))),m=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?a(e):r(e):(e!==r(e)&&(e=d(e,r,a)),e=e.replace(l,""),e=t.preserveConsecutiveUppercase?h(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),p(e,a))};t.exports=m,t.exports.default=m},{}],"2SNmR":[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],jMGwo:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseMessage",()=>s),a.export(r,"BaseMessageChunk",()=>l),a.export(r,"HumanMessage",()=>u),a.export(r,"HumanMessageChunk",()=>c),a.export(r,"AIMessage",()=>d),a.export(r,"AIMessageChunk",()=>h),a.export(r,"SystemMessage",()=>p),a.export(r,"SystemMessageChunk",()=>m),a.export(r,"FunctionMessage",()=>f),a.export(r,"FunctionMessageChunk",()=>g),a.export(r,"ToolMessage",()=>b),a.export(r,"ToolMessageChunk",()=>v),a.export(r,"ChatMessage",()=>y),a.export(r,"isBaseMessage",()=>w),a.export(r,"isBaseMessageChunk",()=>_),a.export(r,"coerceMessageLikeToMessage",()=>j),a.export(r,"ChatMessageChunk",()=>x),a.export(r,"getBufferString",()=>T),a.export(r,"mapStoredMessageToChatMessage",()=>O),a.export(r,"mapStoredMessagesToChatMessages",()=>C),a.export(r,"mapChatMessagesToStoredMessages",()=>E);var i=e("../load/serializable.js");function n(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class s extends i.Serializable{get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){let e=this._getType();if("human"===e)return new c({...this});if("ai"===e)return new h({...this});if("system"===e)return new m({...this});if("function"===e)return new g({...this});if(y.isInstance(this))return new x({...this});throw Error("Unknown message type.")}}function o(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}class l extends s{static _mergeAdditionalKwargs(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(void 0===r[e])r[e]=a;else if(typeof r[e]!=typeof a)throw Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"===e&&o(r[e])&&o(a))for(let t of a)r[e]?.[t.index]!==void 0?r[e]=r[e]?.map((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}}):r[e][t.index]=t;else throw Error(`additional_kwargs[${e}] already exists in this message chunk.`)}else r[e]=this._mergeAdditionalKwargs(r[e],a);return r}}class u extends s{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class c extends l{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new c({content:n(this.content,e.content),additional_kwargs:c._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class d extends s{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class h extends l{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new h({content:n(this.content,e.content),additional_kwargs:h._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class p extends s{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class m extends l{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new m({content:n(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class f extends s{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class g extends l{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new g({content:n(this.content,e.content),additional_kwargs:g._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class b extends s{static lc_name(){return"ToolMessage"}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}}class v extends l{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new v({content:n(this.content,e.content),additional_kwargs:v._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class y extends s{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function w(e){return"function"==typeof e?._getType}function _(e){return w(e)&&"function"==typeof e.concat}function j(e){if("string"==typeof e)return new u(e);if(w(e))return e;let[t,r]=e;if("human"===t||"user"===t)return new u({content:r});if("ai"===t||"assistant"===t)return new d({content:r});if("system"===t)return new p({content:r});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class x extends l{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new x({content:n(this.content,e.content),additional_kwargs:x._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function T(e,t="Human",r="AI"){let a=[];for(let i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=r;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else if("generic"===i._getType())e=i.role;else throw Error(`Got unsupported message type: ${i._getType()}`);let n=i.name?`${i.name}, `:"";a.push(`${e}: ${n}${i.content}`)}return a.join("\n")}function O(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new u(t.data);case"ai":return new d(t.data);case"system":return new p(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new f(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new b(t.data);case"chat":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new y(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function C(e){return e.map(O)}function E(e){return e.map(e=>e.toDict())}},{"../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"579yP":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptTemplate",()=>n);var i=e("../runnables/base.js");class n extends i.Runnable{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[e,a]of Object.entries(t))"string"==typeof a?r[e]=a:r[e]=await a();return{...r,...e}}async invoke(e,t){return this._callWithConfig(e=>this.formatPromptValue(e),e,{...t,runType:"prompt"})}serialize(){throw Error("Use .toJSON() instead")}static async deserialize(t){switch(t._type){case"prompt":{let{PromptTemplate:r}=await e("5074728d6eef1415");return r.deserialize(t)}case void 0:{let{PromptTemplate:r}=await e("5074728d6eef1415");return r.deserialize({...t,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:r}=await e("c2cac79ecf644e72");return r.deserialize(t)}default:throw Error(`Invalid prompt type in config: ${t._type}`)}}}},{"../runnables/base.js":"1qQoT","5074728d6eef1415":"3JDAX",c2cac79ecf644e72:"3t03I","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"1qQoT":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Runnable",()=>m),a.export(r,"RunnableBinding",()=>f),a.export(r,"RunnableEach",()=>g),a.export(r,"RunnableRetry",()=>b),a.export(r,"RunnableSequence",()=>v),a.export(r,"RunnableMap",()=>y),a.export(r,"RunnableLambda",()=>w),a.export(r,"RunnableParallel",()=>_),a.export(r,"RunnableWithFallbacks",()=>j),a.export(r,"_coerceToRunnable",()=>x);var i=e("p-retry"),n=a.interopDefault(i),s=e("../callbacks/manager.js"),o=e("../tracers/log_stream.js"),l=e("../load/serializable.js"),u=e("../utils/stream.js"),c=e("./config.js"),d=e("../utils/async_caller.js"),h=e("../tracers/root_listener.js");function p(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class m extends l.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new f({bound:this,kwargs:e,config:{}})}map(){return new g({bound:this})}withRetry(e){return new b({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new f({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new j({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=new d.AsyncCaller({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>i.call(async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return(0,u.IterableReadableStream).fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){let t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,[t,r]}async _callWithConfig(e,t,r){let a;let i=await (0,c.getCallbackMangerForConfig)(r),n=await i?.handleChainStart(this.toJSON(),p(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName);try{a=await e.bind(this)(t,r,n)}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(p(a,"output")),a}async _batchWithConfig(e,t,r,a){let i;let n=this._getOptionsList(r??{},t.length),s=await Promise.all(n.map(c.getCallbackMangerForConfig)),o=await Promise.all(s.map((e,r)=>e?.handleChainStart(this.toJSON(),p(t[r],"input"),void 0,n[r].runType,void 0,void 0,n[r].runName)));try{i=await e(t,n,o,a)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(p(i,"output")))),i}async *_transformStreamWithConfig(e,t,r){let a,i,n;let s=!0,o=!0,l=await (0,c.getCallbackMangerForConfig)(r),u=this.toJSON(),d=async function*(){for await(let t of e){if(n||(n=await l?.handleChainStart(u,{input:""},void 0,r?.runType,void 0,void 0,r?.runName)),s){if(void 0===a)a=t;else try{a=a.concat(t)}catch{a=void 0,s=!1}}yield t}}();try{for await(let e of t(d,n,r))if(yield e,o){if(void 0===i)i=e;else try{i=i.concat(e)}catch{i=void 0,o=!1}}}catch(e){throw await n?.handleChainError(e,void 0,void 0,void 0,{inputs:p(a,"input")}),e}await n?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:p(a,"input")})}_patchConfig(e={},t){let r={...e};return void 0!==t?(delete r.runName,{...r,callbacks:t}):r}pipe(e){return new v({first:this,last:x(e)})}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:r.concat(t);yield*this._streamIterator(r,t)}async *streamLog(e,t,r){let a=new o.LogStreamCallbackHandler({...r,autoClose:!1}),i=t??{},{callbacks:n}=i;if(void 0===n)i.callbacks=[a];else if(Array.isArray(n))i.callbacks=n.concat([a]);else{let e=n.copy();e.inheritableHandlers.push(a),i.callbacks=e}let s=await this.stream(e,i),l=async function(){try{for await(let e of s){let t=new o.RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await a.writer.write(t)}}finally{await a.writer.close()}}();try{for await(let e of a)yield e}finally{await l}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this,config:{},configFactories:[a=>({callbacks:[new h.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class f extends m{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}async _mergeConfig(e){let t=(0,c.mergeConfigs)(this.config,e);return(0,c.mergeConfigs)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig({...e,...this.kwargs}))):await this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig({...t,...this.kwargs}))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&m.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new h.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class g extends m{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new g({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}withListeners({onStart:e,onEnd:t,onError:r}){return new g({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class b extends f{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(a))}async _invoke(e,t,r){return(0,n.default)(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let i={};try{await (0,n.default)(async n=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(n,t?.[e],r?.[e])),c=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&(s=t),i[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(i).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>i[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class v extends m{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=await (0,c.getCallbackMangerForConfig)(t),i=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName),n=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r];n=await a.invoke(n,this._patchConfig(t,i?.getChild(`seq:step:${r+1}`)))}r=await this.last.invoke(n,this._patchConfig(t,i?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(p(r,"output")),r}async batch(e,t,r){let a;let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(c.getCallbackMangerForConfig)),s=await Promise.all(n.map((t,r)=>t?.handleChainStart(this.toJSON(),p(e[r],"input"),void 0,void 0,void 0,void 0,i[r].runName))),o=e;try{let e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){let a=e[t];o=await a.batch(o,s.map((e,r)=>this._patchConfig(i[r],e?.getChild(`seq:step:${t+1}`))),r)}a=await this.last.batch(o,s.map(e=>this._patchConfig(i[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`))),r)}catch(e){throw await Promise.all(s.map(t=>t?.handleChainError(e))),e}return await Promise.all(s.map((e,t)=>e?.handleChainEnd(p(a[t],"output")))),a}async *_streamIterator(e,t){let r;let a=await (0,c.getCallbackMangerForConfig)(t),i=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName),n=[this.first,...this.middle,this.last],s=!0;async function*o(){yield e}try{let e=n[0].transform(o(),this._patchConfig(t,i?.getChild("seq:step:1")));for(let r=1;r<n.length;r+=1){let a=n[r];e=await a.transform(e,this._patchConfig(t,i?.getChild(`seq:step:${r+1}`)))}for await(let t of e)if(yield t,s){if(void 0===r)r=t;else try{r=r.concat(t)}catch(e){r=void 0,s=!1}}}catch(e){throw await i?.handleChainError(e),e}await i?.handleChainEnd(p(r,"output"))}pipe(e){return new v(v.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}:{first:this.first,middle:[...this.middle,this.last],last:x(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&m.isRunnable(e)}static from([e,...t]){return new v({first:x(e),middle:t.slice(0,-1).map(x),last:x(t[t.length-1])})}}class y extends m{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=x(r)}static from(e){return new y({steps:e})}async invoke(e,t){let r=await (0,c.getCallbackMangerForConfig)(t),a=await r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName),i={};try{await Promise.all(Object.entries(this.steps).map(async([r,n])=>{i[r]=await n.invoke(e,this._patchConfig(t,a?.getChild(r)))}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(i),i}}class w extends m{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new w({func:e})}async _invoke(e,t,r){let a=await this.func(e,{config:t});return a&&m.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r?.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class _ extends y{}class j extends m{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let a=await (0,s.CallbackManager).configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),i=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName);for(let a of this.runnables())try{let r=await a.invoke(e,this._patchConfig(t,i?.getChild()));return await i?.handleChainEnd(p(r,"output")),r}catch(e){void 0===r&&(r=e)}if(void 0===r)throw Error("No error stored at end of fallback.");throw await i?.handleChainError(r),r}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(e=>(0,s.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata))),o=await Promise.all(n.map((t,r)=>t?.handleChainStart(this.toJSON(),p(e[r],"input"),void 0,void 0,void 0,void 0,i[r].runName)));for(let t of this.runnables())try{let a=await t.batch(e,o.map((e,t)=>this._patchConfig(i[t],e?.getChild())),r);return await Promise.all(o.map((e,t)=>e?.handleChainEnd(p(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(o.map(e=>e?.handleChainError(a))),a}}function x(e){if("function"==typeof e)return new w({func:e});if(m.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=x(a);return new y({steps:t})}}},{"p-retry":"hDMvm","../callbacks/manager.js":"fZx9W","../tracers/log_stream.js":"jD00e","../load/serializable.js":"ihLrn","../utils/stream.js":"faNJA","./config.js":"bd9nP","../utils/async_caller.js":"l8CrB","../tracers/root_listener.js":"i5MBm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hDMvm:[function(e,t,r){let a=e("67f41b35420203c"),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},o=e=>i.includes(e),l=(e,t)=>new Promise((r,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=a.operation(t);l.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){i(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof n)l.stop(),i(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),i(e);else{s(e,a,t);try{await t.onFailedAttempt(e)}catch(e){i(e);return}l.retry(e)||i(l.mainError())}}})});t.exports=l,t.exports.default=l,t.exports.AbortError=n},{"67f41b35420203c":"6LrBF"}],"6LrBF":[function(e,t,r){t.exports=e("4f22b206be44b97e")},{"4f22b206be44b97e":"bgrBC"}],bgrBC:[function(e,t,r){var a=e("a628df618ac3d4");r.operation=function(e){return new a(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<t.retries;i++)a.push(this.createTimeout(i,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(i,t)),a.sort(function(e,t){return e-t}),a},r.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},r.wrap=function(e,t,a){if(t instanceof Array&&(a=t,t=null),!a)for(var i in a=[],e)"function"==typeof e[i]&&a.push(i);for(var n=0;n<a.length;n++){var s=a[n],o=e[s];e[s]=(function(a){var i=r.operation(t),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){a.apply(e,n)})}).bind(e,o),e[s].options=t}}},{a628df618ac3d4:"6sDq5"}],"6sDq5":[function(e,t,r){function a(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=a,a.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},a.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},a.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},a.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},a.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},a.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},a.prototype.start=a.prototype.try,a.prototype.errors=function(){return this._errors},a.prototype.attempts=function(){return this._attempts},a.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var i=this._errors[a],n=i.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=i,r=s)}return t}},{}],fZx9W:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"parseCallbackConfigArg",()=>h),a.export(r,"BaseCallbackManager",()=>p),a.export(r,"CallbackManagerForRetrieverRun",()=>f),a.export(r,"CallbackManagerForLLMRun",()=>g),a.export(r,"CallbackManagerForChainRun",()=>b),a.export(r,"CallbackManagerForToolRun",()=>v),a.export(r,"CallbackManager",()=>y),a.export(r,"TraceGroup",()=>_),a.export(r,"traceAsGroup",()=>j);var i=e("uuid"),n=e("./base.js"),s=e("../tracers/console.js"),o=e("../tracers/initialize.js"),l=e("../messages/index.js"),u=e("../utils/env.js"),c=e("../tracers/tracer_langchain.js"),d=e("./promises.js");function h(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class p{setHandler(e){return this.setHandlers([e])}}class m{constructor(e,t,r,a,i,n,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}},t.awaitHandlers)))}}class f extends m{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}},t.awaitHandlers)))}}class g extends m{async handleLLMNewToken(e,t,r,a,i,n){await Promise.all(this.handlers.map(r=>(0,d.consumeCallback)(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}},t.awaitHandlers)))}}class b extends m{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}},t.awaitHandlers)))}}class v extends m{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}},t.awaitHandlers)))}}class y extends p{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r,a,n,s,o,l){return Promise.all(t.map(async t=>{let r=(0,i.v4)();return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreLLM)try{await a.handleLLMStart?.(e,[t],r,this._parentRunId,n,this.tags,this.metadata,l)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,n,s,o,u){return Promise.all(t.map(async t=>{let r=(0,i.v4)();return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await a.handleChatModelStart?.(e,[t],r,this._parentRunId,n,this.tags,this.metadata,u);else if(a.handleLLMStart){let i=(0,l.getBufferString)(t);await a.handleLLMStart?.(e,[i],r,this._parentRunId,n,this.tags,this.metadata,u)}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,i.v4)(),a,n,s,o){return await Promise.all(this.handlers.map(i=>(0,d.consumeCallback)(async()=>{if(!i.ignoreChain)try{await i.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(e){console.error(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`)}},i.awaitHandlers))),new b(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,i.v4)(),a,n,s,o){return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreAgent)try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}},a.awaitHandlers))),new v(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,i.v4)(),a,n,s,o){return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreRetriever)try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}},a.awaitHandlers))),new f(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new y(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends n.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.v4)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,i,n,l){let c;(e||t)&&(Array.isArray(e)||!e?(c=new y).setHandlers(e?.map(w)??[],!0):c=e,c=c.copy(Array.isArray(t)?t.map(w):t?.handlers,!1));let d="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||l?.verbose,h="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_TRACING_V2"),p=h||((0,u.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(d||p){if(c||(c=new y),d&&!c.handlers.some(e=>e.name===s.ConsoleCallbackHandler.prototype.name)){let e=new s.ConsoleCallbackHandler;c.addHandler(e,!0)}if(p&&!c.handlers.some(e=>"langchain_tracer"===e.name)){if(h)c.addHandler(await (0,o.getTracingV2CallbackHandler)(),!0);else{let e=(0,u.getEnvironmentVariable)("LANGCHAIN_PROJECT")&&(0,u.getEnvironmentVariable)("LANGCHAIN_SESSION");c.addHandler(await (0,o.getTracingCallbackHandler)(e),!0)}}}return(r||a)&&c&&(c.addTags(r??[]),c.addTags(a??[],!1)),(i||n)&&c&&(c.addMetadata(i??{}),c.addMetadata(n??{},!1)),c}}function w(e){return"name"in e?e:(0,n.BaseCallbackHandler).fromMethods(e)}class _{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){let a=new c.LangChainTracer(r),i=await y.configure([a]),n=await i?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{});if(!n)throw Error("Failed to create run group callback manager.");return n}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}async function j(e,t,...r){let a=new _(e.name,e),i=await a.start({...r});try{let e=await t(i,...r);return await a.end(e&&!Array.isArray(e)&&"object"==typeof e?e:{output:e}),e}catch(e){throw await a.error(e),e}}},{uuid:"l36KR","./base.js":"f3sIf","../tracers/console.js":"fPFQ8","../tracers/initialize.js":"kuqFT","../messages/index.js":"jMGwo","../utils/env.js":"2Th20","../tracers/tracer_langchain.js":"dB0hq","./promises.js":"3BeNh","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l36KR:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"v1",()=>n.default),a.export(r,"v3",()=>o.default),a.export(r,"v4",()=>u.default),a.export(r,"v5",()=>d.default),a.export(r,"NIL",()=>p.default),a.export(r,"version",()=>f.default),a.export(r,"validate",()=>b.default),a.export(r,"stringify",()=>y.default),a.export(r,"parse",()=>_.default);var i=e("./v1.js"),n=a.interopDefault(i),s=e("./v3.js"),o=a.interopDefault(s),l=e("./v4.js"),u=a.interopDefault(l),c=e("./v5.js"),d=a.interopDefault(c),h=e("./nil.js"),p=a.interopDefault(h),m=e("./version.js"),f=a.interopDefault(m),g=e("./validate.js"),b=a.interopDefault(g),v=e("./stringify.js"),y=a.interopDefault(v),w=e("./parse.js"),_=a.interopDefault(w)},{"./v1.js":"3PHPC","./v3.js":"3Iz16","./v4.js":"fCvRE","./v5.js":"8bhSy","./nil.js":"8P8RR","./version.js":"amAFP","./validate.js":"dtbjp","./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3PHPC":[function(e,t,r){let a,i;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r);var s=e("./rng.js"),o=n.interopDefault(s),l=e("./stringify.js");let u=0,c=0;r.default=function(e,t,r){let n=t&&r||0,s=t||Array(16),d=(e=e||{}).node||a,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){let t=e.random||(e.rng||(0,o.default))();null==d&&(d=a=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==h&&(h=i=(t[6]<<8|t[7])&16383)}let p=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:c+1,f=p-u+(m-c)/1e4;if(f<0&&void 0===e.clockseq&&(h=h+1&16383),(f<0||p>u)&&void 0===e.nsecs&&(m=0),m>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");u=p,c=m,i=h;let g=((268435455&(p+=122192928e5))*1e4+m)%4294967296;s[n++]=g>>>24&255,s[n++]=g>>>16&255,s[n++]=g>>>8&255,s[n++]=255&g;let b=p/4294967296*1e4&268435455;s[n++]=b>>>8&255,s[n++]=255&b,s[n++]=b>>>24&15|16,s[n++]=b>>>16&255,s[n++]=h>>>8|128,s[n++]=255&h;for(let e=0;e<6;++e)s[n+e]=d[e];return t||(0,l.unsafeStringify)(s)}},{"./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5NLI7":[function(e,t,r){let a;var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"default",()=>s);let n=new Uint8Array(16);function s(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cQV7f:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unsafeStringify",()=>o);var i=e("./validate.js"),n=a.interopDefault(i);let s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function o(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}r.default=function(e,t=0){let r=o(e,t);if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dtbjp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./regex.js"),n=a.interopDefault(i);r.default=function(e){return"string"==typeof e&&(0,n.default).test(e)}},{"./regex.js":"8c6XP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8c6XP":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3Iz16":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./v35.js"),n=a.interopDefault(i),s=e("./md5.js"),o=a.interopDefault(s);let l=(0,n.default)("v3",48,o.default);r.default=l},{"./v35.js":"izhU4","./md5.js":"i4R3s","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],izhU4:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"DNS",()=>o),a.export(r,"URL",()=>l),a.export(r,"default",()=>u);var i=e("./stringify.js"),n=e("./parse.js"),s=a.interopDefault(n);let o="6ba7b810-9dad-11d1-80b4-00c04fd430c8",l="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function u(e,t,r){function a(e,a,n,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof a&&(a=(0,s.default)(a)),(null===(l=a)||void 0===l?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+e.length);if(u.set(a),u.set(e,a.length),(u=r(u))[6]=15&u[6]|t,u[8]=63&u[8]|128,n){o=o||0;for(let e=0;e<16;++e)n[o+e]=u[e];return n}return(0,i.unsafeStringify)(u)}try{a.name=e}catch(e){}return a.DNS=o,a.URL=l,a}},{"./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],aFeXC:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./validate.js"),n=a.interopDefault(i);r.default=function(e){let t;if(!(0,n.default)(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i4R3s:[function(e,t,r){function a(e){return(e+64>>>9<<4)+14+1}function i(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,t,r,a,n,s){var o;return i((o=i(i(t,e),i(a,s)))<<n|o>>>32-n,r)}function s(e,t,r,a,i,s,o){return n(t&r|~t&a,e,t,i,s,o)}function o(e,t,r,a,i,s,o){return n(t&a|r&~a,e,t,i,s,o)}function l(e,t,r,a,i,s,o){return n(t^r^a,e,t,i,s,o)}function u(e,t,r,a,i,s,o){return n(r^(t|~a),e,t,i,s,o)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){let t=[],r=32*e.length,a="0123456789abcdef";for(let i=0;i<r;i+=8){let r=e[i>>5]>>>i%32&255,n=parseInt(a.charAt(r>>>4&15)+a.charAt(15&r),16);t.push(n)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[a(t)-1]=t;let r=1732584193,n=-271733879,c=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){let a=r,h=n,p=c,m=d;r=s(r,n,c,d,e[t],7,-680876936),d=s(d,r,n,c,e[t+1],12,-389564586),c=s(c,d,r,n,e[t+2],17,606105819),n=s(n,c,d,r,e[t+3],22,-1044525330),r=s(r,n,c,d,e[t+4],7,-176418897),d=s(d,r,n,c,e[t+5],12,1200080426),c=s(c,d,r,n,e[t+6],17,-1473231341),n=s(n,c,d,r,e[t+7],22,-45705983),r=s(r,n,c,d,e[t+8],7,1770035416),d=s(d,r,n,c,e[t+9],12,-1958414417),c=s(c,d,r,n,e[t+10],17,-42063),n=s(n,c,d,r,e[t+11],22,-1990404162),r=s(r,n,c,d,e[t+12],7,1804603682),d=s(d,r,n,c,e[t+13],12,-40341101),c=s(c,d,r,n,e[t+14],17,-1502002290),n=s(n,c,d,r,e[t+15],22,1236535329),r=o(r,n,c,d,e[t+1],5,-165796510),d=o(d,r,n,c,e[t+6],9,-1069501632),c=o(c,d,r,n,e[t+11],14,643717713),n=o(n,c,d,r,e[t],20,-373897302),r=o(r,n,c,d,e[t+5],5,-701558691),d=o(d,r,n,c,e[t+10],9,38016083),c=o(c,d,r,n,e[t+15],14,-660478335),n=o(n,c,d,r,e[t+4],20,-405537848),r=o(r,n,c,d,e[t+9],5,568446438),d=o(d,r,n,c,e[t+14],9,-1019803690),c=o(c,d,r,n,e[t+3],14,-187363961),n=o(n,c,d,r,e[t+8],20,1163531501),r=o(r,n,c,d,e[t+13],5,-1444681467),d=o(d,r,n,c,e[t+2],9,-51403784),c=o(c,d,r,n,e[t+7],14,1735328473),n=o(n,c,d,r,e[t+12],20,-1926607734),r=l(r,n,c,d,e[t+5],4,-378558),d=l(d,r,n,c,e[t+8],11,-2022574463),c=l(c,d,r,n,e[t+11],16,1839030562),n=l(n,c,d,r,e[t+14],23,-35309556),r=l(r,n,c,d,e[t+1],4,-1530992060),d=l(d,r,n,c,e[t+4],11,1272893353),c=l(c,d,r,n,e[t+7],16,-155497632),n=l(n,c,d,r,e[t+10],23,-1094730640),r=l(r,n,c,d,e[t+13],4,681279174),d=l(d,r,n,c,e[t],11,-358537222),c=l(c,d,r,n,e[t+3],16,-722521979),n=l(n,c,d,r,e[t+6],23,76029189),r=l(r,n,c,d,e[t+9],4,-640364487),d=l(d,r,n,c,e[t+12],11,-421815835),c=l(c,d,r,n,e[t+15],16,530742520),n=l(n,c,d,r,e[t+2],23,-995338651),r=u(r,n,c,d,e[t],6,-198630844),d=u(d,r,n,c,e[t+7],10,1126891415),c=u(c,d,r,n,e[t+14],15,-1416354905),n=u(n,c,d,r,e[t+5],21,-57434055),r=u(r,n,c,d,e[t+12],6,1700485571),d=u(d,r,n,c,e[t+3],10,-1894986606),c=u(c,d,r,n,e[t+10],15,-1051523),n=u(n,c,d,r,e[t+1],21,-2054922799),r=u(r,n,c,d,e[t+8],6,1873313359),d=u(d,r,n,c,e[t+15],10,-30611744),c=u(c,d,r,n,e[t+6],15,-1560198380),n=u(n,c,d,r,e[t+13],21,1309151649),r=u(r,n,c,d,e[t+4],6,-145523070),d=u(d,r,n,c,e[t+11],10,-1120210379),c=u(c,d,r,n,e[t+2],15,718787259),n=u(n,c,d,r,e[t+9],21,-343485551),r=i(r,a),n=i(n,h),c=i(c,p),d=i(d,m)}return[r,n,c,d]}(function(e){if(0===e.length)return[];let t=8*e.length,r=new Uint32Array(a(t));for(let a=0;a<t;a+=8)r[a>>5]|=(255&e[a/8])<<a%32;return r}(e),8*e.length))}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fCvRE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./native.js"),n=a.interopDefault(i),s=e("./rng.js"),o=a.interopDefault(s),l=e("./stringify.js");r.default=function(e,t,r){if(n.default.randomUUID&&!t&&!e)return(0,n.default).randomUUID();let a=(e=e||{}).random||(e.rng||(0,o.default))();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return(0,l.unsafeStringify)(a)}},{"./native.js":"36JDj","./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"36JDj":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let a="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);r.default={randomUUID:a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8bhSy":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./v35.js"),n=a.interopDefault(i),s=e("./sha1.js"),o=a.interopDefault(s);let l=(0,n.default)("v5",80,o.default);r.default=l},{"./v35.js":"izhU4","./sha1.js":"57fIB","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"57fIB":[function(e,t,r){function a(e,t){return e<<t|e>>>32-t}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let i=Math.ceil((e.length/4+2)/16),n=Array(i);for(let t=0;t<i;++t){let r=new Uint32Array(16);for(let a=0;a<16;++a)r[a]=e[64*t+4*a]<<24|e[64*t+4*a+1]<<16|e[64*t+4*a+2]<<8|e[64*t+4*a+3];n[t]=r}n[i-1][14]=(e.length-1)*8/4294967296,n[i-1][14]=Math.floor(n[i-1][14]),n[i-1][15]=(e.length-1)*8&4294967295;for(let e=0;e<i;++e){let i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=n[e][t];for(let e=16;e<80;++e)i[e]=a(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let s=r[0],o=r[1],l=r[2],u=r[3],c=r[4];for(let e=0;e<80;++e){let r=Math.floor(e/20),n=a(s,5)+function(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}(r,o,l,u)+c+t[r]+i[e]>>>0;c=u,u=l,l=a(o,30)>>>0,o=s,s=n}r[0]=r[0]+s>>>0,r[1]=r[1]+o>>>0,r[2]=r[2]+l>>>0,r[3]=r[3]+u>>>0,r[4]=r[4]+c>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8P8RR":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default="00000000-0000-0000-0000-000000000000"},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],amAFP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./validate.js"),n=a.interopDefault(i);r.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],f3sIf:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseCallbackHandler",()=>l);var i=e("uuid"),n=e("../load/serializable.js"),s=e("19649504761b54db");class o{}class l extends o{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,n.get_lc_unique_name)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0===s||s.env?.LANGCHAIN_CALLBACKS_BACKGROUND!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return(0,n.Serializable).prototype.toJSON.call(this)}toJSONNotImplemented(){return(0,n.Serializable).prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:i.v4()}),Object.assign(this,e)}}}}},{"19649504761b54db":"7XEqq",uuid:"l36KR","../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7XEqq":[function(e,t,r){let a,i,n,s;var o=Object.create,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,d=Object.getPrototypeOf,h=Object.prototype.hasOwnProperty,p=(e,t,r,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of c(t))h.call(e,i)||i===r||l(e,i,{get:()=>t[i],enumerable:!(a=u(t,i))||a.enumerable});return e},m=(e,t,r)=>(r=null!=e?o(d(e)):{},p(!t&&e&&e.__esModule?r:l(r,"default",{value:e,enumerable:!0}),e)),f=(a=(e,t)=>{var r,a,i=t.exports={};function n(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===n||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:n}catch(e){r=n}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&p())}function p(){if(!c){var e=o(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||o(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}},()=>(i||a((i={exports:{}}).exports,i),i.exports)),g={};((e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})})(g,{default:()=>v}),t.exports=p(l({},"__esModule",{value:!0}),g);var b=m(f());n=m(f()),s=t.exports,p(g,n,"default"),s&&p(s,n,"default");var v=b.default},{}],fPFQ8:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"ConsoleCallbackHandler",()=>d);var i=e("ansi-styles"),n=a.interopDefault(i),s=e("./base.js");function o(e,t){return`${e.open}${t}${e.close}`}function l(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function u(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:c}=n.default;class d extends s.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(n.default.bold,a):a}).join(" > ");return o(c.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[chain/start]")} [${t}] Entering Chain run with input: ${l(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[chain/end]")} [${t}] [${u(e)}] Exiting Chain run with output: ${l(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[chain/error]")} [${t}] [${u(e)}] Chain run errored with error: ${l(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${o(c.green,"[llm/start]")} [${t}] Entering LLM run with input: ${l(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[llm/end]")} [${t}] [${u(e)}] Exiting LLM run with output: ${l(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[llm/error]")} [${t}] [${u(e)}] LLM run errored with error: ${l(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[tool/end]")} [${t}] [${u(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[tool/error]")} [${t}] [${u(e)}] Tool run errored with error: ${l(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${l(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[retriever/end]")} [${t}] [${u(e)}] Exiting Retriever run with output: ${l(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[retriever/error]")} [${t}] [${u(e)}] Retriever run errored with error: ${l(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.blue,"[agent/action]")} [${t}] Agent selected action: ${l(e.actions[e.actions.length-1],"[action]")}`)}}},{"ansi-styles":"26v5d","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"26v5d":[function(e,t,r){let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,i=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(t,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,i]of Object.entries(a))t[r]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},a[r]=t[r],e.set(i[0],i[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=i(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},{}],gsfZb:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseTracer",()=>s);var i=e("../callbacks/base.js");function n(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class s extends i.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){if(void 0!==e.parent_run_id){let t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e),await this.onRunCreate?.(e)}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleChatModelStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}async handleChainStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,r,a,i){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=n(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=n(i.inputs,"input")),await this.onChainEnd?.(s),await this._endTrace(s),s}async handleChainError(e,t,r,a,i){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.error=e.message,s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),i?.inputs!==void 0&&(s.inputs=n(i.inputs,"input")),await this.onChainError?.(s),await this._endTrace(s),s}async handleToolStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}async handleRetrieverStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return await this._startTrace(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,i,n){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:n?.chunk}}),await this.onLLMNewToken?.(s,e),s}}},{"../callbacks/base.js":"f3sIf","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kuqFT:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getTracingCallbackHandler",()=>s),a.export(r,"getTracingV2CallbackHandler",()=>o);var i=e("./tracer_langchain.js"),n=e("./tracer_langchain_v1.js");async function s(e){let t=new n.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t}async function o(){return new i.LangChainTracer}},{"./tracer_langchain.js":"dB0hq","./tracer_langchain_v1.js":"Pa0ga","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dB0hq:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracer",()=>o);var i=e("langsmith"),n=e("../utils/env.js"),s=e("./base.js");class o extends s.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,n.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,n.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new i.Client({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,n.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}},{langsmith:"kvxIp","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kvxIp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var i=e("./dist/index.js");a.exportAll(i,r)},{"./dist/index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cCB7g:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>i.Client),a.export(r,"RunTree",()=>n.RunTree),a.export(r,"__version__",()=>s);var i=e("./client.js"),n=e("./run_trees.js");let s="0.0.70"},{"./client.js":"2VxwW","./run_trees.js":"9zMS3","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2VxwW":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>g);var i=e("uuid"),n=e("./utils/async_caller.js"),s=e("./utils/messages.js"),o=e("./utils/env.js"),l=e("./index.js");async function u(e){let t=await (0,o.getRuntimeEnvironment)(),r=(0,o.getLangChainEnvVarsMetadata)();return e.map(e=>{let a=e.extra??{},i=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...i}},e})}let c=()=>{let e=(0,o.getEnvironmentVariable)("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;let t=parseFloat(e);if(t<0||t>1)throw Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},d=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},h=async(e,t)=>{let r=await e.text();if(!e.ok)throw Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};async function p(e){let t=[];for await(let r of e)t.push(r);return t}function m(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function f(e){if(!i.validate(e))throw Error(`Invalid UUID: ${e}`)}class g{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingAutoBatchedRuns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50});let t=g.getDefaultClientConfig();this.tracingSampleRate=c(),this.apiUrl=m(e.apiUrl??t.apiUrl)??"",this.apiKey=m(e.apiKey??t.apiKey),this.webUrl=m(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new n.AsyncCaller(e.callerOptions??{}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit}static getDefaultClientConfig(){let e=(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_OUTPUTS")}}validateApiKeyIfHosted(){if(!d(this.apiUrl)&&!this.apiKey)throw Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:d(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${l.__version__}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs?{}:e}processOutputs(e){return this.hideOutputs?{}:e}prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,n=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);let s=await n.json();if(0===s.length||(yield s,s.length<a))break;r+=s.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let i=t?{...t}:{};for(;;){let t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(i)}),n=await t.json();if(!n||!n[a])break;yield n[a];let s=n.cursors;if(!s||!s.next)break;i.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.sampledPostUuids.has(r.id)&&(t.push(r),this.sampledPostUuids.delete(r.id));return t}{let t=[];for(let r of e)Math.random()<this.tracingSampleRate&&(t.push(r),this.sampledPostUuids.add(r.id));return t}}async triggerAutoBatchSend(e){let t=e;void 0===t&&(t=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit),this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit)),await this.batchIngestRuns({runCreates:t.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:t.filter(e=>"update"===e.action).map(e=>e.item)})}appendRunCreateToAutoBatchQueue(e){let t=this.autoBatchTimeout;for(clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,this.pendingAutoBatchedRuns.push(e);this.pendingAutoBatchedRuns.length>=this.pendingAutoBatchedRunLimit;){let e=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit);this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit),this.triggerAutoBatchSend(e)}this.pendingAutoBatchedRuns.length>0&&(t?this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchAggregationDelayMs):this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchInitialDelayMs))}async batchEndpointIsSupported(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)});return!!e.ok||(await e.text(),!1)}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"create",item:a});return}let i=await u([a]),n=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms)});await h(n,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[],a=t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[];if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}let i={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await u(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let e of(this.autoBatchTracing=!1,i.post))await this.createRun(e);for(let e of i.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}let n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await h(s,"batch create run")}async updateRun(e,t){f(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"update",item:r});return}let a={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await h(i,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){f(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await p(this.listRuns({id:e.child_run_ids})),r={},a={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns({projectId:e,projectName:t,parentRunId:r,traceId:a,referenceExampleId:i,startTime:n,executionOrder:s,runType:o,error:l,id:u,query:c,filter:d,limit:h}){let p=[];if(e&&(p=Array.isArray(e)?e:[e]),t){let e=Array.isArray(t)?t:[t],r=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));p.push(...r)}let m={session:p.length?p:null,run_type:o,reference_example:i,query:c,filter:d,execution_order:s,parent_run:r?[r]:null,start_time:n?n.toISOString():null,error:l,id:u,limit:h,trace:a};for await(let e of this._getCursorPaginatedList("/runs/query",m))yield*e}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||i.v4()};f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await a.json();if(null===n||!("share_token"in n))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(t,"unshare run")}async readRunSharedLink(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),f(e);let r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),i=await a.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(t,"unshare dataset")}async readSharedDataset(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:n=null}){let s=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,o=i||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==n&&(l.reference_dataset_id=n);let u=await this.caller.call(fetch,s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),c=await u.json();if(!u.ok)throw Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return c}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:n=null}){let s=`${this.apiUrl}/sessions/${e}`,o=i;a&&(o={...o||{},metadata:a});let l={name:t,extra:o,description:r,end_time:n?new Date(n).toISOString():null},u=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),c=await u.json();if(!u.ok)throw Error(`Failed to update project ${e}: ${u.status} ${u.statusText}`);return c}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let i=await this.caller.call(fetch,`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});try{let e=await i.json();if(!i.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,i="/sessions",n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),i+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&n.append("include_stats",r.toString());let s=await this._get(i,n);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:n}={}){let s=new URLSearchParams;if(void 0!==e)for(let t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==r&&s.append("name_contains",r),void 0!==a)s.append("reference_dataset",a);else if(void 0!==i){let e=await this.readDataset({datasetName:i});s.append("reference_dataset",e.id)}for await(let e of(void 0!==n&&s.append("reference_free",n.toString()),this._getPaginated("/sessions",s)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");f(r=void 0===e?(await this.readProject({projectName:t})).id:e);let a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await h(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:n,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),i&&l.append("description",i),n&&l.append("data_type",n),s&&l.append("name",s);let u=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok){let e=await u.json();if(e.detail&&e.detail.includes("already exists"))throw Error(`Dataset ${t} already exists`);throw Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}return await u.json()}async createDataset(e,{description:t,dataType:r}={}){let a={name:e,description:t};r&&(a.data_type=r);let i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok){let t=await i.json();if(t.detail&&t.detail.includes("already exists"))throw Error(`Dataset ${e} already exists`);throw Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",i=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)f(e),a+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide datasetName or datasetId");let n=await this._get(a,i);if(Array.isArray(n)){if(0===n.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i}={}){let n=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)n.append("id",e);for await(let e of(void 0!==a&&n.append("name",a),void 0!==i&&n.append("name_contains",i),this._getPaginated("/datasets",n)))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0!==a)f(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:i,exampleId:n}){let s=r;if(void 0===s&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==s&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===s&&(s=(await this.readDataset({datasetName:a})).id);let o=i||new Date,l={dataset_id:s,inputs:e,outputs:t,created_at:o?.toISOString(),id:n},u=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok)throw Error(`Failed to create example: ${u.status} ${u.statusText}`);return await u.json()}async createExamples(e){let{inputs:t,outputs:r,sourceRunIds:a,exampleIds:i,datasetId:n,datasetName:s}=e,o=n;if(void 0===o&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===o&&(o=(await this.readDataset({datasetName:s})).id);let l=t.map((e,t)=>({dataset_id:o,inputs:e,outputs:r?r[t]:void 0,id:i?i[t]:void 0,source_run_id:a?a[t]:void 0})),u=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok)throw Error(`Failed to create examples: ${u.status} ${u.statusText}`);return await u.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>(0,s.isLangChainMessage)(e)?(0,s.convertLangChainMessageToExample)(e):e),i=(0,s.isLangChainMessage)(t)?(0,s.convertLangChainMessageToExample)(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){f(e);let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a=e;else if(void 0!==t)a=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let i=new URLSearchParams({dataset:a});if(void 0!==r)for(let e of r)i.append("id",e);for await(let e of this._getPaginated("/examples",i))yield*e}async deleteExample(e){f(e);let t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){f(e);let r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){let n;if("string"==typeof e)n=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)n=e;else throw Error(`Invalid run type: ${typeof e}`);null!==n.reference_example_id&&void 0!==n.reference_example_id&&(i=await this.readExample(n.reference_example_id));let s=await t.evaluateRun(n,i),o=r??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});let l=s.targetRunId??n.id;return await this.createFeedback(l,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:n,comment:s,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,eager:d=!1}){let p={type:l??"api",metadata:o??{}};void 0===u||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:u}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&f(p.metadata.__run.run_id);let m={id:c??i.v4(),run_id:e,key:t,score:r,value:a,correction:n,comment:s,feedback_source:p},g=`${this.apiUrl}/feedback`+(d?"/eager":""),b=await this.caller.call(fetch,g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms)});return await h(b,"create feedback"),m}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){let n={};null!=t&&(n.score=t),null!=r&&(n.value=r),null!=a&&(n.correction=a),null!=i&&(n.comment=i),f(e);let s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});await h(s,"update feedback")}async readFeedback(e){f(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){f(e);let t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}}},{uuid:"l36KR","./utils/async_caller.js":"bLfDs","./utils/messages.js":"lQU31","./utils/env.js":"6TaU5","./index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bLfDs:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>c);var i=e("p-retry"),n=a.interopDefault(i),s=e("p-queue"),o=a.interopDefault(s);let l=[400,401,403,404,405,406,407,408],u=[409];class c{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,n.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status;if(t){if(l.includes(+t))throw e;if(u.includes(+t))return}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kO9Cj:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("a178093eea54aebd"),i=e("d219d890bb7e8882"),n=e("4a792a8cd58e20a7"),s=()=>{},o=new i.TimeoutError;r.default=class extends a{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let n=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await n)}catch(e){a(e)}this._next()};this._queue.enqueue(n,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},{a178093eea54aebd:"18IC9",d219d890bb7e8882:"1SPZv","4a792a8cd58e20a7":"6J1Cc"}],"18IC9":[function(e,t,r){var a=Object.prototype.hasOwnProperty,i="~";function n(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,a,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,a||e,n),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)a.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,n=r.length,s=Array(n);a<n;a++)s[a]=r[a].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,a,n,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,a),!0;case 5:return c.fn.call(c.context,t,r,a,n),!0;case 6:return c.fn.call(c.context,t,r,a,n,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,a);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,a){var n=i?i+e:e;if(!this._events[n])return this;if(!t)return l(this,n),this;var s=this._events[n];if(s.fn)s.fn!==t||a&&!s.once||r&&s.context!==r||l(this,n);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||a&&!s[o].once||r&&s[o].context!==r)&&u.push(s[o]);u.length?this._events[n]=1===u.length?u[0]:u:l(this,n)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&l(this,t)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,t.exports=u},{}],"1SPZv":[function(e,t,r){let a=e("ed36938359c1cb6b");class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}let n=(e,t,r)=>new Promise((n,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){n(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){s(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new i(a);"function"==typeof e.cancel&&e.cancel(),s(o)},t);a(e.then(n,s),()=>{clearTimeout(o)})});t.exports=n,t.exports.default=n,t.exports.TimeoutError=i},{ed36938359c1cb6b:"bvvkH"}],bvvkH:[function(e,t,r){t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},{}],"6J1Cc":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("9ebe1cec8dfae466");r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let i=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},{"9ebe1cec8dfae466":"2Nr9E"}],"2Nr9E":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let a=0,i=e.length;for(;i>0;){let n=i/2|0,s=a+n;0>=r(e[s],t)?(a=++s,i-=n+1):i=n}return a}},{}],lQU31:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e){return"function"==typeof e?._getType}function n(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}a.defineInteropFlag(r),a.export(r,"isLangChainMessage",()=>i),a.export(r,"convertLangChainMessageToExample",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6TaU5":[function(e,t,r){let a,i,n;var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"isBrowser",()=>u),s.export(r,"isWebWorker",()=>c),s.export(r,"isJsDom",()=>d),s.export(r,"isDeno",()=>h),s.export(r,"isNode",()=>p),s.export(r,"getEnv",()=>m),s.export(r,"getRuntimeEnvironment",()=>f),s.export(r,"getLangChainEnvVars",()=>g),s.export(r,"getLangChainEnvVarsMetadata",()=>b),s.export(r,"getEnvironmentVariables",()=>v),s.export(r,"getEnvironmentVariable",()=>y),s.export(r,"setEnvironmentVariable",()=>w),s.export(r,"getShas",()=>_);var o=e("../index.js"),l=e("6a932e963f932781");let u=()=>"undefined"!=typeof window&&void 0!==window.document,c=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,d=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),h=()=>"undefined"!=typeof Deno,p=()=>void 0!==l&&void 0!==l.versions&&void 0!==l.versions.node&&!h(),m=()=>a||(a=u()?"browser":p()?"node":c()?"webworker":d()?"jsdom":h()?"deno":"other");async function f(){if(void 0===i){let e=m(),t=_();i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:o.__version__,...t}}return i}function g(){let e=v()||{},t={};for(let[r,a]of Object.entries(e))r.startsWith("LANGCHAIN_")&&"string"==typeof a&&(t[r]=a);for(let e in t)if((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&"string"==typeof t[e]){let r=t[e];t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2)}return t}function b(){let e=v()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[a,i]of Object.entries(e))!a.startsWith("LANGCHAIN_")||"string"!=typeof i||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=i:t[a]=i);return t}function v(){try{if(void 0!==l&&l.env)return Object.entries(l.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}function y(e){try{return void 0!==l?l.env?.[e]:void 0}catch(e){return}}function w(e,t){}function _(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=y(t);void 0!==r&&(e[t]=r)}return n=e,e}},{"6a932e963f932781":"7XEqq","../index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9zMS3":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"convertToDottedOrderFormat",()=>l),a.export(r,"RunTree",()=>u);var i=e("uuid"),n=e("./utils/env.js"),s=e("./client.js");let o={};function l(e,t){return`${new Date(e).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+t}class u{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,{...u.getDefaultConfig(),...e}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id:this.trace_id=this.id),!this.dotted_order){let e=l(this.start_time,this.id);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:i.v4(),run_type:"chain",project_name:(0,n.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,n.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,n.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,n.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{},client:new s.Client({})}}async createChild(e){let t=new u({...e,parent_run:this,project_name:this.project_name,client:this.client});return this.child_runs.push(t),t}async end(e,t,r=Date.now()){this.outputs=e,this.error=t,this.end_time=r}async _convertToCreate(e,t=!0){let r,a;let i=e.extra??{};for(let[e,t]of(i.runtime||(i.runtime={}),Object.entries(await (0,n.getRuntimeEnvironment)())))i.runtime[e]||(i.runtime[e]=t);return t?(a=e.parent_run?.id,r=[]):(r=await Promise.all(e.child_runs.map(e=>this._convertToCreate(e,t))),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:r,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order}}async postRun(e=!0){let t=await this._convertToCreate(this,!0);if(await this.client.createRun(t),!e){var r;for(let e of(o[r="Posting with excludeChildRuns=false is deprecated and will be removed in a future version."]||(console.warn(r),o[r]=!0),this.child_runs))await e.postRun(!1)}}async patchRun(){let e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id};await this.client.updateRun(this.id,e)}}},{uuid:"l36KR","./utils/env.js":"6TaU5","./client.js":"2VxwW","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2Th20":[function(e,t,r){let a;var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"isBrowser",()=>s),i.export(r,"isWebWorker",()=>o),i.export(r,"isJsDom",()=>l),i.export(r,"isDeno",()=>u),i.export(r,"isNode",()=>c),i.export(r,"getEnv",()=>d),i.export(r,"getRuntimeEnvironment",()=>h),i.export(r,"getEnvironmentVariable",()=>p);var n=e("d7d668f88b40f2c1");let s=()=>"undefined"!=typeof window&&void 0!==window.document,o=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,l=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),u=()=>"undefined"!=typeof Deno,c=()=>void 0!==n&&void 0!==n.versions&&void 0!==n.versions.node&&!u(),d=()=>s()?"browser":c()?"node":o()?"webworker":l()?"jsdom":u()?"deno":"other";async function h(){return void 0===a&&(a={library:"langchain-js",runtime:d()}),a}function p(e){try{return void 0!==n?n.env?.[e]:void 0}catch(e){return}}},{d7d668f88b40f2c1:"7XEqq","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],Pa0ga:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracerV1",()=>o);var i=e("../messages/index.js"),n=e("../utils/env.js"),s=e("./base.js");class o extends s.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let e=(0,n.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){let t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){let t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){let e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){let t;let r=this.session??await this.loadDefaultSession(),a=e.serialized;if("llm"===e.run_type){let n=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(e=>(0,i.getBufferString)(e));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,prompts:n,response:e.outputs}}else if("chain"===e.run_type){let i=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:i.filter(e=>"llm"===e.type),child_chain_runs:i.filter(e=>"chain"===e.type),child_tool_runs:i.filter(e=>"tool"===e.type)}}else if("tool"===e.run_type){let i=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(a),child_llm_runs:i.filter(e=>"llm"===e.type),child_chain_runs:i.filter(e=>"chain"===e.type),child_tool_runs:i.filter(e=>"tool"===e.type)}}else throw Error(`Unknown run type: ${e.run_type}`);return t}async persistRun(e){let t,r;t="llm"===(r=void 0!==e.run_type?await this.convertV2RunToRun(e):e).type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;let a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){let t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){let t;let r=await fetch(e,{method:"GET",headers:this.headers});if(!r.ok)return console.error(`Failed to load session: ${r.status} ${r.statusText}`),t={id:1,start_time:Date.now()},this.session=t,t;let a=await r.json();return 0===a.length?t={id:1,start_time:Date.now()}:[t]=a,this.session=t,t}}},{"../messages/index.js":"jMGwo","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3BeNh":[function(e,t,r){let a;var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"consumeCallback",()=>o),i.export(r,"awaitAllCallbacks",()=>l);var n=e("p-queue"),s=i.interopDefault(n);async function o(e,t){!0===t?await e():(void 0===a&&(a=new("default"in s.default?s.default.default:s.default)({autoStart:!0,concurrency:1})),a.add(e))}function l(){return void 0!==a?a.onIdle():Promise.resolve()}},{"p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jD00e:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunLogPatch",()=>o),a.export(r,"RunLog",()=>l),a.export(r,"LogStreamCallbackHandler",()=>u);var i=e("../utils/fast-json-patch/index.js"),n=e("./base.js"),s=e("../utils/stream.js");class o{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){let t=this.ops.concat(e.ops),r=(0,i.applyPatch)({},t);return new l({ops:t,state:r[r.length-1].newDocument})}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,i.applyPatch)(this.state,e.ops);return new l({ops:t,state:r[r.length-1].newDocument})}}class u extends n.BaseTracer{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=(0,s.IterableReadableStream).fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new o({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]})),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new o({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new o({ops:r});await this.writer.write(a)}finally{if(void 0===e.parent_run_id){let t=new o({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){let r=this.keyMapByRunId[e.id];if(void 0===r)return;let a=new o({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(a)}}},{"../utils/fast-json-patch/index.js":"hrFKE","./base.js":"gsfZb","../utils/stream.js":"faNJA","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hrFKE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>s.PatchError),a.export(r,"deepClone",()=>s._deepClone),a.export(r,"escapePathComponent",()=>s.escapePathComponent),a.export(r,"unescapePathComponent",()=>s.unescapePathComponent);var i=e("./src/core.js");a.exportAll(i,r);var n=e("./src/duplex.js");a.exportAll(n,r);var s=e("./src/helpers.js");r.default={...i,JsonPatchError:s.PatchError,deepClone:s._deepClone,escapePathComponent:s.escapePathComponent,unescapePathComponent:s.unescapePathComponent}},{"./src/core.js":"27Wvc","./src/duplex.js":"9JAeY","./src/helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"27Wvc":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>n),a.export(r,"deepClone",()=>s),a.export(r,"getValueByPointer",()=>u),a.export(r,"applyOperation",()=>c),a.export(r,"applyPatch",()=>d),a.export(r,"applyReducer",()=>h),a.export(r,"validator",()=>p),a.export(r,"validate",()=>m),a.export(r,"_areEquals",()=>f);var i=e("./helpers.js");let n=i.PatchError,s=i._deepClone,o={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=u(r,this.path);a&&(a=(0,i._deepClone)(a));let n=c(r,{op:"remove",path:this.from}).removed;return c(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=u(r,this.from);return c(r,{op:"add",path:this.path,value:(0,i._deepClone)(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:f(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var l={add:function(e,t,r){return(0,i.isInteger)(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:o.move,copy:o.copy,test:o.test,_get:o._get};function u(e,t){if(""==t)return e;var r={op:"_get",path:t};return c(e,r),r.value}function c(e,t,r=!1,a=!0,s=!0,c=0){if(r&&("function"==typeof r?r(t,0,e,t.path):p(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=u(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=f(e,t.value),!1===a.test)throw new n("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new n("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",c,t,e)}}{let u,d,h;a||(e=(0,i._deepClone)(e));let m=(t.path||"").split("/"),f=e,g=1,b=m.length;for(d="function"==typeof r?r:p;;){if((u=m[g])&&-1!=u.indexOf("~")&&(u=(0,i.unescapePathComponent)(u)),s&&("__proto__"==u||"prototype"==u&&g>0&&"constructor"==m[g-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===h&&(void 0===f[u]?h=m.slice(0,g).join("/"):g==b-1&&(h=t.path),void 0!==h&&d(t,0,e,h)),g++,Array.isArray(f)){if("-"===u)u=f.length;else{if(r&&!(0,i.isInteger)(u))throw new n("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",c,t,e);(0,i.isInteger)(u)&&(u=~~u)}if(g>=b){if(r&&"add"===t.op&&u>f.length)throw new n("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",c,t,e);let a=l[t.op].call(t,f,u,e);if(!1===a.test)throw new n("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return a}}else if(g>=b){let r=o[t.op].call(t,f,u,e);if(!1===r.test)throw new n("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return r}if(f=f[u],r&&g<b&&(!f||"object"!=typeof f))throw new n("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",c,t,e)}}}function d(e,t,r,a=!0,s=!0){if(r&&!Array.isArray(t))throw new n("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=(0,i._deepClone)(e));let o=Array(t.length);for(let a=0,i=t.length;a<i;a++)o[a]=c(e,t[a],r,!0,s,a),e=o[a].newDocument;return o.newDocument=e,o}function h(e,t,r){let a=c(e,t);if(!1===a.test)throw new n("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function p(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new n("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(o[e.op]){if("string"!=typeof e.path)throw new n("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new n('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new n("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new n("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&(0,i.hasUndefined)(e.value))throw new n("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var s=e.path.split("/").length,l=a.split("/").length;if(s!==l+1&&s!==l)throw new n("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new n("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var u=m([{op:"_get",path:e.from,value:void 0}],r);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new n("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new n("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function m(e,t,r){try{if(!Array.isArray(e))throw new n("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)d((0,i._deepClone)(t),(0,i._deepClone)(e),r||!0);else{r=r||p;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof n)return e;throw e}}function f(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,i,n=Array.isArray(e),s=Array.isArray(t);if(n&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!f(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!f(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}},{"./helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6VGjv":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"hasOwnProperty",()=>n),a.export(r,"_objectKeys",()=>s),a.export(r,"_deepClone",()=>o),a.export(r,"isInteger",()=>l),a.export(r,"escapePathComponent",()=>u),a.export(r,"unescapePathComponent",()=>c),a.export(r,"_getPathRecursive",()=>d),a.export(r,"getPath",()=>h),a.export(r,"hasUndefined",()=>function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=s(t),i=a.length;for(var r=0;r<i;r++)if(e(t[a[r]]))return!0}}return!1}),a.export(r,"PatchError",()=>m);let i=Object.prototype.hasOwnProperty;function n(e,t){return i.call(e,t)}function s(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)n(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function d(e,t){let r;for(let a in e)if(n(e,a)){if(e[a]===t)return u(a)+"/";if("object"==typeof e[a]&&""!=(r=d(e[a],t)))return u(a)+"/"+r}return""}function h(e,t){if(e===t)return"/";let r=d(e,t);if(""===r)throw Error("Object not found in root");return`/${r}`}function p(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class m extends Error{constructor(e,t,r,a,i){super(p(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=p(e,{name:t,index:r,operation:a,tree:i})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9JAeY":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unobserve",()=>u),a.export(r,"observe",()=>c),a.export(r,"generate",()=>d),a.export(r,"compare",()=>p);var i=e("./helpers.js"),n=e("./core.js"),s=new WeakMap;class o{constructor(e){Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.obj=e}}class l{constructor(e,t){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=e,this.observer=t}}function u(e,t){t.unobserve()}function c(e,t){var r,a=s.get(e);if(a){let e=a.observers.get(t);r=e&&e.observer}else a=new o(e),s.set(e,a);if(r)return r;if(r={},a.value=(0,i._deepClone)(e),t){r.callback=t,r.next=null;var n=()=>{d(r)},u=()=>{clearTimeout(r.next),r.next=setTimeout(n)};"undefined"!=typeof window&&(window.addEventListener("mouseup",u),window.addEventListener("keyup",u),window.addEventListener("mousedown",u),window.addEventListener("keydown",u),window.addEventListener("change",u))}return r.patches=[],r.object=e,r.unobserve=()=>{d(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(a,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",u),window.removeEventListener("keyup",u),window.removeEventListener("mousedown",u),window.removeEventListener("keydown",u),window.removeEventListener("change",u))},a.observers.set(t,new l(t,r)),r}function d(e,t=!1){var r=s.get(e.object);h(r.value,e.object,e.patches,"",t),e.patches.length&&(0,n.applyPatch)(r.value,e.patches);var a=e.patches;return a.length>0&&(e.patches=[],e.callback&&e.callback(a)),a}function h(e,t,r,a,n){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=(0,i._objectKeys)(t),o=(0,i._objectKeys)(e),l=!1,u=o.length-1;u>=0;u--){var c=o[u],d=e[c];if((0,i.hasOwnProperty)(t,c)&&!(void 0===t[c]&&void 0!==d&&!1===Array.isArray(t))){var p=t[c];"object"==typeof d&&null!=d&&"object"==typeof p&&null!=p&&Array.isArray(d)===Array.isArray(p)?h(d,p,r,a+"/"+(0,i.escapePathComponent)(c),n):d!==p&&(n&&r.push({op:"test",path:a+"/"+(0,i.escapePathComponent)(c),value:(0,i._deepClone)(d)}),r.push({op:"replace",path:a+"/"+(0,i.escapePathComponent)(c),value:(0,i._deepClone)(p)}))}else Array.isArray(e)===Array.isArray(t)?(n&&r.push({op:"test",path:a+"/"+(0,i.escapePathComponent)(c),value:(0,i._deepClone)(d)}),r.push({op:"remove",path:a+"/"+(0,i.escapePathComponent)(c)}),l=!0):(n&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}))}if(l||s.length!=o.length)for(var u=0;u<s.length;u++){var c=s[u];(0,i.hasOwnProperty)(e,c)||void 0===t[c]||r.push({op:"add",path:a+"/"+(0,i.escapePathComponent)(c),value:(0,i._deepClone)(t[c])})}}}function p(e,t,r=!1){var a=[];return h(e,t,a,"",r),a}},{"./helpers.js":"6VGjv","./core.js":"27Wvc","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],faNJA:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"IterableReadableStream",()=>i);class i extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done&&this.reader.releaseLock(),{done:e.done,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new i({start:e=>(function r(){return t.read().then(({done:t,value:a})=>{if(t){e.close();return}return e.enqueue(a),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new i({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bd9nP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getCallbackMangerForConfig",()=>n),a.export(r,"mergeConfigs",()=>s);var i=e("../callbacks/manager.js");async function n(e){return(0,i.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function s(e,t){let r={...e};if(t)for(let a of Object.keys(t))if("metadata"===a)r[a]={...r[a],...t[a]};else if("tags"===a)r[a]=(r[a]??[]).concat(t[a]??[]);else if("callbacks"===a){let a=r.callbacks,n=t.callbacks??e.callbacks;if(Array.isArray(n)){if(a){if(Array.isArray(a))r.callbacks=a.concat(n);else{let e=a.copy();for(let t of n)e.addHandler(t,!0);r.callbacks=e}}else r.callbacks=n}else if(n){if(a){if(Array.isArray(a)){let e=n.copy();for(let t of a)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=new i.CallbackManager(n.parentRunId,{handlers:a.handlers.concat(n.handlers),inheritableHandlers:a.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(n.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(n.inheritableTags))),metadata:{...a.metadata,...n.metadata}})}else r.callbacks=n}}else r[a]=t[a]??r[a];return r}},{"../callbacks/manager.js":"fZx9W","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l8CrB:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>c);var i=e("p-retry"),n=a.interopDefault(i),s=e("p-queue"),o=a.interopDefault(s);let l=[400,401,402,403,404,405,406,407,408,409],u=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&l.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class c{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??u;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,n.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i5MBm:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RootListenersTracer",()=>n);var i=e("./base.js");class n extends i.BaseTracer{constructor({config:e,onStart:t,onEnd:r,onError:a}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}},{"./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3JDAX":[function(e,t,r){t.exports=e("85a84a52fa3ada83")(e("c7a3a59cb3e15f4a").getBundleURL("kJFUv")+e("4a211097cd3942d7").resolve("iZHrI")).then(()=>t.bundle.root("2Oph6"))},{"85a84a52fa3ada83":"jawFo",c7a3a59cb3e15f4a:"e3Ctf","4a211097cd3942d7":"fcUCD"}],jawFo:[function(e,t,r){var a=e("e18e0f4b8102d3ab");t.exports=a(function(e){return new Promise(function(t,r){try{importScripts(e),t()}catch(e){r(e)}})})},{e18e0f4b8102d3ab:"4mYIR"}],"4mYIR":[function(e,t,r){var a={},i={},n={};t.exports=function(e,t){return function(r){var s=function(e){switch(e){case"preload":return i;case"prefetch":return n;default:return a}}(t);return s[r]?s[r]:s[r]=e.apply(null,arguments).catch(function(e){throw delete s[r],e})}}},{}],e3Ctf:[function(e,t,r){var a={};function i(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}r.getBundleURL=function(e){var t=a[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return i(e[2])}return"/"}(),a[e]=t),t},r.getBaseURL=i,r.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}},{}],fcUCD:[function(e,t,r){var a={};t.exports.register=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},t.exports.resolve=function(e){var t=a[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}},{}],"3t03I":[function(e,t,r){t.exports=e("b5ed352fb4688e2a")(e("5496a4c14683a711").getBundleURL("kJFUv")+e("6e7ada724ff12dc2").resolve("kJFUv")).then(()=>t.bundle.root("dlll3"))},{b5ed352fb4688e2a:"jawFo","5496a4c14683a711":"e3Ctf","6e7ada724ff12dc2":"fcUCD"}],"2ZN2o":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"parseFString",()=>i),a.export(r,"interpolateFString",()=>n),a.export(r,"DEFAULT_FORMATTER_MAPPING",()=>s),a.export(r,"DEFAULT_PARSER_MAPPING",()=>o),a.export(r,"renderTemplate",()=>l),a.export(r,"parseTemplate",()=>u),a.export(r,"checkValidTemplate",()=>c);let i=e=>{let t=e.split(""),r=[],a=(e,r)=>{for(let a=r;a<t.length;a+=1)if(e.includes(t[a]))return a;return -1},i=0;for(;i<t.length;)if("{"===t[i]&&i+1<t.length&&"{"===t[i+1])r.push({type:"literal",text:"{"}),i+=2;else if("}"===t[i]&&i+1<t.length&&"}"===t[i+1])r.push({type:"literal",text:"}"}),i+=2;else if("{"===t[i]){let e=a("}",i);if(e<0)throw Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(i+1,e).join("")}),i=e+1}else if("}"===t[i])throw Error("Single '}' in template.");else{let e=a("{}",i),n=(e<0?t.slice(i):t.slice(i,e)).join("");r.push({type:"literal",text:n}),i=e<0?t.length:e}return r},n=(e,t)=>i(e).reduce((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw Error(`Missing value for input ${r.name}`)}return e+r.text},""),s={"f-string":n},o={"f-string":i},l=(e,t,r)=>s[t](e,r),u=(e,t)=>o[t](e),c=(e,t,r)=>{if(!(t in s)){let e=Object.keys(s);throw Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${e}`)}try{let a=r.reduce((e,t)=>(e[t]="foo",e),{});l(e,t,a)}catch(e){throw Error(`Invalid prompt schema: ${e.message}`)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2Oph6":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"PromptTemplate",()=>s);var i=e("./string.js"),n=e("./template.js");class s extends i.BaseStringPromptTemplate{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,n.checkValidTemplate)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return(0,n.renderTemplate)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a="\n\n",i=""){return new s({inputVariables:r,template:[i,...e,t].join(a)})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){let a=new Set;return(0,n.parseTemplate)(e,t).forEach(e=>{"variable"===e.type&&a.add(e.name)}),new s({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new s({...this,inputVariables:t,partialVariables:r})}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw Error("Prompt template must have a template");return new s({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},{"./string.js":"GINku","./template.js":"2ZN2o","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],e9TQ6:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseMessagePromptTemplate",()=>u),a.export(r,"MessagesPlaceholder",()=>c),a.export(r,"BaseMessageStringPromptTemplate",()=>d),a.export(r,"BaseChatPromptTemplate",()=>h),a.export(r,"ChatMessagePromptTemplate",()=>p),a.export(r,"HumanMessagePromptTemplate",()=>m),a.export(r,"AIMessagePromptTemplate",()=>f),a.export(r,"SystemMessagePromptTemplate",()=>g),a.export(r,"ChatPromptTemplate",()=>b);var i=e("../messages/index.js"),n=e("../prompt_values.js"),s=e("../runnables/base.js"),o=e("./base.js"),l=e("./prompt.js");class u extends s.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class c extends u{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,t){if(!(Array.isArray(e)?e.every(e=>(0,i.isBaseMessage)(e)):(0,i.isBaseMessage)(e))){let r="string"==typeof e?e:JSON.stringify(e,null,2),a=Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${r}`);throw a.name="InputFormatError",a}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]}}class d extends u{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class h extends o.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new n.ChatPromptValue(t)}}class p extends d{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new i.ChatMessage(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this((0,l.PromptTemplate).fromTemplate(e),t)}}class m extends d{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new i.HumanMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class f extends d{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new i.AIMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class g extends d{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new i.SystemMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class b extends h{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=new Set;for(let t of this.promptMessages)if(!(t instanceof i.BaseMessage))for(let r of t.inputVariables)e.add(r);let t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),a=new Set([...r].filter(t=>!e.has(t)));if(a.size>0)throw Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let n=new Set([...e].filter(e=>!r.has(e)));if(n.size>0)throw Error(`Input variables \`${[...n]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let r=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type||"string"==typeof e.image_url||!e.image_url?.url)return e;let r=e.image_url.url,a=(0,l.PromptTemplate).fromTemplate(r),i=await a.format(t);return e.image_url.url=i,e}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let e of this.promptMessages)if(e instanceof i.BaseMessage)r.push(await this._parseImagePrompts(e,t));else{let a=e.inputVariables.reduce((e,r)=>{if(!(r in t))throw Error(`Missing value for input variable \`${r.toString()}\``);return e[r]=t[r],e},{}),i=await e.formatMessages(a);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new b({...this,inputVariables:t,partialVariables:r})}static fromTemplate(e){let t=new m({prompt:(0,l.PromptTemplate).fromTemplate(e)});return this.fromMessages([t])}static fromMessages(e){let t=e.reduce((e,t)=>e.concat(t instanceof b?t.promptMessages:[function(e){if("function"==typeof e.formatMessages||(0,i.isBaseMessage)(e))return e;let t=(0,i.coerceMessageLikeToMessage)(e);if("human"===t._getType())return m.fromTemplate(t.content);if("ai"===t._getType())return f.fromTemplate(t.content);if("system"===t._getType())return g.fromTemplate(t.content);if((0,i.ChatMessage).isInstance(t))return p.fromTemplate(t.content,t.role);throw Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}(t)]),[]),r=e.reduce((e,t)=>t instanceof b?Object.assign(e,t.partialVariables):e,Object.create(null)),a=new Set;for(let e of t)if(!(e instanceof i.BaseMessage))for(let t of e.inputVariables)t in r||a.add(t);return new b({inputVariables:[...a],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}},{"../messages/index.js":"jMGwo","../prompt_values.js":"lGT4D","../runnables/base.js":"1qQoT","./base.js":"579yP","./prompt.js":"2Oph6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}]},["dlll3"],"dlll3","parcelRequire3d47"),globalThis.define=t;