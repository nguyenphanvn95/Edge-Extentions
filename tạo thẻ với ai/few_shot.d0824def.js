var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,a,r,s,i){var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof l[s]&&l[s],p=o.cache||{},n="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function m(e,a){if(!p[e]){if(!t[e]){var r="function"==typeof l[s]&&l[s];if(!a&&r)return r(e,!0);if(o)return o(e,!0);if(n&&"string"==typeof e)return n(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}f.resolve=function(a){var r=t[e][1][a];return null!=r?r:a},f.cache={};var u=p[e]=new m.Module(e);t[e][0].call(u.exports,f,u,u.exports,this)}return p[e].exports;function f(e){var t=f.resolve(e);return!1===t?{}:m(t)}}m.isParcelRequire=!0,m.Module=function(e){this.id=e,this.bundle=m,this.exports={}},m.modules=t,m.cache=p,m.parent=o,m.register=function(e,a){t[e]=[function(e,t){t.exports=a},{}]},Object.defineProperty(m,"root",{get:function(){return l[s]}}),l[s]=m;for(var u=0;u<a.length;u++)m(a[u]);if(r){var f=m(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof e&&e.amd&&e(function(){return f})}}({"99kNl":[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(a),r.export(a,"FewShotPromptTemplate",()=>p),r.export(a,"FewShotChatMessagePromptTemplate",()=>n);var s=e("./string.js"),i=e("./template.js"),l=e("./prompt.js"),o=e("./chat.js");class p extends s.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new p({...this,inputVariables:t,partialVariables:a})}async format(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t),r=await Promise.all(a.map(e=>this.examplePrompt.format(e))),s=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,i.renderTemplate)(s,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t;let{example_prompt:a}=e;if(!a)throw Error("Missing example prompt");let r=await (0,l.PromptTemplate).deserialize(a);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new p({inputVariables:e.input_variables,examplePrompt:r,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class n extends o.BaseChatPromptTemplate{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,i.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t);a=a.map(e=>{let t={};return this.examplePrompt.inputVariables.forEach(a=>{t[a]=e[a]}),t});let r=[];for(let e of a){let t=await this.examplePrompt.formatMessages(e);r.push(...t)}return r}async format(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t),r=(await Promise.all(a.map(e=>this.examplePrompt.formatMessages(e)))).flat().map(e=>e.content),s=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return(0,i.renderTemplate)(s,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new n({...this,inputVariables:t,partialVariables:a})}}},{"./string.js":"aqpn1","./template.js":"1eKek","./prompt.js":"44sow","./chat.js":"jaqMR","@parcel/transformer-js/src/esmodule-helpers.js":"jb2Oh"}],jaqMR:[function(e,t,a){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(a),r.export(a,"BaseMessagePromptTemplate",()=>n),r.export(a,"MessagesPlaceholder",()=>m),r.export(a,"BaseMessageStringPromptTemplate",()=>u),r.export(a,"BaseChatPromptTemplate",()=>f),r.export(a,"ChatMessagePromptTemplate",()=>c),r.export(a,"HumanMessagePromptTemplate",()=>h),r.export(a,"AIMessagePromptTemplate",()=>b),r.export(a,"SystemMessagePromptTemplate",()=>d),r.export(a,"ChatPromptTemplate",()=>g);var s=e("../messages/index.js"),i=e("../prompt_values.js"),l=e("../runnables/base.js"),o=e("./base.js"),p=e("./prompt.js");class n extends l.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class m extends n{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,t){if(!(Array.isArray(e)?e.every(e=>(0,s.isBaseMessage)(e)):(0,s.isBaseMessage)(e))){let a="string"==typeof e?e:JSON.stringify(e,null,2),r=Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${a}`);throw r.name="InputFormatError",r}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]}}class u extends n{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class f extends o.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new i.ChatPromptValue(t)}}class c extends u{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new s.ChatMessage(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this((0,p.PromptTemplate).fromTemplate(e),t)}}class h extends u{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new s.HumanMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,p.PromptTemplate).fromTemplate(e))}}class b extends u{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new s.AIMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,p.PromptTemplate).fromTemplate(e))}}class d extends u{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new s.SystemMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,p.PromptTemplate).fromTemplate(e))}}class g extends f{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=new Set;for(let t of this.promptMessages)if(!(t instanceof s.BaseMessage))for(let a of t.inputVariables)e.add(a);let t=this.inputVariables,a=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),r=new Set([...a].filter(t=>!e.has(t)));if(r.size>0)throw Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);let i=new Set([...e].filter(e=>!a.has(e)));if(i.size>0)throw Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let a=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type||"string"==typeof e.image_url||!e.image_url?.url)return e;let a=e.image_url.url,r=(0,p.PromptTemplate).fromTemplate(a),s=await r.format(t);return e.image_url.url=s,e}));return e.content=a,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=[];for(let e of this.promptMessages)if(e instanceof s.BaseMessage)a.push(await this._parseImagePrompts(e,t));else{let r=e.inputVariables.reduce((e,a)=>{if(!(a in t))throw Error(`Missing value for input variable \`${a.toString()}\``);return e[a]=t[a],e},{}),s=await e.formatMessages(r);a=a.concat(s)}return a}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),a={...this.partialVariables??{},...e};return new g({...this,inputVariables:t,partialVariables:a})}static fromTemplate(e){let t=new h({prompt:(0,p.PromptTemplate).fromTemplate(e)});return this.fromMessages([t])}static fromMessages(e){let t=e.reduce((e,t)=>e.concat(t instanceof g?t.promptMessages:[function(e){if("function"==typeof e.formatMessages||(0,s.isBaseMessage)(e))return e;let t=(0,s.coerceMessageLikeToMessage)(e);if("human"===t._getType())return h.fromTemplate(t.content);if("ai"===t._getType())return b.fromTemplate(t.content);if("system"===t._getType())return d.fromTemplate(t.content);if((0,s.ChatMessage).isInstance(t))return c.fromTemplate(t.content,t.role);throw Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}(t)]),[]),a=e.reduce((e,t)=>t instanceof g?Object.assign(e,t.partialVariables):e,Object.create(null)),r=new Set;for(let e of t)if(!(e instanceof s.BaseMessage))for(let t of e.inputVariables)t in a||r.add(t);return new g({inputVariables:[...r],promptMessages:t,partialVariables:a})}static fromPromptMessages(e){return this.fromMessages(e)}}},{"../messages/index.js":"3Jjkr","../prompt_values.js":"bLGqd","../runnables/base.js":"aHxsd","./base.js":"2t6r4","./prompt.js":"44sow","@parcel/transformer-js/src/esmodule-helpers.js":"jb2Oh"}]},["99kNl"],"99kNl","parcelRequire3d47"),globalThis.define=t;