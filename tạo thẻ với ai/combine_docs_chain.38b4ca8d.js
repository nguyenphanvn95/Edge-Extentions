var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,a,n,s){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof i[n]&&i[n],l=o.cache||{},u="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(e,r){if(!l[e]){if(!t[e]){var a="function"==typeof i[n]&&i[n];if(!r&&a)return a(e,!0);if(o)return o(e,!0);if(u&&"string"==typeof e)return u(e);var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}p.resolve=function(r){var a=t[e][1][r];return null!=a?a:r},p.cache={};var d=l[e]=new c.Module(e);t[e][0].call(d.exports,p,d,d.exports,this)}return l[e].exports;function p(e){var t=p.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=t,c.cache=l,c.parent=o,c.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(c,"root",{get:function(){return i[n]}}),i[n]=c;for(var d=0;d<r.length;d++)c(r[d]);if(a){var p=c(a);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof e&&e.amd&&e(function(){return p})}}({d6V6d:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"StuffDocumentsChain",()=>o),a.export(r,"MapReduceDocumentsChain",()=>l),a.export(r,"RefineDocumentsChain",()=>u);var n=e("./base.js"),s=e("./llm_chain.js"),i=e("../prompts/prompt.js");class o extends n.BaseChain{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(e=>e!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=e.llmChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey}_prepInputs(e){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:t,...r}=e,a=t.map(({pageContent:e})=>e).join("\n\n");return{...r,[this.documentVariableName]:a}}async _call(e,t){return await this.llmChain.call(this._prepInputs(e),t?.getChild("combine_documents"))}_chainType(){return"stuff_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw Error("Missing llm_chain");return new o({llmChain:await (0,s.LLMChain).deserialize(e.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}}class l extends n.BaseChain{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=e.llmChain,this.combineDocumentChain=e.combineDocumentChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.ensureMapStep=e.ensureMapStep??this.ensureMapStep,this.inputKey=e.inputKey??this.inputKey,this.maxTokens=e.maxTokens??this.maxTokens,this.maxIterations=e.maxIterations??this.maxIterations,this.returnIntermediateSteps=e.returnIntermediateSteps??!1}async _call(e,t){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:r,...a}=e,n=r,s=[];for(let e=0;e<this.maxIterations;e+=1){let r=n.map(e=>({[this.documentVariableName]:e.pageContent,...a}));if(0!==e||!this.ensureMapStep){let e=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:n,...a}));if(await this.combineDocumentChain.llmChain._getNumTokens(e)<this.maxTokens)break}let i=await this.llmChain.apply(r,t?Array.from({length:r.length},(e,r)=>t.getChild(`map_${r+1}`)):void 0),{outputKey:o}=this.llmChain;this.returnIntermediateSteps&&(s=s.concat(i.map(e=>e[o]))),n=i.map(e=>({pageContent:e[o],metadata:{}}))}let i={[this.combineDocumentChain.inputKey]:n,...a},o=await this.combineDocumentChain.call(i,t?.getChild("combine_documents"));return this.returnIntermediateSteps?{...o,intermediateSteps:s}:o}_chainType(){return"map_reduce_documents_chain"}static async deserialize(e){if(!e.llm_chain)throw Error("Missing llm_chain");if(!e.combine_document_chain)throw Error("Missing combine_document_chain");return new l({llmChain:await (0,s.LLMChain).deserialize(e.llm_chain),combineDocumentChain:await o.deserialize(e.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}}class u extends n.BaseChain{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new i.PromptTemplate({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(e=>e!==this.documentVariableName&&e!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=e.llmChain,this.refineLLMChain=e.refineLLMChain,this.documentVariableName=e.documentVariableName??this.documentVariableName,this.inputKey=e.inputKey??this.inputKey,this.outputKey=e.outputKey??this.outputKey,this.documentPrompt=e.documentPrompt??this.documentPrompt,this.initialResponseName=e.initialResponseName??this.initialResponseName}async _constructInitialInputs(e,t){let r={page_content:e.pageContent,...e.metadata},a={};return this.documentPrompt.inputVariables.forEach(e=>{a[e]=r[e]}),{[this.documentVariableName]:await this.documentPrompt.format({...a}),...t}}async _constructRefineInputs(e,t){let r={page_content:e.pageContent,...e.metadata},a={};this.documentPrompt.inputVariables.forEach(e=>{a[e]=r[e]});let n={[this.documentVariableName]:await this.documentPrompt.format({...a})};return{[this.initialResponseName]:t,...n}}async _call(e,t){if(!(this.inputKey in e))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:r,...a}=e,n=await this._constructInitialInputs(r[0],a),s=await this.llmChain.predict({...n},t?.getChild("answer")),i=[s];for(let e=1;e<r.length;e+=1){let n={...await this._constructRefineInputs(r[e],s),...a};s=await this.refineLLMChain.predict({...n},t?.getChild("refine")),i.push(s)}return{[this.outputKey]:s}}_chainType(){return"refine_documents_chain"}static async deserialize(e){let t=e.llm_chain;if(!t)throw Error("Missing llm_chain");let r=e.refine_llm_chain;if(!r)throw Error("Missing refine_llm_chain");return new u({llmChain:await (0,s.LLMChain).deserialize(t),refineLLMChain:await (0,s.LLMChain).deserialize(r)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},{"./base.js":"frbpR","./llm_chain.js":"h9Hbj","../prompts/prompt.js":"7jSxq","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],frbpR:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseChain",()=>o);var n=e("../schema/index.js"),s=e("../callbacks/manager.js"),i=e("../base_language/index.js");class o extends i.BaseLangChain{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(1!=arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:r}),this.memory=e;else{let{memory:t,callbackManager:r,...a}=e;super({...a,callbacks:r??a.callbacks}),this.memory=t}}_selectMemoryInputs(e){let t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}_validateOutputs(e){let t=this.outputKeys.filter(t=>!(t in e));if(t.length)throw Error(`Missing output keys: ${t.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(e,t,r=!1){return(this._validateOutputs(t),this.memory&&await this.memory.saveContext(e,t),r)?t:{...e,...t}}serialize(){throw Error("Method not implemented.")}async run(e,t){let r=this.inputKeys.filter(e=>!this.memory?.memoryKeys.includes(e)??!0);if(!(r.length<=1))throw Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);let a=r.length?{[r[0]]:e}:{},n=await this.call(a,t),s=Object.keys(n);if(1===s.length)return n[s[0]];throw Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){let t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory)for(let[r,a]of Object.entries(await this.memory.loadMemoryVariables(this._selectMemoryInputs(e))))t[r]=a;return t}async call(e,t,r){let a;let i=await this._formatValues(e),o=(0,s.parseCallbackConfigArg)(t),l=await (0,s.CallbackManager).configure(o.callbacks,this.callbacks,o.tags||r,this.tags,o.metadata,this.metadata,{verbose:this.verbose}),u=await l?.handleChainStart(this.toJSON(),i,void 0,void 0,void 0,void 0,o.runName);try{a=await (e.signal?Promise.race([this._call(i,u),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this._call(i,u))}catch(e){throw await u?.handleChainError(e),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),a),await u?.handleChainEnd(a),Object.defineProperty(a,n.RUN_KEY,{value:u?{runId:u?.runId}:void 0,configurable:!0}),a}async apply(e,t){return Promise.all(e.map(async(e,r)=>this.call(e,t?.[r])))}static async deserialize(t,r={}){switch(t._type){case"llm_chain":{let{LLMChain:r}=await e("2d811e2b51cdeee3");return r.deserialize(t)}case"sequential_chain":{let{SequentialChain:r}=await e("35f78524e5fc8f7c");return r.deserialize(t)}case"simple_sequential_chain":{let{SimpleSequentialChain:r}=await e("35f78524e5fc8f7c");return r.deserialize(t)}case"stuff_documents_chain":{let{StuffDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"map_reduce_documents_chain":{let{MapReduceDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"refine_documents_chain":{let{RefineDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"vector_db_qa":{let{VectorDBQAChain:a}=await e("2c1a009b6d0f14cc");return a.deserialize(t,r)}case"api_chain":{let{APIChain:r}=await e("4a543ae243292fe");return r.deserialize(t)}default:throw Error(`Invalid prompt type in config: ${t._type}`)}}}},{"../schema/index.js":"gyLhg","../callbacks/manager.js":"4iEvs","../base_language/index.js":"is1pt","2d811e2b51cdeee3":"cmcto","35f78524e5fc8f7c":"7Pmie","97a14159688e6a69":"9ihBC","2c1a009b6d0f14cc":"ec1ui","4a543ae243292fe":"j5Wbw","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],gyLhg:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RUN_KEY",()=>i.RUN_KEY),a.export(r,"BaseMessageChunk",()=>n.BaseMessageChunk),a.export(r,"HumanMessageChunk",()=>n.HumanMessageChunk),a.export(r,"AIMessageChunk",()=>n.AIMessageChunk),a.export(r,"SystemMessageChunk",()=>n.SystemMessageChunk),a.export(r,"FunctionMessage",()=>n.FunctionMessage),a.export(r,"FunctionMessageChunk",()=>n.FunctionMessageChunk),a.export(r,"ToolMessage",()=>n.ToolMessage),a.export(r,"ToolMessageChunk",()=>n.ToolMessageChunk),a.export(r,"ChatMessage",()=>n.ChatMessage),a.export(r,"mapStoredMessageToChatMessage",()=>n.mapStoredMessageToChatMessage),a.export(r,"ChatMessageChunk",()=>n.ChatMessageChunk),a.export(r,"coerceMessageLikeToMessage",()=>n.coerceMessageLikeToMessage),a.export(r,"isBaseMessage",()=>n.isBaseMessage),a.export(r,"isBaseMessageChunk",()=>n.isBaseMessageChunk),a.export(r,"GenerationChunk",()=>i.GenerationChunk),a.export(r,"ChatGenerationChunk",()=>i.ChatGenerationChunk),a.export(r,"BasePromptValue",()=>o.BasePromptValue),a.export(r,"BaseChatMessageHistory",()=>l.BaseChatMessageHistory),a.export(r,"BaseListChatMessageHistory",()=>l.BaseListChatMessageHistory),a.export(r,"BaseCache",()=>u.BaseCache),a.export(r,"BaseMessage",()=>n.BaseMessage),a.export(r,"HumanMessage",()=>n.HumanMessage),a.export(r,"AIMessage",()=>n.AIMessage),a.export(r,"SystemMessage",()=>n.SystemMessage),a.export(r,"BaseChatMessage",()=>c),a.export(r,"HumanChatMessage",()=>d),a.export(r,"AIChatMessage",()=>p),a.export(r,"SystemChatMessage",()=>h),a.export(r,"BaseFileStore",()=>m),a.export(r,"BaseEntityStore",()=>f),a.export(r,"Docstore",()=>g);var n=e("@langchain/core/messages"),s=e("../load/serializable.js"),i=e("@langchain/core/outputs"),o=e("@langchain/core/prompt_values"),l=e("@langchain/core/chat_history"),u=e("@langchain/core/caches");let c=n.BaseMessage,d=n.HumanMessage,p=n.AIMessage,h=n.SystemMessage;class m extends s.Serializable{}class f extends s.Serializable{}class g{}},{"@langchain/core/messages":"avKue","../load/serializable.js":"lzycS","@langchain/core/outputs":"fDkg5","@langchain/core/prompt_values":"5IYhT","@langchain/core/chat_history":"j998g","@langchain/core/caches":"lEHU3","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],avKue:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/messages/index.js");a.exportAll(n,r)},{"./dist/messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jMGwo:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseMessage",()=>i),a.export(r,"BaseMessageChunk",()=>l),a.export(r,"HumanMessage",()=>u),a.export(r,"HumanMessageChunk",()=>c),a.export(r,"AIMessage",()=>d),a.export(r,"AIMessageChunk",()=>p),a.export(r,"SystemMessage",()=>h),a.export(r,"SystemMessageChunk",()=>m),a.export(r,"FunctionMessage",()=>f),a.export(r,"FunctionMessageChunk",()=>g),a.export(r,"ToolMessage",()=>b),a.export(r,"ToolMessageChunk",()=>y),a.export(r,"ChatMessage",()=>v),a.export(r,"isBaseMessage",()=>w),a.export(r,"isBaseMessageChunk",()=>_),a.export(r,"coerceMessageLikeToMessage",()=>j),a.export(r,"ChatMessageChunk",()=>x),a.export(r,"getBufferString",()=>P),a.export(r,"mapStoredMessageToChatMessage",()=>C),a.export(r,"mapStoredMessagesToChatMessages",()=>O),a.export(r,"mapChatMessagesToStoredMessages",()=>T);var n=e("../load/serializable.js");function s(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class i extends n.Serializable{get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){let e=this._getType();if("human"===e)return new c({...this});if("ai"===e)return new p({...this});if("system"===e)return new m({...this});if("function"===e)return new g({...this});if(v.isInstance(this))return new x({...this});throw Error("Unknown message type.")}}function o(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}class l extends i{static _mergeAdditionalKwargs(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(void 0===r[e])r[e]=a;else if(typeof r[e]!=typeof a)throw Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"===e&&o(r[e])&&o(a))for(let t of a)r[e]?.[t.index]!==void 0?r[e]=r[e]?.map((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}}):r[e][t.index]=t;else throw Error(`additional_kwargs[${e}] already exists in this message chunk.`)}else r[e]=this._mergeAdditionalKwargs(r[e],a);return r}}class u extends i{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class c extends l{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new c({content:s(this.content,e.content),additional_kwargs:c._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class d extends i{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class p extends l{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new p({content:s(this.content,e.content),additional_kwargs:p._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends i{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class m extends l{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new m({content:s(this.content,e.content),additional_kwargs:m._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class f extends i{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class g extends l{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new g({content:s(this.content,e.content),additional_kwargs:g._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class b extends i{static lc_name(){return"ToolMessage"}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}}class y extends l{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new y({content:s(this.content,e.content),additional_kwargs:y._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class v extends i{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function w(e){return"function"==typeof e?._getType}function _(e){return w(e)&&"function"==typeof e.concat}function j(e){if("string"==typeof e)return new u(e);if(w(e))return e;let[t,r]=e;if("human"===t||"user"===t)return new u({content:r});if("ai"===t||"assistant"===t)return new d({content:r});if("system"===t)return new h({content:r});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class x extends l{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new x({content:s(this.content,e.content),additional_kwargs:x._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function P(e,t="Human",r="AI"){let a=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let s=n.name?`${n.name}, `:"";a.push(`${e}: ${s}${n.content}`)}return a.join("\n")}function C(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new u(t.data);case"ai":return new d(t.data);case"system":return new h(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new f(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new b(t.data);case"chat":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new v(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function O(e){return e.map(C)}function T(e){return e.map(e=>e.toDict())}},{"../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ihLrn:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"get_lc_unique_name",()=>i),a.export(r,"Serializable",()=>o);var n=e("./map_keys.js");function s(e){return Array.isArray(e)?[...e]:{...e}}function i(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,i(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[n,...s]=e.split(".").reverse();for(let e of s.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}n in t&&void 0!==t[n]&&(a[n]=a[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:(0,n.mapKeys)(Object.keys(t).length?function(e,t){let r=s(e);for(let[e,a]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),i=r;for(let e of n.reverse()){if(void 0===i[e])break;i[e]=s(i[e]),i=i[e]}void 0!==i[t]&&(i[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,n.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},{"./map_keys.js":"icngQ","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],icngQ:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"keyToJson",()=>l),a.export(r,"keyFromJson",()=>u),a.export(r,"mapKeys",()=>c);var n=e("decamelize"),s=a.interopDefault(n),i=e("camelcase"),o=a.interopDefault(i);function l(e,t){return t?.[e]||(0,s.default)(e)}function u(e,t){return t?.[e]||(0,o.default)(e)}function c(e,t,r){let a={};for(let n in e)Object.hasOwn(e,n)&&(a[t(n,r)]=e[n]);return a}},{decamelize:"ilxwq",camelcase:"9qpt6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ilxwq:[function(e,t,r){t.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},{}],"9qpt6":[function(e,t,r){let a=/[\p{Lu}]/u,n=/[\p{Ll}]/u,s=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,o=/[_.\- ]+/,l=RegExp("^"+o.source),u=RegExp(o.source+i.source,"gu"),c=RegExp("\\d+"+i.source,"gu"),d=(e,t,r)=>{let s=!1,i=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];s&&a.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),s=!1,o=i,i=!0,l++):i&&o&&n.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=i,i=!1,s=!0):(s=t(u)===u&&r(u)!==u,o=i,i=r(u)===u&&t(u)!==u)}return e},p=(e,t)=>(s.lastIndex=0,e.replace(s,e=>t(e))),h=(e,t)=>(u.lastIndex=0,c.lastIndex=0,e.replace(u,(e,r)=>t(r)).replace(c,e=>t(e))),m=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?a(e):r(e):(e!==r(e)&&(e=d(e,r,a)),e=e.replace(l,""),e=t.preserveConsecutiveUppercase?p(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),h(e,a))};t.exports=m,t.exports.default=m},{}],"2SNmR":[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],lzycS:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("@langchain/core/load/serializable");a.exportAll(n,r)},{"@langchain/core/load/serializable":"5ijQI","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5ijQI":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/load/serializable.js");a.exportAll(n,r)},{"../dist/load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fDkg5:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/outputs.js");a.exportAll(n,r)},{"./dist/outputs.js":"l1AvI","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l1AvI:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RUN_KEY",()=>n),a.export(r,"GenerationChunk",()=>s),a.export(r,"ChatGenerationChunk",()=>i);let n="__run";class s{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new s({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class i extends s{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5IYhT":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/prompt_values.js");a.exportAll(n,r)},{"./dist/prompt_values.js":"lGT4D","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lGT4D:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptValue",()=>i),a.export(r,"StringPromptValue",()=>o),a.export(r,"ChatPromptValue",()=>l);var n=e("./load/serializable.js"),s=e("./messages/index.js");class i extends n.Serializable{}class o extends i{constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new s.HumanMessage(this.value)]}}class l extends i{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,s.getBufferString)(this.messages)}toChatMessages(){return this.messages}}},{"./load/serializable.js":"ihLrn","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],j998g:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/chat_history.js");a.exportAll(n,r)},{"./dist/chat_history.js":"3VCHZ","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3VCHZ":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseChatMessageHistory",()=>i),a.export(r,"BaseListChatMessageHistory",()=>o);var n=e("./load/serializable.js"),s=e("./messages/index.js");class i extends n.Serializable{}class o extends n.Serializable{addUserMessage(e){return this.addMessage(new s.HumanMessage(e))}addAIChatMessage(e){return this.addMessage(new s.AIMessage(e))}}},{"./load/serializable.js":"ihLrn","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lEHU3:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/caches.js");a.exportAll(n,r)},{"./dist/caches.js":"etUzK","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],etUzK:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getCacheKey",()=>i),a.export(r,"deserializeStoredGeneration",()=>o),a.export(r,"serializeGeneration",()=>l),a.export(r,"BaseCache",()=>u),a.export(r,"InMemoryCache",()=>d);var n=e("./utils/hash.js"),s=e("./messages/index.js");let i=(...e)=>(0,n.insecureHash)(e.join("_"));function o(e){return void 0!==e.message?{text:e.text,message:(0,s.mapStoredMessageToChatMessage)(e.message)}:{text:e.text}}function l(e){let t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t}class u{}let c=new Map;class d extends u{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(i(e,t))??null)}async update(e,t,r){this.cache.set(i(e,t),r)}static global(){return new d(c)}}},{"./utils/hash.js":"7B4Xv","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7B4Xv":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"insecureHash",()=>n.insecureHash);var n=e("./js-sha1/hash.js")},{"./js-sha1/hash.js":"ee2G9","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ee2G9:[function(e,t,r){/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"insecureHash",()=>c);var n="object"==typeof window?window:{},s="0123456789abcdef".split(""),i=[-2147483648,8388608,32768,128],o=[24,16,8,0],l=[];function u(e){e?(l[0]=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0,this.blocks=l):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}u.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===n.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,s=0,i=e.length||0,l=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),t)for(a=this.start;s<i&&a<64;++s)l[a>>2]|=e[s]<<o[3&a++];else for(a=this.start;s<i&&a<64;++s)(r=e.charCodeAt(s))<128?l[a>>2]|=r<<o[3&a++]:(r<2048?l[a>>2]|=(192|r>>6)<<o[3&a++]:(r<55296||r>=57344?l[a>>2]|=(224|r>>12)<<o[3&a++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++s)),l[a>>2]|=(240|r>>18)<<o[3&a++],l[a>>2]|=(128|r>>12&63)<<o[3&a++]),l[a>>2]|=(128|r>>6&63)<<o[3&a++]),l[a>>2]|=(128|63&r)<<o[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=l[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},u.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=i[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},u.prototype.hash=function(){var e,t,r,a=this.h0,n=this.h1,s=this.h2,i=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=n&s|~n&i,o=(r=a<<5|a>>>27)+e+o+1518500249+l[t]<<0,e=a&(n=n<<30|n>>>2)|~a&s,i=(r=o<<5|o>>>27)+e+i+1518500249+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|~o&n,s=(r=i<<5|i>>>27)+e+s+1518500249+l[t+2]<<0,e=i&(o=o<<30|o>>>2)|~i&a,n=(r=s<<5|s>>>27)+e+n+1518500249+l[t+3]<<0,e=s&(i=i<<30|i>>>2)|~s&o,a=(r=n<<5|n>>>27)+e+a+1518500249+l[t+4]<<0,s=s<<30|s>>>2;for(;t<40;t+=5)e=n^s^i,o=(r=a<<5|a>>>27)+e+o+1859775393+l[t]<<0,e=a^(n=n<<30|n>>>2)^s,i=(r=o<<5|o>>>27)+e+i+1859775393+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,s=(r=i<<5|i>>>27)+e+s+1859775393+l[t+2]<<0,e=i^(o=o<<30|o>>>2)^a,n=(r=s<<5|s>>>27)+e+n+1859775393+l[t+3]<<0,e=s^(i=i<<30|i>>>2)^o,a=(r=n<<5|n>>>27)+e+a+1859775393+l[t+4]<<0,s=s<<30|s>>>2;for(;t<60;t+=5)e=n&s|n&i|s&i,o=(r=a<<5|a>>>27)+e+o-1894007588+l[t]<<0,e=a&(n=n<<30|n>>>2)|a&s|n&s,i=(r=o<<5|o>>>27)+e+i-1894007588+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|o&n|a&n,s=(r=i<<5|i>>>27)+e+s-1894007588+l[t+2]<<0,e=i&(o=o<<30|o>>>2)|i&a|o&a,n=(r=s<<5|s>>>27)+e+n-1894007588+l[t+3]<<0,e=s&(i=i<<30|i>>>2)|s&o|i&o,a=(r=n<<5|n>>>27)+e+a-1894007588+l[t+4]<<0,s=s<<30|s>>>2;for(;t<80;t+=5)e=n^s^i,o=(r=a<<5|a>>>27)+e+o-899497514+l[t]<<0,e=a^(n=n<<30|n>>>2)^s,i=(r=o<<5|o>>>27)+e+i-899497514+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,s=(r=i<<5|i>>>27)+e+s-899497514+l[t+2]<<0,e=i^(o=o<<30|o>>>2)^a,n=(r=s<<5|s>>>27)+e+n-899497514+l[t+3]<<0,e=s^(i=i<<30|i>>>2)^o,a=(r=n<<5|n>>>27)+e+a-899497514+l[t+4]<<0,s=s<<30|s>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+n<<0,this.h2=this.h2+s<<0,this.h3=this.h3+i<<0,this.h4=this.h4+o<<0},u.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return s[e>>28&15]+s[e>>24&15]+s[e>>20&15]+s[e>>16&15]+s[e>>12&15]+s[e>>8&15]+s[e>>4&15]+s[15&e]+s[t>>28&15]+s[t>>24&15]+s[t>>20&15]+s[t>>16&15]+s[t>>12&15]+s[t>>8&15]+s[t>>4&15]+s[15&t]+s[r>>28&15]+s[r>>24&15]+s[r>>20&15]+s[r>>16&15]+s[r>>12&15]+s[r>>8&15]+s[r>>4&15]+s[15&r]+s[a>>28&15]+s[a>>24&15]+s[a>>20&15]+s[a>>16&15]+s[a>>12&15]+s[a>>8&15]+s[a>>4&15]+s[15&a]+s[n>>28&15]+s[n>>24&15]+s[n>>20&15]+s[n>>16&15]+s[n>>12&15]+s[n>>8&15]+s[n>>4&15]+s[15&n]},u.prototype.toString=u.prototype.hex,u.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n]},u.prototype.array=u.prototype.digest,u.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let c=e=>new u(!0).update(e).hex()},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4iEvs":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("@langchain/core/callbacks/manager");a.exportAll(n,r)},{"@langchain/core/callbacks/manager":"9q1Cx","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9q1Cx":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/callbacks/manager.js");a.exportAll(n,r)},{"../dist/callbacks/manager.js":"fZx9W","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fZx9W:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"parseCallbackConfigArg",()=>p),a.export(r,"BaseCallbackManager",()=>h),a.export(r,"CallbackManagerForRetrieverRun",()=>f),a.export(r,"CallbackManagerForLLMRun",()=>g),a.export(r,"CallbackManagerForChainRun",()=>b),a.export(r,"CallbackManagerForToolRun",()=>y),a.export(r,"CallbackManager",()=>v),a.export(r,"TraceGroup",()=>_),a.export(r,"traceAsGroup",()=>j);var n=e("uuid"),s=e("./base.js"),i=e("../tracers/console.js"),o=e("../tracers/initialize.js"),l=e("../messages/index.js"),u=e("../utils/env.js"),c=e("../tracers/tracer_langchain.js"),d=e("./promises.js");function p(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class h{setHandler(e){return this.setHandlers([e])}}class m{constructor(e,t,r,a,n,s,i,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}},t.awaitHandlers)))}}class f extends m{getChild(e){let t=new v(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}},t.awaitHandlers)))}}class g extends m{async handleLLMNewToken(e,t,r,a,n,s){await Promise.all(this.handlers.map(r=>(0,d.consumeCallback)(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}},t.awaitHandlers)))}}class b extends m{getChild(e){let t=new v(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,n){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,n){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}},t.awaitHandlers)))}}class y extends m{getChild(e){let t=new v(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>(0,d.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}},t.awaitHandlers)))}}class v extends h{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r,a,s,i,o,l){return Promise.all(t.map(async t=>{let r=(0,n.v4)();return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreLLM)try{await a.handleLLMStart?.(e,[t],r,this._parentRunId,s,this.tags,this.metadata,l)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,s,i,o,u){return Promise.all(t.map(async t=>{let r=(0,n.v4)();return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await a.handleChatModelStart?.(e,[t],r,this._parentRunId,s,this.tags,this.metadata,u);else if(a.handleLLMStart){let n=(0,l.getBufferString)(t);await a.handleLLMStart?.(e,[n],r,this._parentRunId,s,this.tags,this.metadata,u)}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,n.v4)(),a,s,i,o){return await Promise.all(this.handlers.map(n=>(0,d.consumeCallback)(async()=>{if(!n.ignoreChain)try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(e){console.error(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`)}},n.awaitHandlers))),new b(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.v4)(),a,s,i,o){return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreAgent)try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}},a.awaitHandlers))),new y(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.v4)(),a,s,i,o){return await Promise.all(this.handlers.map(a=>(0,d.consumeCallback)(async()=>{if(!a.ignoreRetriever)try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}},a.awaitHandlers))),new f(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new v(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends s.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.v4)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,n,s,l){let c;(e||t)&&(Array.isArray(e)||!e?(c=new v).setHandlers(e?.map(w)??[],!0):c=e,c=c.copy(Array.isArray(t)?t.map(w):t?.handlers,!1));let d="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||l?.verbose,p="true"===(0,u.getEnvironmentVariable)("LANGCHAIN_TRACING_V2"),h=p||((0,u.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(d||h){if(c||(c=new v),d&&!c.handlers.some(e=>e.name===i.ConsoleCallbackHandler.prototype.name)){let e=new i.ConsoleCallbackHandler;c.addHandler(e,!0)}if(h&&!c.handlers.some(e=>"langchain_tracer"===e.name)){if(p)c.addHandler(await (0,o.getTracingV2CallbackHandler)(),!0);else{let e=(0,u.getEnvironmentVariable)("LANGCHAIN_PROJECT")&&(0,u.getEnvironmentVariable)("LANGCHAIN_SESSION");c.addHandler(await (0,o.getTracingCallbackHandler)(e),!0)}}}return(r||a)&&c&&(c.addTags(r??[]),c.addTags(a??[],!1)),(n||s)&&c&&(c.addMetadata(n??{}),c.addMetadata(s??{},!1)),c}}function w(e){return"name"in e?e:(0,s.BaseCallbackHandler).fromMethods(e)}class _{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){let a=new c.LangChainTracer(r),n=await v.configure([a]),s=await n?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{});if(!s)throw Error("Failed to create run group callback manager.");return s}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}async function j(e,t,...r){let a=new _(e.name,e),n=await a.start({...r});try{let e=await t(n,...r);return await a.end(e&&!Array.isArray(e)&&"object"==typeof e?e:{output:e}),e}catch(e){throw await a.error(e),e}}},{uuid:"l36KR","./base.js":"f3sIf","../tracers/console.js":"fPFQ8","../tracers/initialize.js":"kuqFT","../messages/index.js":"jMGwo","../utils/env.js":"2Th20","../tracers/tracer_langchain.js":"dB0hq","./promises.js":"3BeNh","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l36KR:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"v1",()=>s.default),a.export(r,"v3",()=>o.default),a.export(r,"v4",()=>u.default),a.export(r,"v5",()=>d.default),a.export(r,"NIL",()=>h.default),a.export(r,"version",()=>f.default),a.export(r,"validate",()=>b.default),a.export(r,"stringify",()=>v.default),a.export(r,"parse",()=>_.default);var n=e("./v1.js"),s=a.interopDefault(n),i=e("./v3.js"),o=a.interopDefault(i),l=e("./v4.js"),u=a.interopDefault(l),c=e("./v5.js"),d=a.interopDefault(c),p=e("./nil.js"),h=a.interopDefault(p),m=e("./version.js"),f=a.interopDefault(m),g=e("./validate.js"),b=a.interopDefault(g),y=e("./stringify.js"),v=a.interopDefault(y),w=e("./parse.js"),_=a.interopDefault(w)},{"./v1.js":"3PHPC","./v3.js":"3Iz16","./v4.js":"fCvRE","./v5.js":"8bhSy","./nil.js":"8P8RR","./version.js":"amAFP","./validate.js":"dtbjp","./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3PHPC":[function(e,t,r){let a,n;var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r);var i=e("./rng.js"),o=s.interopDefault(i),l=e("./stringify.js");let u=0,c=0;r.default=function(e,t,r){let s=t&&r||0,i=t||Array(16),d=(e=e||{}).node||a,p=void 0!==e.clockseq?e.clockseq:n;if(null==d||null==p){let t=e.random||(e.rng||(0,o.default))();null==d&&(d=a=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==p&&(p=n=(t[6]<<8|t[7])&16383)}let h=void 0!==e.msecs?e.msecs:Date.now(),m=void 0!==e.nsecs?e.nsecs:c+1,f=h-u+(m-c)/1e4;if(f<0&&void 0===e.clockseq&&(p=p+1&16383),(f<0||h>u)&&void 0===e.nsecs&&(m=0),m>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");u=h,c=m,n=p;let g=((268435455&(h+=122192928e5))*1e4+m)%4294967296;i[s++]=g>>>24&255,i[s++]=g>>>16&255,i[s++]=g>>>8&255,i[s++]=255&g;let b=h/4294967296*1e4&268435455;i[s++]=b>>>8&255,i[s++]=255&b,i[s++]=b>>>24&15|16,i[s++]=b>>>16&255,i[s++]=p>>>8|128,i[s++]=255&p;for(let e=0;e<6;++e)i[s+e]=d[e];return t||(0,l.unsafeStringify)(i)}},{"./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5NLI7":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",()=>i);let s=new Uint8Array(16);function i(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cQV7f:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unsafeStringify",()=>o);var n=e("./validate.js"),s=a.interopDefault(n);let i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function o(e,t=0){return i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]}r.default=function(e,t=0){let r=o(e,t);if(!(0,s.default)(r))throw TypeError("Stringified UUID is invalid");return r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dtbjp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./regex.js"),s=a.interopDefault(n);r.default=function(e){return"string"==typeof e&&(0,s.default).test(e)}},{"./regex.js":"8c6XP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8c6XP":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3Iz16":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./v35.js"),s=a.interopDefault(n),i=e("./md5.js"),o=a.interopDefault(i);let l=(0,s.default)("v3",48,o.default);r.default=l},{"./v35.js":"izhU4","./md5.js":"i4R3s","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],izhU4:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"DNS",()=>o),a.export(r,"URL",()=>l),a.export(r,"default",()=>u);var n=e("./stringify.js"),s=e("./parse.js"),i=a.interopDefault(s);let o="6ba7b810-9dad-11d1-80b4-00c04fd430c8",l="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function u(e,t,r){function a(e,a,s,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof a&&(a=(0,i.default)(a)),(null===(l=a)||void 0===l?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+e.length);if(u.set(a),u.set(e,a.length),(u=r(u))[6]=15&u[6]|t,u[8]=63&u[8]|128,s){o=o||0;for(let e=0;e<16;++e)s[o+e]=u[e];return s}return(0,n.unsafeStringify)(u)}try{a.name=e}catch(e){}return a.DNS=o,a.URL=l,a}},{"./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],aFeXC:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./validate.js"),s=a.interopDefault(n);r.default=function(e){let t;if(!(0,s.default)(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i4R3s:[function(e,t,r){function a(e){return(e+64>>>9<<4)+14+1}function n(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,a,s,i){var o;return n((o=n(n(t,e),n(a,i)))<<s|o>>>32-s,r)}function i(e,t,r,a,n,i,o){return s(t&r|~t&a,e,t,n,i,o)}function o(e,t,r,a,n,i,o){return s(t&a|r&~a,e,t,n,i,o)}function l(e,t,r,a,n,i,o){return s(t^r^a,e,t,n,i,o)}function u(e,t,r,a,n,i,o){return s(r^(t|~a),e,t,n,i,o)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){let t=[],r=32*e.length,a="0123456789abcdef";for(let n=0;n<r;n+=8){let r=e[n>>5]>>>n%32&255,s=parseInt(a.charAt(r>>>4&15)+a.charAt(15&r),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[a(t)-1]=t;let r=1732584193,s=-271733879,c=-1732584194,d=271733878;for(let t=0;t<e.length;t+=16){let a=r,p=s,h=c,m=d;r=i(r,s,c,d,e[t],7,-680876936),d=i(d,r,s,c,e[t+1],12,-389564586),c=i(c,d,r,s,e[t+2],17,606105819),s=i(s,c,d,r,e[t+3],22,-1044525330),r=i(r,s,c,d,e[t+4],7,-176418897),d=i(d,r,s,c,e[t+5],12,1200080426),c=i(c,d,r,s,e[t+6],17,-1473231341),s=i(s,c,d,r,e[t+7],22,-45705983),r=i(r,s,c,d,e[t+8],7,1770035416),d=i(d,r,s,c,e[t+9],12,-1958414417),c=i(c,d,r,s,e[t+10],17,-42063),s=i(s,c,d,r,e[t+11],22,-1990404162),r=i(r,s,c,d,e[t+12],7,1804603682),d=i(d,r,s,c,e[t+13],12,-40341101),c=i(c,d,r,s,e[t+14],17,-1502002290),s=i(s,c,d,r,e[t+15],22,1236535329),r=o(r,s,c,d,e[t+1],5,-165796510),d=o(d,r,s,c,e[t+6],9,-1069501632),c=o(c,d,r,s,e[t+11],14,643717713),s=o(s,c,d,r,e[t],20,-373897302),r=o(r,s,c,d,e[t+5],5,-701558691),d=o(d,r,s,c,e[t+10],9,38016083),c=o(c,d,r,s,e[t+15],14,-660478335),s=o(s,c,d,r,e[t+4],20,-405537848),r=o(r,s,c,d,e[t+9],5,568446438),d=o(d,r,s,c,e[t+14],9,-1019803690),c=o(c,d,r,s,e[t+3],14,-187363961),s=o(s,c,d,r,e[t+8],20,1163531501),r=o(r,s,c,d,e[t+13],5,-1444681467),d=o(d,r,s,c,e[t+2],9,-51403784),c=o(c,d,r,s,e[t+7],14,1735328473),s=o(s,c,d,r,e[t+12],20,-1926607734),r=l(r,s,c,d,e[t+5],4,-378558),d=l(d,r,s,c,e[t+8],11,-2022574463),c=l(c,d,r,s,e[t+11],16,1839030562),s=l(s,c,d,r,e[t+14],23,-35309556),r=l(r,s,c,d,e[t+1],4,-1530992060),d=l(d,r,s,c,e[t+4],11,1272893353),c=l(c,d,r,s,e[t+7],16,-155497632),s=l(s,c,d,r,e[t+10],23,-1094730640),r=l(r,s,c,d,e[t+13],4,681279174),d=l(d,r,s,c,e[t],11,-358537222),c=l(c,d,r,s,e[t+3],16,-722521979),s=l(s,c,d,r,e[t+6],23,76029189),r=l(r,s,c,d,e[t+9],4,-640364487),d=l(d,r,s,c,e[t+12],11,-421815835),c=l(c,d,r,s,e[t+15],16,530742520),s=l(s,c,d,r,e[t+2],23,-995338651),r=u(r,s,c,d,e[t],6,-198630844),d=u(d,r,s,c,e[t+7],10,1126891415),c=u(c,d,r,s,e[t+14],15,-1416354905),s=u(s,c,d,r,e[t+5],21,-57434055),r=u(r,s,c,d,e[t+12],6,1700485571),d=u(d,r,s,c,e[t+3],10,-1894986606),c=u(c,d,r,s,e[t+10],15,-1051523),s=u(s,c,d,r,e[t+1],21,-2054922799),r=u(r,s,c,d,e[t+8],6,1873313359),d=u(d,r,s,c,e[t+15],10,-30611744),c=u(c,d,r,s,e[t+6],15,-1560198380),s=u(s,c,d,r,e[t+13],21,1309151649),r=u(r,s,c,d,e[t+4],6,-145523070),d=u(d,r,s,c,e[t+11],10,-1120210379),c=u(c,d,r,s,e[t+2],15,718787259),s=u(s,c,d,r,e[t+9],21,-343485551),r=n(r,a),s=n(s,p),c=n(c,h),d=n(d,m)}return[r,s,c,d]}(function(e){if(0===e.length)return[];let t=8*e.length,r=new Uint32Array(a(t));for(let a=0;a<t;a+=8)r[a>>5]|=(255&e[a/8])<<a%32;return r}(e),8*e.length))}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fCvRE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./native.js"),s=a.interopDefault(n),i=e("./rng.js"),o=a.interopDefault(i),l=e("./stringify.js");r.default=function(e,t,r){if(s.default.randomUUID&&!t&&!e)return(0,s.default).randomUUID();let a=(e=e||{}).random||(e.rng||(0,o.default))();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return(0,l.unsafeStringify)(a)}},{"./native.js":"36JDj","./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"36JDj":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let a="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);r.default={randomUUID:a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8bhSy":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./v35.js"),s=a.interopDefault(n),i=e("./sha1.js"),o=a.interopDefault(i);let l=(0,s.default)("v5",80,o.default);r.default=l},{"./v35.js":"izhU4","./sha1.js":"57fIB","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"57fIB":[function(e,t,r){function a(e,t){return e<<t|e>>>32-t}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=Math.ceil((e.length/4+2)/16),s=Array(n);for(let t=0;t<n;++t){let r=new Uint32Array(16);for(let a=0;a<16;++a)r[a]=e[64*t+4*a]<<24|e[64*t+4*a+1]<<16|e[64*t+4*a+2]<<8|e[64*t+4*a+3];s[t]=r}s[n-1][14]=(e.length-1)*8/4294967296,s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(e.length-1)*8&4294967295;for(let e=0;e<n;++e){let n=new Uint32Array(80);for(let t=0;t<16;++t)n[t]=s[e][t];for(let e=16;e<80;++e)n[e]=a(n[e-3]^n[e-8]^n[e-14]^n[e-16],1);let i=r[0],o=r[1],l=r[2],u=r[3],c=r[4];for(let e=0;e<80;++e){let r=Math.floor(e/20),s=a(i,5)+function(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}(r,o,l,u)+c+t[r]+n[e]>>>0;c=u,u=l,l=a(o,30)>>>0,o=i,i=s}r[0]=r[0]+i>>>0,r[1]=r[1]+o>>>0,r[2]=r[2]+l>>>0,r[3]=r[3]+u>>>0,r[4]=r[4]+c>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8P8RR":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default="00000000-0000-0000-0000-000000000000"},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],amAFP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./validate.js"),s=a.interopDefault(n);r.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],f3sIf:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseCallbackHandler",()=>l);var n=e("uuid"),s=e("../load/serializable.js"),i=e("19649504761b54db");class o{}class l extends o{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,s.get_lc_unique_name)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0===i||i.env?.LANGCHAIN_CALLBACKS_BACKGROUND!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return(0,s.Serializable).prototype.toJSON.call(this)}toJSONNotImplemented(){return(0,s.Serializable).prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n.v4()}),Object.assign(this,e)}}}}},{"19649504761b54db":"7XEqq",uuid:"l36KR","../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7XEqq":[function(e,t,r){let a,n,s,i;var o=Object.create,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,d=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,h=(e,t,r,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of c(t))p.call(e,n)||n===r||l(e,n,{get:()=>t[n],enumerable:!(a=u(t,n))||a.enumerable});return e},m=(e,t,r)=>(r=null!=e?o(d(e)):{},h(!t&&e&&e.__esModule?r:l(r,"default",{value:e,enumerable:!0}),e)),f=(a=(e,t)=>{var r,a,n=t.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var l,u=[],c=!1,d=-1;function p(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=o(p);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}},()=>(n||a((n={exports:{}}).exports,n),n.exports)),g={};((e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})})(g,{default:()=>y}),t.exports=h(l({},"__esModule",{value:!0}),g);var b=m(f());s=m(f()),i=t.exports,h(g,s,"default"),i&&h(i,s,"default");var y=b.default},{}],fPFQ8:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"ConsoleCallbackHandler",()=>d);var n=e("ansi-styles"),s=a.interopDefault(n),i=e("./base.js");function o(e,t){return`${e.open}${t}${e.close}`}function l(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function u(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:c}=s.default;class d extends i.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(s.default.bold,a):a}).join(" > ");return o(c.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[chain/start]")} [${t}] Entering Chain run with input: ${l(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[chain/end]")} [${t}] [${u(e)}] Exiting Chain run with output: ${l(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[chain/error]")} [${t}] [${u(e)}] Chain run errored with error: ${l(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${o(c.green,"[llm/start]")} [${t}] Entering LLM run with input: ${l(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[llm/end]")} [${t}] [${u(e)}] Exiting LLM run with output: ${l(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[llm/error]")} [${t}] [${u(e)}] LLM run errored with error: ${l(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[tool/end]")} [${t}] [${u(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[tool/error]")} [${t}] [${u(e)}] Tool run errored with error: ${l(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${l(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.cyan,"[retriever/end]")} [${t}] [${u(e)}] Exiting Retriever run with output: ${l(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.red,"[retriever/error]")} [${t}] [${u(e)}] Retriever run errored with error: ${l(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${o(c.blue,"[agent/action]")} [${t}] Agent selected action: ${l(e.actions[e.actions.length-1],"[action]")}`)}}},{"ansi-styles":"26v5d","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"26v5d":[function(e,t,r){let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,n=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(t,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,n]of Object.entries(a))t[r]={open:`\u001B[${n[0]}m`,close:`\u001B[${n[1]}m`},a[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=n(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=n(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},{}],gsfZb:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseTracer",()=>i);var n=e("../callbacks/base.js");function s(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class i extends n.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){if(void 0!==e.parent_run_id){let t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e),await this.onRunCreate?.(e)}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,n,s,i,o){let l=this._getExecutionOrder(a),u=Date.now(),c=i?{...n,metadata:i}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:s||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleChatModelStart(e,t,r,a,n,s,i,o){let l=this._getExecutionOrder(a),u=Date.now(),c=i?{...n,metadata:i}:n,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:s||[]};return await this._startTrace(d),await this.onLLMStart?.(d),d}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}async handleChainStart(e,t,r,a,n,s,i,o){let l=this._getExecutionOrder(a),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:i??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:n||[]};return await this._startTrace(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,r,a,n){let i=this.runMap.get(t);if(!i)throw Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=s(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),n?.inputs!==void 0&&(i.inputs=s(n.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,a,n){let i=this.runMap.get(t);if(!i)throw Error("No chain run to end.");return i.end_time=Date.now(),i.error=e.message,i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),n?.inputs!==void 0&&(i.inputs=s(n.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}async handleToolStart(e,t,r,a,n,s,i){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:i??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:n||[]};return await this._startTrace(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}async handleRetrieverStart(e,t,r,a,n,s,i){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:i??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:n||[]};return await this._startTrace(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,n,s){let i=this.runMap.get(r);if(!i||i?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return i.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s?.chunk}}),await this.onLLMNewToken?.(i,e),i}}},{"../callbacks/base.js":"f3sIf","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kuqFT:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getTracingCallbackHandler",()=>i),a.export(r,"getTracingV2CallbackHandler",()=>o);var n=e("./tracer_langchain.js"),s=e("./tracer_langchain_v1.js");async function i(e){let t=new s.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t}async function o(){return new n.LangChainTracer}},{"./tracer_langchain.js":"dB0hq","./tracer_langchain_v1.js":"Pa0ga","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dB0hq:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracer",()=>o);var n=e("langsmith"),s=e("../utils/env.js"),i=e("./base.js");class o extends i.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,s.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,s.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new n.Client({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,s.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}},{langsmith:"kvxIp","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kvxIp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/index.js");a.exportAll(n,r)},{"./dist/index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cCB7g:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>n.Client),a.export(r,"RunTree",()=>s.RunTree),a.export(r,"__version__",()=>i);var n=e("./client.js"),s=e("./run_trees.js");let i="0.0.70"},{"./client.js":"2VxwW","./run_trees.js":"9zMS3","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2VxwW":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>g);var n=e("uuid"),s=e("./utils/async_caller.js"),i=e("./utils/messages.js"),o=e("./utils/env.js"),l=e("./index.js");async function u(e){let t=await (0,o.getRuntimeEnvironment)(),r=(0,o.getLangChainEnvVarsMetadata)();return e.map(e=>{let a=e.extra??{},n=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...n}},e})}let c=()=>{let e=(0,o.getEnvironmentVariable)("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;let t=parseFloat(e);if(t<0||t>1)throw Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},d=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},p=async(e,t)=>{let r=await e.text();if(!e.ok)throw Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};async function h(e){let t=[];for await(let r of e)t.push(r);return t}function m(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function f(e){if(!n.validate(e))throw Error(`Invalid UUID: ${e}`)}class g{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingAutoBatchedRuns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50});let t=g.getDefaultClientConfig();this.tracingSampleRate=c(),this.apiUrl=m(e.apiUrl??t.apiUrl)??"",this.apiKey=m(e.apiKey??t.apiKey),this.webUrl=m(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new s.AsyncCaller(e.callerOptions??{}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit}static getDefaultClientConfig(){let e=(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_OUTPUTS")}}validateApiKeyIfHosted(){if(!d(this.apiUrl)&&!this.apiKey)throw Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:d(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${l.__version__}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs?{}:e}processOutputs(e){return this.hideOutputs?{}:e}prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,n=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let n=`${this.apiUrl}${e}?${t}`,s=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!s.ok)throw Error(`Failed to fetch ${e}: ${s.status} ${s.statusText}`);let i=await s.json();if(0===i.length||(yield i,i.length<a))break;r+=i.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let n=t?{...t}:{};for(;;){let t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(n)}),s=await t.json();if(!s||!s[a])break;yield s[a];let i=s.cursors;if(!i||!i.next)break;n.cursor=i.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.sampledPostUuids.has(r.id)&&(t.push(r),this.sampledPostUuids.delete(r.id));return t}{let t=[];for(let r of e)Math.random()<this.tracingSampleRate&&(t.push(r),this.sampledPostUuids.add(r.id));return t}}async triggerAutoBatchSend(e){let t=e;void 0===t&&(t=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit),this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit)),await this.batchIngestRuns({runCreates:t.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:t.filter(e=>"update"===e.action).map(e=>e.item)})}appendRunCreateToAutoBatchQueue(e){let t=this.autoBatchTimeout;for(clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,this.pendingAutoBatchedRuns.push(e);this.pendingAutoBatchedRuns.length>=this.pendingAutoBatchedRunLimit;){let e=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit);this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit),this.triggerAutoBatchSend(e)}this.pendingAutoBatchedRuns.length>0&&(t?this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchAggregationDelayMs):this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchInitialDelayMs))}async batchEndpointIsSupported(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)});return!!e.ok||(await e.text(),!1)}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"create",item:a});return}let n=await u([a]),s=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(n[0]),signal:AbortSignal.timeout(this.timeout_ms)});await p(s,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[],a=t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[];if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}let n={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!n.post.length&&!n.patch.length)return;if(r=await u(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let e of(this.autoBatchTracing=!1,n.post))await this.createRun(e);for(let e of n.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}let s={...this.headers,"Content-Type":"application/json",Accept:"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:s,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});await p(i,"batch create run")}async updateRun(e,t){f(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"update",item:r});return}let a={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await p(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){f(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await h(this.listRuns({id:e.child_run_ids})),r={},a={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns({projectId:e,projectName:t,parentRunId:r,traceId:a,referenceExampleId:n,startTime:s,executionOrder:i,runType:o,error:l,id:u,query:c,filter:d,limit:p}){let h=[];if(e&&(h=Array.isArray(e)?e:[e]),t){let e=Array.isArray(t)?t:[t],r=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));h.push(...r)}let m={session:h.length?h:null,run_type:o,reference_example:n,query:c,filter:d,execution_order:i,parent_run:r?[r]:null,start_time:s?s.toISOString():null,error:l,id:u,limit:p,trace:a};for await(let e of this._getCursorPaginatedList("/runs/query",m))yield*e}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||n.v4()};f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),s=await a.json();if(null===s||!("share_token"in s))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await p(t,"unshare run")}async readRunSharedLink(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),f(e);let r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};f(e);let a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await p(t,"unshare dataset")}async readSharedDataset(e){f(e);let t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:n=null,referenceDatasetId:s=null}){let i=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==s&&(l.reference_dataset_id=s);let u=await this.caller.call(fetch,i,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),c=await u.json();if(!u.ok)throw Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return c}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:n=null,endTime:s=null}){let i=`${this.apiUrl}/sessions/${e}`,o=n;a&&(o={...o||{},metadata:a});let l={name:t,extra:o,description:r,end_time:s?new Date(s).toISOString():null},u=await this.caller.call(fetch,i,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),c=await u.json();if(!u.ok)throw Error(`Failed to update project ${e}: ${u.status} ${u.statusText}`);return c}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(fetch,`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,n="/sessions",s=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),n+=`/${e}`;else if(void 0!==t)s.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&s.append("include_stats",r.toString());let i=await this._get(n,s);if(Array.isArray(i)){if(0===i.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:n,referenceFree:s}={}){let i=new URLSearchParams;if(void 0!==e)for(let t of e)i.append("id",t);if(void 0!==t&&i.append("name",t),void 0!==r&&i.append("name_contains",r),void 0!==a)i.append("reference_dataset",a);else if(void 0!==n){let e=await this.readDataset({datasetName:n});i.append("reference_dataset",e.id)}for await(let e of(void 0!==s&&i.append("reference_free",s.toString()),this._getPaginated("/sessions",i)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");f(r=void 0===e?(await this.readProject({projectName:t})).id:e);let a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await p(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:n,dataType:s,name:i}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),s&&l.append("data_type",s),i&&l.append("name",i);let u=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok){let e=await u.json();if(e.detail&&e.detail.includes("already exists"))throw Error(`Dataset ${t} already exists`);throw Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}return await u.json()}async createDataset(e,{description:t,dataType:r}={}){let a={name:e,description:t};r&&(a.data_type=r);let n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok){let t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw Error(`Dataset ${e} already exists`);throw Error(`Failed to create dataset ${n.status} ${n.statusText}`)}return await n.json()}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)f(e),a+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let s=await this._get(a,n);if(Array.isArray(s)){if(0===s.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=s[0]}else r=s;return r}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:n}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==a&&s.append("name",a),void 0!==n&&s.append("name_contains",n),this._getPaginated("/datasets",s)))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0!==a)f(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:n,exampleId:s}){let i=r;if(void 0===i&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:a})).id);let o=n||new Date,l={dataset_id:i,inputs:e,outputs:t,created_at:o?.toISOString(),id:s},u=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok)throw Error(`Failed to create example: ${u.status} ${u.statusText}`);return await u.json()}async createExamples(e){let{inputs:t,outputs:r,sourceRunIds:a,exampleIds:n,datasetId:s,datasetName:i}=e,o=s;if(void 0===o&&void 0===i)throw Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");void 0===o&&(o=(await this.readDataset({datasetName:i})).id);let l=t.map((e,t)=>({dataset_id:o,inputs:e,outputs:r?r[t]:void 0,id:n?n[t]:void 0,source_run_id:a?a[t]:void 0})),u=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!u.ok)throw Error(`Failed to create examples: ${u.status} ${u.statusText}`);return await u.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>(0,i.isLangChainMessage)(e)?(0,i.convertLangChainMessageToExample)(e):e),n=(0,i.isLangChainMessage)(t)?(0,i.convertLangChainMessageToExample)(t):t;return this.createExample({input:a},{output:n},r)}async readExample(e){f(e);let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a=e;else if(void 0!==t)a=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let n=new URLSearchParams({dataset:a});if(void 0!==r)for(let e of r)n.append("id",e);for await(let e of this._getPaginated("/examples",n))yield*e}async deleteExample(e){f(e);let t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){f(e);let r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:n}={loadChildRuns:!1}){let s;if("string"==typeof e)s=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)s=e;else throw Error(`Invalid run type: ${typeof e}`);null!==s.reference_example_id&&void 0!==s.reference_example_id&&(n=await this.readExample(s.reference_example_id));let i=await t.evaluateRun(s,n),o=r??{};i.evaluatorInfo&&(o={...o,...i.evaluatorInfo});let l=i.targetRunId??s.id;return await this.createFeedback(l,i.key,{score:i?.score,value:i?.value,comment:i?.comment,correction:i?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:i?.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:s,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,eager:d=!1}){let h={type:l??"api",metadata:o??{}};void 0===u||h?.metadata===void 0||h.metadata.__run||(h.metadata.__run={run_id:u}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&f(h.metadata.__run.run_id);let m={id:c??n.v4(),run_id:e,key:t,score:r,value:a,correction:s,comment:i,feedback_source:h},g=`${this.apiUrl}/feedback`+(d?"/eager":""),b=await this.caller.call(fetch,g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms)});return await p(b,"create feedback"),m}async updateFeedback(e,{score:t,value:r,correction:a,comment:n}){let s={};null!=t&&(s.score=t),null!=r&&(s.value=r),null!=a&&(s.correction=a),null!=n&&(s.comment=n),f(e);let i=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms)});await p(i,"update feedback")}async readFeedback(e){f(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){f(e);let t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}}},{uuid:"l36KR","./utils/async_caller.js":"bLfDs","./utils/messages.js":"lQU31","./utils/env.js":"6TaU5","./index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bLfDs:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>c);var n=e("p-retry"),s=a.interopDefault(n),i=e("p-queue"),o=a.interopDefault(i);let l=[400,401,403,404,405,406,407,408],u=[409];class c{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,s.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status;if(t){if(l.includes(+t))throw e;if(u.includes(+t))return}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hDMvm:[function(e,t,r){let a=e("67f41b35420203c"),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let i=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},o=e=>n.includes(e),l=(e,t)=>new Promise((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=a.operation(t);l.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){n(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof s)l.stop(),n(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),n(e);else{i(e,a,t);try{await t.onFailedAttempt(e)}catch(e){n(e);return}l.retry(e)||n(l.mainError())}}})});t.exports=l,t.exports.default=l,t.exports.AbortError=s},{"67f41b35420203c":"6LrBF"}],"6LrBF":[function(e,t,r){t.exports=e("4f22b206be44b97e")},{"4f22b206be44b97e":"bgrBC"}],bgrBC:[function(e,t,r){var a=e("a628df618ac3d4");r.operation=function(e){return new a(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort(function(e,t){return e-t}),a},r.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},r.wrap=function(e,t,a){if(t instanceof Array&&(a=t,t=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var s=0;s<a.length;s++){var i=a[s],o=e[i];e[i]=(function(a){var n=r.operation(t),s=Array.prototype.slice.call(arguments,1),i=s.pop();s.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),i.apply(this,arguments))}),n.attempt(function(){a.apply(e,s)})}).bind(e,o),e[i].options=t}}},{a628df618ac3d4:"6sDq5"}],"6sDq5":[function(e,t,r){function a(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=a,a.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},a.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},a.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},a.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},a.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},a.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},a.prototype.start=a.prototype.try,a.prototype.errors=function(){return this._errors},a.prototype.attempts=function(){return this._attempts},a.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],s=n.message,i=(e[s]||0)+1;e[s]=i,i>=r&&(t=n,r=i)}return t}},{}],kO9Cj:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("a178093eea54aebd"),n=e("d219d890bb7e8882"),s=e("4a792a8cd58e20a7"),i=()=>{},o=new n.TimeoutError;r.default=class extends a{constructor(e){var t,r,a,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let s=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await s)}catch(e){a(e)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},{a178093eea54aebd:"18IC9",d219d890bb7e8882:"1SPZv","4a792a8cd58e20a7":"6J1Cc"}],"18IC9":[function(e,t,r){var a=Object.prototype.hasOwnProperty,n="~";function s(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,a,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new i(r,a||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)a.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,i=Array(s);a<s;a++)i[a]=r[a].fn;return i},u.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,a,s,i){var o=n?n+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,a),!0;case 5:return c.fn.call(c.context,t,r,a,s),!0;case 6:return c.fn.call(c.context,t,r,a,s,i),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var p,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,r);break;case 4:c[u].fn.call(c[u].context,t,r,a);break;default:if(!l)for(p=1,l=Array(d-1);p<d;p++)l[p-1]=arguments[p];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,a){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return l(this,s),this;var i=this._events[s];if(i.fn)i.fn!==t||a&&!i.once||r&&i.context!==r||l(this,s);else{for(var o=0,u=[],c=i.length;o<c;o++)(i[o].fn!==t||a&&!i[o].once||r&&i[o].context!==r)&&u.push(i[o]);u.length?this._events[s]=1===u.length?u[0]:u:l(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},{}],"1SPZv":[function(e,t,r){let a=e("ed36938359c1cb6b");class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}let s=(e,t,r)=>new Promise((s,i)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){s(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{s(r())}catch(e){i(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new n(a);"function"==typeof e.cancel&&e.cancel(),i(o)},t);a(e.then(s,i),()=>{clearTimeout(o)})});t.exports=s,t.exports.default=s,t.exports.TimeoutError=n},{ed36938359c1cb6b:"bvvkH"}],bvvkH:[function(e,t,r){t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},{}],"6J1Cc":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("9ebe1cec8dfae466");r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let n=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},{"9ebe1cec8dfae466":"2Nr9E"}],"2Nr9E":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let a=0,n=e.length;for(;n>0;){let s=n/2|0,i=a+s;0>=r(e[i],t)?(a=++i,n-=s+1):n=s}return a}},{}],lQU31:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){return"function"==typeof e?._getType}function s(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}a.defineInteropFlag(r),a.export(r,"isLangChainMessage",()=>n),a.export(r,"convertLangChainMessageToExample",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6TaU5":[function(e,t,r){let a,n,s;var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"isBrowser",()=>u),i.export(r,"isWebWorker",()=>c),i.export(r,"isJsDom",()=>d),i.export(r,"isDeno",()=>p),i.export(r,"isNode",()=>h),i.export(r,"getEnv",()=>m),i.export(r,"getRuntimeEnvironment",()=>f),i.export(r,"getLangChainEnvVars",()=>g),i.export(r,"getLangChainEnvVarsMetadata",()=>b),i.export(r,"getEnvironmentVariables",()=>y),i.export(r,"getEnvironmentVariable",()=>v),i.export(r,"setEnvironmentVariable",()=>w),i.export(r,"getShas",()=>_);var o=e("../index.js"),l=e("6a932e963f932781");let u=()=>"undefined"!=typeof window&&void 0!==window.document,c=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,d=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),p=()=>"undefined"!=typeof Deno,h=()=>void 0!==l&&void 0!==l.versions&&void 0!==l.versions.node&&!p(),m=()=>a||(a=u()?"browser":h()?"node":c()?"webworker":d()?"jsdom":p()?"deno":"other");async function f(){if(void 0===n){let e=m(),t=_();n={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:o.__version__,...t}}return n}function g(){let e=y()||{},t={};for(let[r,a]of Object.entries(e))r.startsWith("LANGCHAIN_")&&"string"==typeof a&&(t[r]=a);for(let e in t)if((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&"string"==typeof t[e]){let r=t[e];t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2)}return t}function b(){let e=y()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[a,n]of Object.entries(e))!a.startsWith("LANGCHAIN_")||"string"!=typeof n||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=n:t[a]=n);return t}function y(){try{if(void 0!==l&&l.env)return Object.entries(l.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}function v(e){try{return void 0!==l?l.env?.[e]:void 0}catch(e){return}}function w(e,t){}function _(){if(void 0!==s)return s;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=v(t);void 0!==r&&(e[t]=r)}return s=e,e}},{"6a932e963f932781":"7XEqq","../index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9zMS3":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"convertToDottedOrderFormat",()=>l),a.export(r,"RunTree",()=>u);var n=e("uuid"),s=e("./utils/env.js"),i=e("./client.js");let o={};function l(e,t){return`${new Date(e).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+t}class u{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,{...u.getDefaultConfig(),...e}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id:this.trace_id=this.id),!this.dotted_order){let e=l(this.start_time,this.id);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:n.v4(),run_type:"chain",project_name:(0,s.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,s.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,s.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,s.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{},client:new i.Client({})}}async createChild(e){let t=new u({...e,parent_run:this,project_name:this.project_name,client:this.client});return this.child_runs.push(t),t}async end(e,t,r=Date.now()){this.outputs=e,this.error=t,this.end_time=r}async _convertToCreate(e,t=!0){let r,a;let n=e.extra??{};for(let[e,t]of(n.runtime||(n.runtime={}),Object.entries(await (0,s.getRuntimeEnvironment)())))n.runtime[e]||(n.runtime[e]=t);return t?(a=e.parent_run?.id,r=[]):(r=await Promise.all(e.child_runs.map(e=>this._convertToCreate(e,t))),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:r,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order}}async postRun(e=!0){let t=await this._convertToCreate(this,!0);if(await this.client.createRun(t),!e){var r;for(let e of(o[r="Posting with excludeChildRuns=false is deprecated and will be removed in a future version."]||(console.warn(r),o[r]=!0),this.child_runs))await e.postRun(!1)}}async patchRun(){let e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id};await this.client.updateRun(this.id,e)}}},{uuid:"l36KR","./utils/env.js":"6TaU5","./client.js":"2VxwW","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2Th20":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"isBrowser",()=>i),n.export(r,"isWebWorker",()=>o),n.export(r,"isJsDom",()=>l),n.export(r,"isDeno",()=>u),n.export(r,"isNode",()=>c),n.export(r,"getEnv",()=>d),n.export(r,"getRuntimeEnvironment",()=>p),n.export(r,"getEnvironmentVariable",()=>h);var s=e("d7d668f88b40f2c1");let i=()=>"undefined"!=typeof window&&void 0!==window.document,o=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,l=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),u=()=>"undefined"!=typeof Deno,c=()=>void 0!==s&&void 0!==s.versions&&void 0!==s.versions.node&&!u(),d=()=>i()?"browser":c()?"node":o()?"webworker":l()?"jsdom":u()?"deno":"other";async function p(){return void 0===a&&(a={library:"langchain-js",runtime:d()}),a}function h(e){try{return void 0!==s?s.env?.[e]:void 0}catch(e){return}}},{d7d668f88b40f2c1:"7XEqq","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],Pa0ga:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracerV1",()=>o);var n=e("../messages/index.js"),s=e("../utils/env.js"),i=e("./base.js");class o extends i.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,s.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let e=(0,s.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){let t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){let t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){let e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){let t;let r=this.session??await this.loadDefaultSession(),a=e.serialized;if("llm"===e.run_type){let s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(e=>(0,n.getBufferString)(e));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,prompts:s,response:e.outputs}}else if("chain"===e.run_type){let n=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:n.filter(e=>"llm"===e.type),child_chain_runs:n.filter(e=>"chain"===e.type),child_tool_runs:n.filter(e=>"tool"===e.type)}}else if("tool"===e.run_type){let n=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(a),child_llm_runs:n.filter(e=>"llm"===e.type),child_chain_runs:n.filter(e=>"chain"===e.type),child_tool_runs:n.filter(e=>"tool"===e.type)}}else throw Error(`Unknown run type: ${e.run_type}`);return t}async persistRun(e){let t,r;t="llm"===(r=void 0!==e.run_type?await this.convertV2RunToRun(e):e).type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;let a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){let t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){let t;let r=await fetch(e,{method:"GET",headers:this.headers});if(!r.ok)return console.error(`Failed to load session: ${r.status} ${r.statusText}`),t={id:1,start_time:Date.now()},this.session=t,t;let a=await r.json();return 0===a.length?t={id:1,start_time:Date.now()}:[t]=a,this.session=t,t}}},{"../messages/index.js":"jMGwo","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3BeNh":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"consumeCallback",()=>o),n.export(r,"awaitAllCallbacks",()=>l);var s=e("p-queue"),i=n.interopDefault(s);async function o(e,t){!0===t?await e():(void 0===a&&(a=new("default"in i.default?i.default.default:i.default)({autoStart:!0,concurrency:1})),a.add(e))}function l(){return void 0!==a?a.onIdle():Promise.resolve()}},{"p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],is1pt:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseLangChain",()=>n.BaseLangChain),a.export(r,"BaseLanguageModel",()=>n.BaseLanguageModel),a.export(r,"calculateMaxTokens",()=>s.calculateMaxTokens),a.export(r,"getModelContextSize",()=>s.getModelContextSize);var n=e("@langchain/core/language_models/base"),s=e("./count_tokens.js")},{"@langchain/core/language_models/base":"jTFIS","./count_tokens.js":"edBJe","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jTFIS:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/language_models/base.js");a.exportAll(n,r)},{"../dist/language_models/base.js":"fQYj8","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fQYj8:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getModelNameForTiktoken",()=>c),a.export(r,"getEmbeddingContextSize",()=>d),a.export(r,"getModelContextSize",()=>p),a.export(r,"calculateMaxTokens",()=>h),a.export(r,"BaseLangChain",()=>f),a.export(r,"BaseLanguageModel",()=>g);var n=e("../caches.js"),s=e("../prompt_values.js"),i=e("../messages/index.js"),o=e("../utils/async_caller.js"),l=e("../utils/tiktoken.js"),u=e("../runnables/base.js");let c=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,d=e=>"text-embedding-ada-002"===e?8191:2046,p=e=>{switch(c(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}},h=async({prompt:e,modelName:t})=>{let r;try{r=(await (0,l.encodingForModel)(c(t))).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return p(t)-r},m=()=>!1;class f extends u.Runnable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??m(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class g extends f{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=(0,n.InMemoryCache).global():this.cache=void 0,this.caller=new o.AsyncCaller(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await (0,l.encodingForModel)("modelName"in this?c(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new s.StringPromptValue(e):Array.isArray(e)?new s.ChatPromptValue(e.map(i.coerceMessageLikeToMessage)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){return Object.entries({...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}},{"../caches.js":"etUzK","../prompt_values.js":"lGT4D","../messages/index.js":"jMGwo","../utils/async_caller.js":"l8CrB","../utils/tiktoken.js":"gODKI","../runnables/base.js":"1qQoT","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l8CrB:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>c);var n=e("p-retry"),s=a.interopDefault(n),i=e("p-queue"),o=a.interopDefault(i);let l=[400,401,402,403,404,405,406,407,408,409],u=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&l.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class c{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??u;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,s.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],gODKI:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getEncoding",()=>l),a.export(r,"encodingForModel",()=>u);var n=e("js-tiktoken/lite"),s=e("./async_caller.js");let i={},o=new s.AsyncCaller({});async function l(e){return e in i||(i[e]=o.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new n.Tiktoken(e)).catch(t=>{throw delete i[e],t})),await i[e]}async function u(e){return l((0,n.getEncodingNameForModel)(e))}},{"js-tiktoken/lite":"hrZLc","./async_caller.js":"l8CrB","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hrZLc:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Tiktoken",()=>n.Tiktoken),a.export(r,"getEncodingNameForModel",()=>n.getEncodingNameForModel);var n=e("./chunk-YVJR5WRT.js")},{"./chunk-YVJR5WRT.js":"4sh0B","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4sh0B":[function(e,t,r){let a,n;var s,i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"Tiktoken",()=>p),i.export(r,"getEncodingNameForModel",()=>h),i.export(r,"never",()=>c);var o=e("base64-js"),l=i.interopDefault(o),u=Object.defineProperty;function c(e){}var d=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...n]=t.split(" "),s=Number.parseInt(a,10);return n.forEach((t,r)=>e[t]=s+r),e},{})))){let e=(0,l.default).toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),n=d.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!i.has(e)):r);if(o.size>0){let t=d.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||i.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){s.push(r);continue}s.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let n=0;n<r.length-1;n++){let s=e.slice(r[n].start,r[n+1].end),i=t.get(s.join(","));null!=i&&(null==a||i<a[0])&&(a=[i,n])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];s.push(u),l=t.index+t[0].length}return s}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let n=e[a],s=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=s&&(t.push(s),r+=s.length)}let a=new Uint8Array(r),n=0;for(let e of t)a.set(e,n),n+=e.length;return this.textDecoder.decode(a)}},p=d;function h(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw Error("Unknown model")}}a="symbol"!=typeof(s="specialTokenRegex")?s+"":s,n=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),a in p?u(p,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[a]=n},{"base64-js":"jri1H","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jri1H:[function(e,t,r){r.byteLength=function(e){var t=u(e),r=t[0],a=t[1];return(r+a)*3/4-a},r.toByteArray=function(e){var t,r,a=u(e),i=a[0],o=a[1],l=new s((i+o)*3/4-o),c=0,d=o>0?i-4:i;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,s=[],i=0,o=r-n;i<o;i+=16383)s.push(function(e,t,r){for(var n,s=[],i=t;i<r;i+=3)s.push(a[(n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]))>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return s.join("")}(e,i,i+16383>o?o:i+16383));return 1===n?s.push(a[(t=e[r-1])>>2]+a[t<<4&63]+"=="):2===n&&s.push(a[(t=(e[r-2]<<8)+e[r-1])>>10]+a[t>>4&63]+a[t<<2&63]+"="),s.join("")};for(var a=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=i.length;o<l;++o)a[o]=i[o],n[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var a=r===t?0:4-r%4;return[r,a]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},{}],"1qQoT":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Runnable",()=>m),a.export(r,"RunnableBinding",()=>f),a.export(r,"RunnableEach",()=>g),a.export(r,"RunnableRetry",()=>b),a.export(r,"RunnableSequence",()=>y),a.export(r,"RunnableMap",()=>v),a.export(r,"RunnableLambda",()=>w),a.export(r,"RunnableParallel",()=>_),a.export(r,"RunnableWithFallbacks",()=>j),a.export(r,"_coerceToRunnable",()=>x);var n=e("p-retry"),s=a.interopDefault(n),i=e("../callbacks/manager.js"),o=e("../tracers/log_stream.js"),l=e("../load/serializable.js"),u=e("../utils/stream.js"),c=e("./config.js"),d=e("../utils/async_caller.js"),p=e("../tracers/root_listener.js");function h(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class m extends l.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new f({bound:this,kwargs:e,config:{}})}map(){return new g({bound:this})}withRetry(e){return new b({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new f({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new j({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),n=new d.AsyncCaller({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return(0,u.IterableReadableStream).fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){let t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,[t,r]}async _callWithConfig(e,t,r){let a;let n=await (0,c.getCallbackMangerForConfig)(r),s=await n?.handleChainStart(this.toJSON(),h(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName);try{a=await e.bind(this)(t,r,s)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(h(a,"output")),a}async _batchWithConfig(e,t,r,a){let n;let s=this._getOptionsList(r??{},t.length),i=await Promise.all(s.map(c.getCallbackMangerForConfig)),o=await Promise.all(i.map((e,r)=>e?.handleChainStart(this.toJSON(),h(t[r],"input"),void 0,s[r].runType,void 0,void 0,s[r].runName)));try{n=await e(t,s,o,a)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(h(n,"output")))),n}async *_transformStreamWithConfig(e,t,r){let a,n,s;let i=!0,o=!0,l=await (0,c.getCallbackMangerForConfig)(r),u=this.toJSON(),d=async function*(){for await(let t of e){if(s||(s=await l?.handleChainStart(u,{input:""},void 0,r?.runType,void 0,void 0,r?.runName)),i){if(void 0===a)a=t;else try{a=a.concat(t)}catch{a=void 0,i=!1}}yield t}}();try{for await(let e of t(d,s,r))if(yield e,o){if(void 0===n)n=e;else try{n=n.concat(e)}catch{n=void 0,o=!1}}}catch(e){throw await s?.handleChainError(e,void 0,void 0,void 0,{inputs:h(a,"input")}),e}await s?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:h(a,"input")})}_patchConfig(e={},t){let r={...e};return void 0!==t?(delete r.runName,{...r,callbacks:t}):r}pipe(e){return new y({first:this,last:x(e)})}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:r.concat(t);yield*this._streamIterator(r,t)}async *streamLog(e,t,r){let a=new o.LogStreamCallbackHandler({...r,autoClose:!1}),n=t??{},{callbacks:s}=n;if(void 0===s)n.callbacks=[a];else if(Array.isArray(s))n.callbacks=s.concat([a]);else{let e=s.copy();e.inheritableHandlers.push(a),n.callbacks=e}let i=await this.stream(e,n),l=async function(){try{for await(let e of i){let t=new o.RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await a.writer.write(t)}}finally{await a.writer.close()}}();try{for await(let e of a)yield e}finally{await l}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this,config:{},configFactories:[a=>({callbacks:[new p.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class f extends m{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}async _mergeConfig(e){let t=(0,c.mergeConfigs)(this.config,e);return(0,c.mergeConfigs)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig({...e,...this.kwargs}))):await this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig({...t,...this.kwargs}))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&m.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new f({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new p.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class g extends m{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new g({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}withListeners({onStart:e,onEnd:t,onError:r}){return new g({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class b extends f{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(a))}async _invoke(e,t,r){return(0,s.default)(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let n={};try{await (0,s.default)(async s=>{let i;let o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(s,t?.[e],r?.[e])),c=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===i&&(i=t),n[r.toString()]=t}if(i)throw i;return c},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class y extends m{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=await (0,c.getCallbackMangerForConfig)(t),n=await a?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName),s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r];s=await a.invoke(s,this._patchConfig(t,n?.getChild(`seq:step:${r+1}`)))}r=await this.last.invoke(s,this._patchConfig(t,n?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(h(r,"output")),r}async batch(e,t,r){let a;let n=this._getOptionsList(t??{},e.length),s=await Promise.all(n.map(c.getCallbackMangerForConfig)),i=await Promise.all(s.map((t,r)=>t?.handleChainStart(this.toJSON(),h(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName))),o=e;try{let e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){let a=e[t];o=await a.batch(o,i.map((e,r)=>this._patchConfig(n[r],e?.getChild(`seq:step:${t+1}`))),r)}a=await this.last.batch(o,i.map(e=>this._patchConfig(n[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`))),r)}catch(e){throw await Promise.all(i.map(t=>t?.handleChainError(e))),e}return await Promise.all(i.map((e,t)=>e?.handleChainEnd(h(a[t],"output")))),a}async *_streamIterator(e,t){let r;let a=await (0,c.getCallbackMangerForConfig)(t),n=await a?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName),s=[this.first,...this.middle,this.last],i=!0;async function*o(){yield e}try{let e=s[0].transform(o(),this._patchConfig(t,n?.getChild("seq:step:1")));for(let r=1;r<s.length;r+=1){let a=s[r];e=await a.transform(e,this._patchConfig(t,n?.getChild(`seq:step:${r+1}`)))}for await(let t of e)if(yield t,i){if(void 0===r)r=t;else try{r=r.concat(t)}catch(e){r=void 0,i=!1}}}catch(e){throw await n?.handleChainError(e),e}await n?.handleChainEnd(h(r,"output"))}pipe(e){return new y(y.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}:{first:this.first,middle:[...this.middle,this.last],last:x(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&m.isRunnable(e)}static from([e,...t]){return new y({first:x(e),middle:t.slice(0,-1).map(x),last:x(t[t.length-1])})}}class v extends m{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=x(r)}static from(e){return new v({steps:e})}async invoke(e,t){let r=await (0,c.getCallbackMangerForConfig)(t),a=await r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName),n={};try{await Promise.all(Object.entries(this.steps).map(async([r,s])=>{n[r]=await s.invoke(e,this._patchConfig(t,a?.getChild(r)))}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(n),n}}class w extends m{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new w({func:e})}async _invoke(e,t,r){let a=await this.func(e,{config:t});return a&&m.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r?.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class _ extends v{}class j extends m{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let a=await (0,i.CallbackManager).configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),n=await a?.handleChainStart(this.toJSON(),h(e,"input"),void 0,void 0,void 0,void 0,t?.runName);for(let a of this.runnables())try{let r=await a.invoke(e,this._patchConfig(t,n?.getChild()));return await n?.handleChainEnd(h(r,"output")),r}catch(e){void 0===r&&(r=e)}if(void 0===r)throw Error("No error stored at end of fallback.");throw await n?.handleChainError(r),r}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),s=await Promise.all(n.map(e=>(0,i.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata))),o=await Promise.all(s.map((t,r)=>t?.handleChainStart(this.toJSON(),h(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName)));for(let t of this.runnables())try{let a=await t.batch(e,o.map((e,t)=>this._patchConfig(n[t],e?.getChild())),r);return await Promise.all(o.map((e,t)=>e?.handleChainEnd(h(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(o.map(e=>e?.handleChainError(a))),a}}function x(e){if("function"==typeof e)return new w({func:e});if(m.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=x(a);return new v({steps:t})}}},{"p-retry":"hDMvm","../callbacks/manager.js":"fZx9W","../tracers/log_stream.js":"jD00e","../load/serializable.js":"ihLrn","../utils/stream.js":"faNJA","./config.js":"bd9nP","../utils/async_caller.js":"l8CrB","../tracers/root_listener.js":"i5MBm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jD00e:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunLogPatch",()=>o),a.export(r,"RunLog",()=>l),a.export(r,"LogStreamCallbackHandler",()=>u);var n=e("../utils/fast-json-patch/index.js"),s=e("./base.js"),i=e("../utils/stream.js");class o{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){let t=this.ops.concat(e.ops),r=(0,n.applyPatch)({},t);return new l({ops:t,state:r[r.length-1].newDocument})}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,n.applyPatch)(this.state,e.ops);return new l({ops:t,state:r[r.length-1].newDocument})}}class u extends s.BaseTracer{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=(0,i.IterableReadableStream).fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new o({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]})),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new o({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new o({ops:r});await this.writer.write(a)}finally{if(void 0===e.parent_run_id){let t=new o({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){let r=this.keyMapByRunId[e.id];if(void 0===r)return;let a=new o({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(a)}}},{"../utils/fast-json-patch/index.js":"hrFKE","./base.js":"gsfZb","../utils/stream.js":"faNJA","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hrFKE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>i.PatchError),a.export(r,"deepClone",()=>i._deepClone),a.export(r,"escapePathComponent",()=>i.escapePathComponent),a.export(r,"unescapePathComponent",()=>i.unescapePathComponent);var n=e("./src/core.js");a.exportAll(n,r);var s=e("./src/duplex.js");a.exportAll(s,r);var i=e("./src/helpers.js");r.default={...n,JsonPatchError:i.PatchError,deepClone:i._deepClone,escapePathComponent:i.escapePathComponent,unescapePathComponent:i.unescapePathComponent}},{"./src/core.js":"27Wvc","./src/duplex.js":"9JAeY","./src/helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"27Wvc":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>s),a.export(r,"deepClone",()=>i),a.export(r,"getValueByPointer",()=>u),a.export(r,"applyOperation",()=>c),a.export(r,"applyPatch",()=>d),a.export(r,"applyReducer",()=>p),a.export(r,"validator",()=>h),a.export(r,"validate",()=>m),a.export(r,"_areEquals",()=>f);var n=e("./helpers.js");let s=n.PatchError,i=n._deepClone,o={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=u(r,this.path);a&&(a=(0,n._deepClone)(a));let s=c(r,{op:"remove",path:this.from}).removed;return c(r,{op:"add",path:this.path,value:s}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=u(r,this.from);return c(r,{op:"add",path:this.path,value:(0,n._deepClone)(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:f(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var l={add:function(e,t,r){return(0,n.isInteger)(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:o.move,copy:o.copy,test:o.test,_get:o._get};function u(e,t){if(""==t)return e;var r={op:"_get",path:t};return c(e,r),r.value}function c(e,t,r=!1,a=!0,i=!0,c=0){if(r&&("function"==typeof r?r(t,0,e,t.path):h(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=u(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=f(e,t.value),!1===a.test)throw new s("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new s("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",c,t,e)}}{let u,d,p;a||(e=(0,n._deepClone)(e));let m=(t.path||"").split("/"),f=e,g=1,b=m.length;for(d="function"==typeof r?r:h;;){if((u=m[g])&&-1!=u.indexOf("~")&&(u=(0,n.unescapePathComponent)(u)),i&&("__proto__"==u||"prototype"==u&&g>0&&"constructor"==m[g-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===p&&(void 0===f[u]?p=m.slice(0,g).join("/"):g==b-1&&(p=t.path),void 0!==p&&d(t,0,e,p)),g++,Array.isArray(f)){if("-"===u)u=f.length;else{if(r&&!(0,n.isInteger)(u))throw new s("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",c,t,e);(0,n.isInteger)(u)&&(u=~~u)}if(g>=b){if(r&&"add"===t.op&&u>f.length)throw new s("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",c,t,e);let a=l[t.op].call(t,f,u,e);if(!1===a.test)throw new s("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return a}}else if(g>=b){let r=o[t.op].call(t,f,u,e);if(!1===r.test)throw new s("Test operation failed","TEST_OPERATION_FAILED",c,t,e);return r}if(f=f[u],r&&g<b&&(!f||"object"!=typeof f))throw new s("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",c,t,e)}}}function d(e,t,r,a=!0,i=!0){if(r&&!Array.isArray(t))throw new s("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=(0,n._deepClone)(e));let o=Array(t.length);for(let a=0,n=t.length;a<n;a++)o[a]=c(e,t[a],r,!0,i,a),e=o[a].newDocument;return o.newDocument=e,o}function p(e,t,r){let a=c(e,t);if(!1===a.test)throw new s("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function h(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new s("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(o[e.op]){if("string"!=typeof e.path)throw new s("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new s('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new s("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new s("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&(0,n.hasUndefined)(e.value))throw new s("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var i=e.path.split("/").length,l=a.split("/").length;if(i!==l+1&&i!==l)throw new s("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new s("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var u=m([{op:"_get",path:e.from,value:void 0}],r);if(u&&"OPERATION_PATH_UNRESOLVABLE"===u.name)throw new s("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new s("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function m(e,t,r){try{if(!Array.isArray(e))throw new s("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)d((0,n._deepClone)(t),(0,n._deepClone)(e),r||!0);else{r=r||h;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof s)return e;throw e}}function f(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,n,s=Array.isArray(e),i=Array.isArray(t);if(s&&i){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!f(e[r],t[r]))return!1;return!0}if(s!=i)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!f(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}},{"./helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6VGjv":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"hasOwnProperty",()=>s),a.export(r,"_objectKeys",()=>i),a.export(r,"_deepClone",()=>o),a.export(r,"isInteger",()=>l),a.export(r,"escapePathComponent",()=>u),a.export(r,"unescapePathComponent",()=>c),a.export(r,"_getPathRecursive",()=>d),a.export(r,"getPath",()=>p),a.export(r,"hasUndefined",()=>function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=i(t),n=a.length;for(var r=0;r<n;r++)if(e(t[a[r]]))return!0}}return!1}),a.export(r,"PatchError",()=>m);let n=Object.prototype.hasOwnProperty;function s(e,t){return n.call(e,t)}function i(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)s(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function d(e,t){let r;for(let a in e)if(s(e,a)){if(e[a]===t)return u(a)+"/";if("object"==typeof e[a]&&""!=(r=d(e[a],t)))return u(a)+"/"+r}return""}function p(e,t){if(e===t)return"/";let r=d(e,t);if(""===r)throw Error("Object not found in root");return`/${r}`}function h(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class m extends Error{constructor(e,t,r,a,n){super(h(e,{name:t,index:r,operation:a,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=h(e,{name:t,index:r,operation:a,tree:n})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9JAeY":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unobserve",()=>u),a.export(r,"observe",()=>c),a.export(r,"generate",()=>d),a.export(r,"compare",()=>h);var n=e("./helpers.js"),s=e("./core.js"),i=new WeakMap;class o{constructor(e){Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.obj=e}}class l{constructor(e,t){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=e,this.observer=t}}function u(e,t){t.unobserve()}function c(e,t){var r,a=i.get(e);if(a){let e=a.observers.get(t);r=e&&e.observer}else a=new o(e),i.set(e,a);if(r)return r;if(r={},a.value=(0,n._deepClone)(e),t){r.callback=t,r.next=null;var s=()=>{d(r)},u=()=>{clearTimeout(r.next),r.next=setTimeout(s)};"undefined"!=typeof window&&(window.addEventListener("mouseup",u),window.addEventListener("keyup",u),window.addEventListener("mousedown",u),window.addEventListener("keydown",u),window.addEventListener("change",u))}return r.patches=[],r.object=e,r.unobserve=()=>{d(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(a,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",u),window.removeEventListener("keyup",u),window.removeEventListener("mousedown",u),window.removeEventListener("keydown",u),window.removeEventListener("change",u))},a.observers.set(t,new l(t,r)),r}function d(e,t=!1){var r=i.get(e.object);p(r.value,e.object,e.patches,"",t),e.patches.length&&(0,s.applyPatch)(r.value,e.patches);var a=e.patches;return a.length>0&&(e.patches=[],e.callback&&e.callback(a)),a}function p(e,t,r,a,s){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=(0,n._objectKeys)(t),o=(0,n._objectKeys)(e),l=!1,u=o.length-1;u>=0;u--){var c=o[u],d=e[c];if((0,n.hasOwnProperty)(t,c)&&!(void 0===t[c]&&void 0!==d&&!1===Array.isArray(t))){var h=t[c];"object"==typeof d&&null!=d&&"object"==typeof h&&null!=h&&Array.isArray(d)===Array.isArray(h)?p(d,h,r,a+"/"+(0,n.escapePathComponent)(c),s):d!==h&&(s&&r.push({op:"test",path:a+"/"+(0,n.escapePathComponent)(c),value:(0,n._deepClone)(d)}),r.push({op:"replace",path:a+"/"+(0,n.escapePathComponent)(c),value:(0,n._deepClone)(h)}))}else Array.isArray(e)===Array.isArray(t)?(s&&r.push({op:"test",path:a+"/"+(0,n.escapePathComponent)(c),value:(0,n._deepClone)(d)}),r.push({op:"remove",path:a+"/"+(0,n.escapePathComponent)(c)}),l=!0):(s&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}))}if(l||i.length!=o.length)for(var u=0;u<i.length;u++){var c=i[u];(0,n.hasOwnProperty)(e,c)||void 0===t[c]||r.push({op:"add",path:a+"/"+(0,n.escapePathComponent)(c),value:(0,n._deepClone)(t[c])})}}}function h(e,t,r=!1){var a=[];return p(e,t,a,"",r),a}},{"./helpers.js":"6VGjv","./core.js":"27Wvc","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],faNJA:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"IterableReadableStream",()=>n);class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done&&this.reader.releaseLock(),{done:e.done,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new n({start:e=>(function r(){return t.read().then(({done:t,value:a})=>{if(t){e.close();return}return e.enqueue(a),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bd9nP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getCallbackMangerForConfig",()=>s),a.export(r,"mergeConfigs",()=>i);var n=e("../callbacks/manager.js");async function s(e){return(0,n.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function i(e,t){let r={...e};if(t)for(let a of Object.keys(t))if("metadata"===a)r[a]={...r[a],...t[a]};else if("tags"===a)r[a]=(r[a]??[]).concat(t[a]??[]);else if("callbacks"===a){let a=r.callbacks,s=t.callbacks??e.callbacks;if(Array.isArray(s)){if(a){if(Array.isArray(a))r.callbacks=a.concat(s);else{let e=a.copy();for(let t of s)e.addHandler(t,!0);r.callbacks=e}}else r.callbacks=s}else if(s){if(a){if(Array.isArray(a)){let e=s.copy();for(let t of a)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=new n.CallbackManager(s.parentRunId,{handlers:a.handlers.concat(s.handlers),inheritableHandlers:a.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(s.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(s.inheritableTags))),metadata:{...a.metadata,...s.metadata}})}else r.callbacks=s}}else r[a]=t[a]??r[a];return r}},{"../callbacks/manager.js":"fZx9W","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i5MBm:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RootListenersTracer",()=>s);var n=e("./base.js");class s extends n.BaseTracer{constructor({config:e,onStart:t,onEnd:r,onError:a}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}},{"./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],edBJe:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"calculateMaxTokens",()=>n.calculateMaxTokens),a.export(r,"getModelContextSize",()=>n.getModelContextSize),a.export(r,"getEmbeddingContextSize",()=>n.getEmbeddingContextSize);var n=e("@langchain/core/language_models/base")},{"@langchain/core/language_models/base":"jTFIS","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cmcto:[function(e,t,r){t.exports=e("ed8fd8262421160e")(e("e29c8e8240255db7").getBundleURL("2AzJW")+e("81dc5800ee562945").resolve("2qOg2")).then(()=>t.bundle.root("h9Hbj"))},{ed8fd8262421160e:"jawFo",e29c8e8240255db7:"e3Ctf","81dc5800ee562945":"fcUCD"}],jawFo:[function(e,t,r){var a=e("e18e0f4b8102d3ab");t.exports=a(function(e){return new Promise(function(t,r){try{importScripts(e),t()}catch(e){r(e)}})})},{e18e0f4b8102d3ab:"4mYIR"}],"4mYIR":[function(e,t,r){var a={},n={},s={};t.exports=function(e,t){return function(r){var i=function(e){switch(e){case"preload":return n;case"prefetch":return s;default:return a}}(t);return i[r]?i[r]:i[r]=e.apply(null,arguments).catch(function(e){throw delete i[r],e})}}},{}],e3Ctf:[function(e,t,r){var a={};function n(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}r.getBundleURL=function(e){var t=a[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return n(e[2])}return"/"}(),a[e]=t),t},r.getBaseURL=n,r.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}},{}],fcUCD:[function(e,t,r){var a={};t.exports.register=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},t.exports.resolve=function(e){var t=a[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}},{}],"7Pmie":[function(e,t,r){t.exports=e("8615461003f6da73")(e("279e1ad2f433366e").getBundleURL("2AzJW")+e("ecd0eea08126eb6b").resolve("dQ0EI")).then(()=>t.bundle.root("c5l0I"))},{"8615461003f6da73":"jawFo","279e1ad2f433366e":"e3Ctf",ecd0eea08126eb6b:"fcUCD"}],"9ihBC":[function(e,t,r){t.exports=e("4ea5258dc78c84f2")(e("fc296367e990a062").getBundleURL("2AzJW")+e("6e04147457b6d179").resolve("2AzJW")).then(()=>t.bundle.root("d6V6d"))},{"4ea5258dc78c84f2":"jawFo",fc296367e990a062:"e3Ctf","6e04147457b6d179":"fcUCD"}],ec1ui:[function(e,t,r){t.exports=e("cfc4b18cade98bca")(e("e85a72fdccb1e2ac").getBundleURL("2AzJW")+e("6aa79ee238da8e3a").resolve("gLhAl")).then(()=>t.bundle.root("aELaP"))},{cfc4b18cade98bca:"jawFo",e85a72fdccb1e2ac:"e3Ctf","6aa79ee238da8e3a":"fcUCD"}],j5Wbw:[function(e,t,r){t.exports=e("c095afe830a091c1")(e("625aef651e28e472").getBundleURL("2AzJW")+e("af0a098a16cf29d3").resolve("1KVcI")).then(()=>t.bundle.root("je5T8"))},{c095afe830a091c1:"jawFo","625aef651e28e472":"e3Ctf",af0a098a16cf29d3:"fcUCD"}],h9Hbj:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LLMChain",()=>u);var n=e("./base.js"),s=e("../prompts/base.js"),i=e("../base_language/index.js"),o=e("../output_parsers/noop.js"),l=e("../schema/runnable/base.js");class u extends n.BaseChain{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,this.llm=e.llm,this.llmKwargs=e.llmKwargs,this.outputKey=e.outputKey??this.outputKey,this.outputParser=e.outputParser??new o.NoOpOutputParser,this.prompt.outputParser){if(e.outputParser)throw Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){return"callKeys"in this.llm?this.llm.callKeys:[]}_selectMemoryInputs(e){let t=super._selectMemoryInputs(e);for(let r of this.getCallKeys())r in e&&delete t[r];return t}async _getFinalOutput(e,t,r){return this.outputParser?await this.outputParser.parseResultWithPrompt(e,t,r?.getChild()):e[0].text}call(e,t){return super.call(e,t)}async _call(e,t){let r={...e},a={...this.llmKwargs};for(let t of this.getCallKeys())t in e&&a&&(a[t]=e[t],delete r[t]);let n=await this.prompt.formatPromptValue(r);if("generatePrompt"in this.llm){let{generations:e}=await this.llm.generatePrompt([n],a,t?.getChild());return{[this.outputKey]:await this._getFinalOutput(e[0],n,t)}}let s=this.outputParser?this.llm.pipe(this.outputParser):this.llm,i=await s.invoke(n,t?.getChild());return{[this.outputKey]:i}}async predict(e,t){return(await this.call(e,t))[this.outputKey]}_chainType(){return"llm"}static async deserialize(e){let{llm:t,prompt:r}=e;if(!t)throw Error("LLMChain must have llm");if(!r)throw Error("LLMChain must have prompt");return new u({llm:await (0,i.BaseLanguageModel).deserialize(t),prompt:await (0,s.BasePromptTemplate).deserialize(r)})}serialize(){let e="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:e,prompt:this.prompt.serialize()}}_getNumTokens(e){return(function e(t){if("function"==typeof t._llmType)return t;if("bound"in t&&(0,l.Runnable).isRunnable(t.bound))return e(t.bound);if("runnable"in t&&"fallbacks"in t&&(0,l.Runnable).isRunnable(t.runnable))return e(t.runnable);if("default"in t&&(0,l.Runnable).isRunnable(t.default))return e(t.default);throw Error("Unable to extract BaseLanguageModel from llmLike object.")})(this.llm).getNumTokens(e)}}},{"./base.js":"frbpR","../prompts/base.js":"gDAtu","../base_language/index.js":"is1pt","../output_parsers/noop.js":"5hMVk","../schema/runnable/base.js":"o8TEz","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],gDAtu:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseStringPromptTemplate",()=>n.BaseStringPromptTemplate),a.export(r,"BasePromptTemplate",()=>n.BasePromptTemplate),a.export(r,"StringPromptValue",()=>s.StringPromptValue),a.export(r,"BaseExampleSelector",()=>i.BaseExampleSelector);var n=e("@langchain/core/prompts"),s=e("@langchain/core/prompt_values"),i=e("@langchain/core/example_selectors")},{"@langchain/core/prompts":"4KAkE","@langchain/core/prompt_values":"5IYhT","@langchain/core/example_selectors":"bl3jj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4KAkE":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/prompts/index.js");a.exportAll(n,r)},{"./dist/prompts/index.js":"7121d","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7121d":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./base.js");a.exportAll(n,r);var s=e("./chat.js");a.exportAll(s,r);var i=e("./few_shot.js");a.exportAll(i,r);var o=e("./pipeline.js");a.exportAll(o,r);var l=e("./prompt.js");a.exportAll(l,r);var u=e("./serde.js");a.exportAll(u,r);var c=e("./string.js");a.exportAll(c,r);var d=e("./template.js");a.exportAll(d,r)},{"./base.js":"579yP","./chat.js":"e9TQ6","./few_shot.js":"dlll3","./pipeline.js":"l4ncl","./prompt.js":"2Oph6","./serde.js":"4W5FO","./string.js":"GINku","./template.js":"2ZN2o","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"579yP":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptTemplate",()=>s);var n=e("../runnables/base.js");class s extends n.Runnable{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[e,a]of Object.entries(t))"string"==typeof a?r[e]=a:r[e]=await a();return{...r,...e}}async invoke(e,t){return this._callWithConfig(e=>this.formatPromptValue(e),e,{...t,runType:"prompt"})}serialize(){throw Error("Use .toJSON() instead")}static async deserialize(t){switch(t._type){case"prompt":{let{PromptTemplate:r}=await e("5074728d6eef1415");return r.deserialize(t)}case void 0:{let{PromptTemplate:r}=await e("5074728d6eef1415");return r.deserialize({...t,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:r}=await e("c2cac79ecf644e72");return r.deserialize(t)}default:throw Error(`Invalid prompt type in config: ${t._type}`)}}}},{"../runnables/base.js":"1qQoT","5074728d6eef1415":"dQQYE",c2cac79ecf644e72:"49Pms","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dQQYE:[function(e,t,r){t.exports=e("4ad5f8d2eecc1547")(e("3f10e61eff45e8a9").getBundleURL("2AzJW")+e("de1e2d0480339d85").resolve("iZHrI")).then(()=>t.bundle.root("2Oph6"))},{"4ad5f8d2eecc1547":"jawFo","3f10e61eff45e8a9":"e3Ctf",de1e2d0480339d85:"fcUCD"}],"49Pms":[function(e,t,r){t.exports=e("8f11a22402ba817")(e("e10d666d5358bbcf").getBundleURL("2AzJW")+e("2aca3432df046a5d").resolve("kJFUv")).then(()=>t.bundle.root("dlll3"))},{"8f11a22402ba817":"jawFo",e10d666d5358bbcf:"e3Ctf","2aca3432df046a5d":"fcUCD"}],e9TQ6:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseMessagePromptTemplate",()=>u),a.export(r,"MessagesPlaceholder",()=>c),a.export(r,"BaseMessageStringPromptTemplate",()=>d),a.export(r,"BaseChatPromptTemplate",()=>p),a.export(r,"ChatMessagePromptTemplate",()=>h),a.export(r,"HumanMessagePromptTemplate",()=>m),a.export(r,"AIMessagePromptTemplate",()=>f),a.export(r,"SystemMessagePromptTemplate",()=>g),a.export(r,"ChatPromptTemplate",()=>b);var n=e("../messages/index.js"),s=e("../prompt_values.js"),i=e("../runnables/base.js"),o=e("./base.js"),l=e("./prompt.js");class u extends i.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(e=>this.formatMessages(e),e,{...t,runType:"prompt"})}}class c extends u{static lc_name(){return"MessagesPlaceholder"}constructor(e){"string"==typeof e&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName}get inputVariables(){return[this.variableName]}validateInputOrThrow(e,t){if(!(Array.isArray(e)?e.every(e=>(0,n.isBaseMessage)(e)):(0,n.isBaseMessage)(e))){let r="string"==typeof e?e:JSON.stringify(e,null,2),a=Error(`Error: Field "${t}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${r}`);throw a.name="InputFormatError",a}return!0}async formatMessages(e){return this.validateInputOrThrow(e[this.variableName],this.variableName),e[this.variableName]}}class d extends u{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class p extends o.BasePromptTemplate{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new s.ChatPromptValue(t)}}class h extends d{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new n.ChatMessage(await this.prompt.format(e),this.role)}static fromTemplate(e,t){return new this((0,l.PromptTemplate).fromTemplate(e),t)}}class m extends d{static lc_name(){return"HumanMessagePromptTemplate"}async format(e){return new n.HumanMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class f extends d{static lc_name(){return"AIMessagePromptTemplate"}async format(e){return new n.AIMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class g extends d{static lc_name(){return"SystemMessagePromptTemplate"}async format(e){return new n.SystemMessage(await this.prompt.format(e))}static fromTemplate(e){return new this((0,l.PromptTemplate).fromTemplate(e))}}class b extends p{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=new Set;for(let t of this.promptMessages)if(!(t instanceof n.BaseMessage))for(let r of t.inputVariables)e.add(r);let t=this.inputVariables,r=new Set(this.partialVariables?t.concat(Object.keys(this.partialVariables)):t),a=new Set([...r].filter(t=>!e.has(t)));if(a.size>0)throw Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let s=new Set([...e].filter(e=>!r.has(e)));if(s.size>0)throw Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if("string"==typeof e.content)return e;let r=await Promise.all(e.content.map(async e=>{if("image_url"!==e.type||"string"==typeof e.image_url||!e.image_url?.url)return e;let r=e.image_url.url,a=(0,l.PromptTemplate).fromTemplate(r),n=await a.format(t);return e.image_url.url=n,e}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let e of this.promptMessages)if(e instanceof n.BaseMessage)r.push(await this._parseImagePrompts(e,t));else{let a=e.inputVariables.reduce((e,r)=>{if(!(r in t))throw Error(`Missing value for input variable \`${r.toString()}\``);return e[r]=t[r],e},{}),n=await e.formatMessages(a);r=r.concat(n)}return r}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new b({...this,inputVariables:t,partialVariables:r})}static fromTemplate(e){let t=new m({prompt:(0,l.PromptTemplate).fromTemplate(e)});return this.fromMessages([t])}static fromMessages(e){let t=e.reduce((e,t)=>e.concat(t instanceof b?t.promptMessages:[function(e){if("function"==typeof e.formatMessages||(0,n.isBaseMessage)(e))return e;let t=(0,n.coerceMessageLikeToMessage)(e);if("human"===t._getType())return m.fromTemplate(t.content);if("ai"===t._getType())return f.fromTemplate(t.content);if("system"===t._getType())return g.fromTemplate(t.content);if((0,n.ChatMessage).isInstance(t))return h.fromTemplate(t.content,t.role);throw Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}(t)]),[]),r=e.reduce((e,t)=>t instanceof b?Object.assign(e,t.partialVariables):e,Object.create(null)),a=new Set;for(let e of t)if(!(e instanceof n.BaseMessage))for(let t of e.inputVariables)t in r||a.add(t);return new b({inputVariables:[...a],promptMessages:t,partialVariables:r})}static fromPromptMessages(e){return this.fromMessages(e)}}},{"../messages/index.js":"jMGwo","../prompt_values.js":"lGT4D","../runnables/base.js":"1qQoT","./base.js":"579yP","./prompt.js":"2Oph6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2Oph6":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"PromptTemplate",()=>i);var n=e("./string.js"),s=e("./template.js");class i extends n.BaseStringPromptTemplate{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.checkValidTemplate)(this.template,this.templateFormat,e)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return(0,s.renderTemplate)(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a="\n\n",n=""){return new i({inputVariables:r,template:[n,...e,t].join(a)})}static fromTemplate(e,{templateFormat:t="f-string",...r}={}){let a=new Set;return(0,s.parseTemplate)(e,t).forEach(e=>{"variable"===e.type&&a.add(e.name)}),new i({inputVariables:[...a],templateFormat:t,template:e,...r})}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new i({...this,inputVariables:t,partialVariables:r})}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw Error("Prompt template must have a template");return new i({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}},{"./string.js":"GINku","./template.js":"2ZN2o","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],GINku:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseStringPromptTemplate",()=>i);var n=e("../prompt_values.js"),s=e("./base.js");class i extends s.BasePromptTemplate{async formatPromptValue(e){let t=await this.format(e);return new n.StringPromptValue(t)}}},{"../prompt_values.js":"lGT4D","./base.js":"579yP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2ZN2o":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"parseFString",()=>n),a.export(r,"interpolateFString",()=>s),a.export(r,"DEFAULT_FORMATTER_MAPPING",()=>i),a.export(r,"DEFAULT_PARSER_MAPPING",()=>o),a.export(r,"renderTemplate",()=>l),a.export(r,"parseTemplate",()=>u),a.export(r,"checkValidTemplate",()=>c);let n=e=>{let t=e.split(""),r=[],a=(e,r)=>{for(let a=r;a<t.length;a+=1)if(e.includes(t[a]))return a;return -1},n=0;for(;n<t.length;)if("{"===t[n]&&n+1<t.length&&"{"===t[n+1])r.push({type:"literal",text:"{"}),n+=2;else if("}"===t[n]&&n+1<t.length&&"}"===t[n+1])r.push({type:"literal",text:"}"}),n+=2;else if("{"===t[n]){let e=a("}",n);if(e<0)throw Error("Unclosed '{' in template.");r.push({type:"variable",name:t.slice(n+1,e).join("")}),n=e+1}else if("}"===t[n])throw Error("Single '}' in template.");else{let e=a("{}",n),s=(e<0?t.slice(n):t.slice(n,e)).join("");r.push({type:"literal",text:s}),n=e<0?t.length:e}return r},s=(e,t)=>n(e).reduce((e,r)=>{if("variable"===r.type){if(r.name in t)return e+t[r.name];throw Error(`Missing value for input ${r.name}`)}return e+r.text},""),i={"f-string":s},o={"f-string":n},l=(e,t,r)=>i[t](e,r),u=(e,t)=>o[t](e),c=(e,t,r)=>{if(!(t in i)){let e=Object.keys(i);throw Error(`Invalid template format. Got \`${t}\`;
                         should be one of ${e}`)}try{let a=r.reduce((e,t)=>(e[t]="foo",e),{});l(e,t,a)}catch(e){throw Error(`Invalid prompt schema: ${e.message}`)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dlll3:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"FewShotPromptTemplate",()=>l),a.export(r,"FewShotChatMessagePromptTemplate",()=>u);var n=e("./string.js"),s=e("./template.js"),i=e("./prompt.js"),o=e("./chat.js");class l extends n.BaseStringPromptTemplate{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new l({...this,inputVariables:t,partialVariables:r})}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(e=>this.examplePrompt.format(e))),n=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,s.renderTemplate)(n,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let t;let{example_prompt:r}=e;if(!r)throw Error("Missing example prompt");let a=await (0,i.PromptTemplate).deserialize(r);if(Array.isArray(e.examples))t=e.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new l({inputVariables:e.input_variables,examplePrompt:a,examples:t,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class u extends o.BaseChatPromptTemplate{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??"\n\n",this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let e=this.inputVariables;this.partialVariables&&(e=e.concat(Object.keys(this.partialVariables))),(0,s.checkValidTemplate)(this.prefix+this.suffix,this.templateFormat,e)}}async getExamples(e){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(e);throw Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(e=>{let t={};return this.examplePrompt.inputVariables.forEach(r=>{t[r]=e[r]}),t});let a=[];for(let e of r){let t=await this.examplePrompt.formatMessages(e);a.push(...t)}return a}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(e=>this.examplePrompt.formatMessages(e)))).flat().map(e=>e.content),n=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return(0,s.renderTemplate)(n,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(t=>!(t in e)),r={...this.partialVariables??{},...e};return new u({...this,inputVariables:t,partialVariables:r})}}},{"./string.js":"GINku","./template.js":"2ZN2o","./prompt.js":"2Oph6","./chat.js":"e9TQ6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l4ncl:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"PipelinePromptTemplate",()=>i);var n=e("./base.js"),s=e("./chat.js");class i extends n.BasePromptTemplate{static lc_name(){return"PipelinePromptTemplate"}constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){let e=this.pipelinePrompts.map(e=>e.name);return[...new Set(this.pipelinePrompts.map(t=>t.prompt.inputVariables.filter(t=>!e.includes(t))).flat())]}static extractRequiredInputValues(e,t){return t.reduce((t,r)=>(t[r]=e[r],t),{})}async formatPipelinePrompts(e){let t=await this.mergePartialAndUserVariables(e);for(let{name:e,prompt:r}of this.pipelinePrompts){let a=i.extractRequiredInputValues(t,r.inputVariables);r instanceof s.ChatPromptTemplate?t[e]=await r.formatMessages(a):t[e]=await r.format(a)}return i.extractRequiredInputValues(t,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(t=>!(t in e)),t.partialVariables={...this.partialVariables??{},...e},new i(t)}serialize(){throw Error("Not implemented.")}_getPromptType(){return"pipeline"}}},{"./base.js":"579yP","./chat.js":"e9TQ6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4W5FO":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bl3jj:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/example_selectors/index.js");a.exportAll(n,r)},{"./dist/example_selectors/index.js":"eunkP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],eunkP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./base.js");a.exportAll(n,r);var s=e("./conditional.js");a.exportAll(s,r);var i=e("./length_based.js");a.exportAll(i,r);var o=e("./semantic_similarity.js");a.exportAll(o,r)},{"./base.js":"kdOmw","./conditional.js":"by0Rq","./length_based.js":"6Q0Rh","./semantic_similarity.js":"hNj0Q","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kdOmw:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseExampleSelector",()=>s);var n=e("../load/serializable.js");class s extends n.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","example_selectors","base"]})}}},{"../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],by0Rq:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptSelector",()=>n),a.export(r,"ConditionalPromptSelector",()=>s),a.export(r,"isLLM",()=>i),a.export(r,"isChatModel",()=>o);class n{async getPromptAsync(e,t){return this.getPrompt(e).partial(t?.partialVariables??{})}}class s extends n{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(let[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function i(e){return"base_llm"===e._modelType()}function o(e){return"base_chat_model"===e._modelType()}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6Q0Rh":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LengthBasedExampleSelector",()=>i);var n=e("./base.js");function s(e){return e.split(/\n| /).length}class i extends n.BaseExampleSelector{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??s}async addExample(e){this.examples.push(e);let t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;let{examples:r,examplePrompt:a}=t;return(await Promise.all(r.map(e=>a.format(e)))).map(e=>this.getTextLength(e))}async selectExamples(e){let t=Object.values(e).join(" "),r=this.maxLength-this.getTextLength(t),a=0,n=[];for(;r>0&&a<this.examples.length;){let e=r-this.exampleTextLengths[a];if(e<0)break;n.push(this.examples[a]),r=e,a+=1}return n}static async fromExamples(e,t){let r=new i(t);return await Promise.all(e.map(e=>r.addExample(e))),r}}},{"./base.js":"kdOmw","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hNj0Q:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"SemanticSimilarityExampleSelector",()=>o);var n=e("../documents/document.js"),s=e("./base.js");function i(e){return Object.keys(e).sort().map(t=>e[t])}class o extends s.BaseExampleSelector{constructor(e){if(super(e),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,void 0!==e.vectorStore)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else if(e.vectorStoreRetriever)this.vectorStoreRetriever=e.vectorStoreRetriever;else throw Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(e){let t=i((this.inputKeys??Object.keys(e)).reduce((t,r)=>({...t,[r]:e[r]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new n.Document({pageContent:t,metadata:e})])}async selectExamples(e){let t=i((this.inputKeys??Object.keys(e)).reduce((t,r)=>({...t,[r]:e[r]}),{})).join(" "),r=(await this.vectorStoreRetriever.invoke(t)).map(e=>e.metadata);return this.exampleKeys?r.map(e=>this.exampleKeys.reduce((t,r)=>({...t,[r]:e[r]}),{})):r}static async fromExamples(e,t,r,a={}){let n=a.inputKeys??null,s=e.map(e=>i(n?n.reduce((t,r)=>({...t,[r]:e[r]}),{}):e).join(" "));return new o({vectorStore:await r.fromTexts(s,e,t,a),k:a.k??4,exampleKeys:a.exampleKeys,inputKeys:a.inputKeys})}}},{"../documents/document.js":"ehyuz","./base.js":"kdOmw","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ehyuz:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Document",()=>n);class n{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5hMVk":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"NoOpOutputParser",()=>s);var n=e("../schema/output_parser.js");class s extends n.BaseOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}},{"../schema/output_parser.js":"16nfg","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"16nfg":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("@langchain/core/output_parsers");a.exportAll(n,r)},{"@langchain/core/output_parsers":"lJN8i","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lJN8i:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/output_parsers/index.js");a.exportAll(n,r)},{"./dist/output_parsers/index.js":"hzU2F","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hzU2F:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./base.js");a.exportAll(n,r);var s=e("./bytes.js");a.exportAll(s,r);var i=e("./list.js");a.exportAll(i,r);var o=e("./string.js");a.exportAll(o,r);var l=e("./transform.js");a.exportAll(l,r)},{"./base.js":"3zc8q","./bytes.js":"dx60x","./list.js":"6V3b3","./string.js":"6QMX2","./transform.js":"bTKRm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3zc8q":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseLLMOutputParser",()=>s),a.export(r,"BaseOutputParser",()=>i),a.export(r,"OutputParserException",()=>o);var n=e("../runnables/index.js");class s extends n.Runnable{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async e=>this.parseResult([{text:e}]),e,{...t,runType:"parser"}):this._callWithConfig(async e=>this.parseResult([{message:e,text:"string"==typeof e.content?e.content:JSON.stringify(e.content)}]),e,{...t,runType:"parser"})}}class i extends s{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}}class o extends Error{constructor(e,t,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=a,a&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}},{"../runnables/index.js":"5rS6H","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5rS6H":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Runnable",()=>n.Runnable),a.export(r,"RunnableBinding",()=>n.RunnableBinding),a.export(r,"RunnableEach",()=>n.RunnableEach),a.export(r,"RunnableRetry",()=>n.RunnableRetry),a.export(r,"RunnableSequence",()=>n.RunnableSequence),a.export(r,"RunnableMap",()=>n.RunnableMap),a.export(r,"RunnableParallel",()=>n.RunnableParallel),a.export(r,"RunnableLambda",()=>n.RunnableLambda),a.export(r,"RunnableWithFallbacks",()=>n.RunnableWithFallbacks),a.export(r,"_coerceToRunnable",()=>n._coerceToRunnable),a.export(r,"RunnablePassthrough",()=>s.RunnablePassthrough),a.export(r,"RunnableAssign",()=>s.RunnableAssign),a.export(r,"RouterRunnable",()=>i.RouterRunnable),a.export(r,"RunnableBranch",()=>o.RunnableBranch),a.export(r,"RunnableWithMessageHistory",()=>l.RunnableWithMessageHistory);var n=e("./base.js"),s=e("./passthrough.js"),i=e("./router.js"),o=e("./branch.js"),l=e("./history.js")},{"./base.js":"1qQoT","./passthrough.js":"5OMha","./router.js":"khJ4x","./branch.js":"bSfPO","./history.js":"iIyn0","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5OMha":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunnableAssign",()=>s),a.export(r,"RunnablePassthrough",()=>i);var n=e("./base.js");class s extends n.Runnable{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}}class i extends n.Runnable{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"RunnablePassthrough"}async invoke(e,t){return this._callWithConfig(e=>Promise.resolve(e),e,t)}static assign(e){return new s(new n.RunnableMap({steps:e}))}}},{"./base.js":"1qQoT","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],khJ4x:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RouterRunnable",()=>s);var n=e("./base.js");class s extends n.Runnable{static lc_name(){return"RouterRunnable"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,t){let{key:r,input:a}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.invoke(a,t)}async batch(e,t,r){let a=e.map(e=>e.key),n=e.map(e=>e.input);if(void 0!==a.find(e=>void 0===this.runnables[e]))throw Error("One or more keys do not have a corresponding runnable.");let s=a.map(e=>this.runnables[e]),i=this._getOptionsList(t??{},e.length),o=r?.maxConcurrency&&r.maxConcurrency>0?r?.maxConcurrency:e.length,l=[];for(let e=0;e<n.length;e+=o){let t=n.slice(e,e+o).map((e,t)=>s[t].invoke(e,i[t])),r=await Promise.all(t);l.push(r)}return l.flat()}async stream(e,t){let{key:r,input:a}=e,n=this.runnables[r];if(void 0===n)throw Error(`No runnable associated with key "${r}".`);return n.stream(a,t)}}},{"./base.js":"1qQoT","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bSfPO:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunnableBranch",()=>s);var n=e("./base.js");class s extends n.Runnable{static lc_name(){return"RunnableBranch"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"default",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw Error("RunnableBranch requires at least one branch");return new this({branches:e.slice(0,-1).map(([e,t])=>[(0,n._coerceToRunnable)(e),(0,n._coerceToRunnable)(t)]),default:(0,n._coerceToRunnable)(e[e.length-1])})}async _invoke(e,t,r){let a;for(let n=0;n<this.branches.length;n+=1){let[s,i]=this.branches[n];if(await s.invoke(e,this._patchConfig(t,r?.getChild(`condition:${n+1}`)))){a=await i.invoke(e,this._patchConfig(t,r?.getChild(`branch:${n+1}`)));break}}return a||(a=await this.default.invoke(e,this._patchConfig(t,r?.getChild("default")))),a}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}}},{"./base.js":"1qQoT","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],iIyn0:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunnableWithMessageHistory",()=>o);var n=e("../messages/index.js"),s=e("./base.js"),i=e("./passthrough.js");class o extends s.RunnableBinding{constructor(e){let t=new(0,s.RunnableLambda)({func:(e,t)=>this._enterHistory(e,t??{})}).withConfig({runName:"loadHistory"}),r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=(0,i.RunnablePassthrough).assign({[r]:t}).withConfig({runName:"insertHistory"})),super({...e,config:e.config??{},bound:t.pipe(e.runnable.withListeners({onEnd:(e,t)=>this._exitHistory(e,t??{})})).withConfig({runName:"RunnableWithMessageHistory"})}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){return"string"==typeof e?[new n.HumanMessage(e)]:Array.isArray(e)?e:[e]}_getOutputMessages(e){let t=e;if(Array.isArray(e)||(0,n.isBaseMessage)(e)||"string"==typeof e||(t=e[this.outputMessagesKey??"output"]),"string"==typeof t)return[new n.AIMessage(t)];if(Array.isArray(t))return t;if((0,n.isBaseMessage)(t))return[t];throw Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}_enterHistory(e,t){let r=t?.config?.configurable?.messageHistory;if(this.historyMessagesKey)return r.messages;let a=e||(this.inputMessagesKey?e[this.inputMessagesKey]:void 0);return[...r?r.messages:[],...this._getInputMessages(a)]}async _exitHistory(e,t){let r=t.configurable?.messageHistory,{inputs:a}=e,n=a[this.inputMessagesKey??"input"],s=this._getInputMessages(n),i=e.outputs;if(!i)throw Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);for await(let e of[...s,...this._getOutputMessages(i)])await r.addMessage(e)}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let e={[this.inputMessagesKey??"input"]:"foo"};throw Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(e)}, ${JSON.stringify({configurable:{sessionId:"123"}})})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}}},{"../messages/index.js":"jMGwo","./base.js":"1qQoT","./passthrough.js":"5OMha","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dx60x:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BytesOutputParser",()=>s);var n=e("./transform.js");class s extends n.BaseTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","bytes"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}},{"./transform.js":"bTKRm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bTKRm:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseTransformOutputParser",()=>l),a.export(r,"BaseCumulativeTransformOutputParser",()=>u);var n=e("./base.js"),s=e("../messages/index.js"),i=e("../outputs.js"),o=e("../utils/@cfworker/json-schema/index.js");class l extends n.BaseOutputParser{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:"string"==typeof t.content?t.content:JSON.stringify(t.content)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class u extends l{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let a of e){let e;if("string"!=typeof a&&"string"!=typeof a.content)throw Error("Cannot handle non-string output.");if((0,s.isBaseMessageChunk)(a)){if("string"!=typeof a.content)throw Error("Cannot handle non-string message output.");e=new i.ChatGenerationChunk({message:a,text:a.content})}else if((0,s.isBaseMessage)(a)){if("string"!=typeof a.content)throw Error("Cannot handle non-string message output.");e=new i.ChatGenerationChunk({message:a.toChunk(),text:a.content})}else e=new i.GenerationChunk({text:a});r=void 0===r?e:r.concat(e);let n=await this.parsePartialResult([r]);null==n||(0,o.deepCompareStrict)(n,t)||(this.diff?yield this._diff(t,n):yield n,t=n)}}}},{"./base.js":"3zc8q","../messages/index.js":"jMGwo","../outputs.js":"l1AvI","../utils/@cfworker/json-schema/index.js":"51hpx","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"51hpx":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./src/index.js");a.exportAll(n,r)},{"./src/index.js":"7abhE","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7abhE":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./deep-compare-strict.js");a.exportAll(n,r);var s=e("./dereference.js");a.exportAll(s,r);var i=e("./format.js");a.exportAll(i,r);var o=e("./pointer.js");a.exportAll(o,r);var l=e("./types.js");a.exportAll(l,r);var u=e("./ucs2-length.js");a.exportAll(u,r);var c=e("./validate.js");a.exportAll(c,r);var d=e("./validator.js");a.exportAll(d,r)},{"./deep-compare-strict.js":"cXbUU","./dereference.js":"bYI0J","./format.js":"erPEo","./pointer.js":"c8POP","./types.js":"7pwjt","./ucs2-length.js":"7ZTHb","./validate.js":"8Qmxd","./validator.js":"iBo0e","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cXbUU:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"deepCompareStrict",()=>function e(t,r){let a=typeof t;if(a!==typeof r)return!1;if(Array.isArray(t)){if(!Array.isArray(r))return!1;let a=t.length;if(a!==r.length)return!1;for(let n=0;n<a;n++)if(!e(t[n],r[n]))return!1;return!0}if("object"===a){if(!t||!r)return t===r;let a=Object.keys(t),n=Object.keys(r);if(a.length!==n.length)return!1;for(let n of a)if(!e(t[n],r[n]))return!1;return!0}return t===r})},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bYI0J:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"schemaKeyword",()=>s),a.export(r,"schemaArrayKeyword",()=>i),a.export(r,"schemaMapKeyword",()=>o),a.export(r,"ignoredKeyword",()=>l),a.export(r,"initialBaseURI",()=>u),a.export(r,"dereference",()=>function e(t,r=Object.create(null),a=u,s=""){if(t&&"object"==typeof t&&!Array.isArray(t)){let n=t.$id||t.id;if(n){let i=new URL(n,a.href);i.hash.length>1?r[i.href]=t:(i.hash="",""===s?a=i:e(t,r,a))}}else if(!0!==t&&!1!==t)return r;let c=a.href+(s?"#"+s:"");if(void 0!==r[c])throw Error(`Duplicate schema URI "${c}".`);if(r[c]=t,!0===t||!1===t)return r;if(void 0===t.__absolute_uri__&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:c}),t.$ref&&void 0===t.__absolute_ref__){let e=new URL(t.$ref,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:e.href})}if(t.$recursiveRef&&void 0===t.__absolute_recursive_ref__){let e=new URL(t.$recursiveRef,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:e.href})}for(let u in t.$anchor&&(r[new URL("#"+t.$anchor,a.href).href]=t),t){if(l[u])continue;let c=`${s}/${(0,n.encodePointer)(u)}`,d=t[u];if(Array.isArray(d)){if(i[u]){let t=d.length;for(let n=0;n<t;n++)e(d[n],r,a,`${c}/${n}`)}}else if(o[u])for(let t in d)e(d[t],r,a,`${c}/${(0,n.encodePointer)(t)}`);else e(d,r,a,c)}return r});var n=e("./pointer.js");let s={additionalItems:!0,unevaluatedItems:!0,items:!0,contains:!0,additionalProperties:!0,unevaluatedProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},i={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},o={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},l={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},u="undefined"!=typeof self&&self.location?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker")},{"./pointer.js":"c8POP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],c8POP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){return encodeURI(s(e))}function s(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}a.defineInteropFlag(r),a.export(r,"encodePointer",()=>n),a.export(r,"escapePointer",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],erPEo:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"fullFormat",()=>l),a.export(r,"fastFormat",()=>u);let n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,s=[0,31,28,31,30,31,30,31,31,30,31,30,31],i=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function o(e){return e.test.bind(e)}let l={date:c,time:d.bind(void 0,!1),"date-time":function(e){let t=e.split(p);return 2==t.length&&c(t[0])&&d(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return h.test(e)&&m.test(e)},"uri-reference":o(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":o(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:o(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...a]=e.split("@");return!(!t||!r||0!==a.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:o(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:o(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:o(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(f.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}},uuid:o(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":o(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":o(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":o(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)},u={...l,date:o(/^\d\d\d\d-[0-1]\d-[0-3]\d$/),time:o(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i),"date-time":o(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i),"uri-reference":o(/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i)};function c(e){var t;let r=e.match(n);if(!r)return!1;let a=+r[1],i=+r[2],o=+r[3];return i>=1&&i<=12&&o>=1&&o<=(2==i&&(t=a)%4==0&&(t%100!=0||t%400==0)?29:s[i])}function d(e,t){let r=t.match(i);if(!r)return!1;let a=+r[1],n=+r[2],s=+r[3],o=!!r[5];return(a<=23&&n<=59&&s<=59||23==a&&59==n&&60==s)&&(!e||o)}let p=/t|\s/i,h=/\/|:/,m=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,f=/[^\\]\\Z/},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7pwjt":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7ZTHb":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){let t,r=0,a=e.length,n=0;for(;n<a;)r++,(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<a&&(64512&(t=e.charCodeAt(n)))==56320&&n++;return r}a.defineInteropFlag(r),a.export(r,"ucs2length",()=>n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8Qmxd":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"validate",()=>function e(t,r,a="2019-09",u=(0,s.dereference)(r),c=!0,d=null,p="#",h="#",m=Object.create(null)){let f;if(!0===r)return{valid:!0,errors:[]};if(!1===r)return{valid:!1,errors:[{instanceLocation:p,keyword:"false",keywordLocation:p,error:"False boolean schema."}]};let g=typeof t;switch(g){case"boolean":case"number":case"string":f=g;break;case"object":f=null===t?"null":Array.isArray(t)?"array":"object";break;default:throw Error(`Instances of "${g}" type are not supported.`)}let{$ref:b,$recursiveRef:y,$recursiveAnchor:v,type:w,const:_,enum:j,required:x,not:P,anyOf:C,allOf:O,oneOf:T,if:S,then:k,else:R,format:E,properties:I,patternProperties:A,additionalProperties:M,unevaluatedProperties:$,minProperties:N,maxProperties:L,propertyNames:F,dependentRequired:B,dependentSchemas:D,dependencies:z,prefixItems:U,items:V,additionalItems:H,unevaluatedItems:K,contains:q,minContains:G,maxContains:J,minItems:W,maxItems:Q,uniqueItems:Y,minimum:Z,maximum:X,exclusiveMinimum:ee,exclusiveMaximum:et,multipleOf:er,minLength:ea,maxLength:en,pattern:es,__absolute_ref__:ei,__absolute_recursive_ref__:eo}=r,el=[];if(!0===v&&null===d&&(d=r),"#"===y){let n=null===d?u[eo]:d,s=`${h}/$recursiveRef`,i=e(t,null===d?r:d,a,u,c,n,p,s,m);i.valid||el.push({instanceLocation:p,keyword:"$recursiveRef",keywordLocation:s,error:"A subschema had errors."},...i.errors)}if(void 0!==b){let r=u[ei||b];if(void 0===r){let e=`Unresolved $ref "${b}".`;throw ei&&ei!==b&&(e+=`  Absolute URI "${ei}".`),Error(e+=`
Known schemas:
- ${Object.keys(u).join("\n- ")}`)}let n=`${h}/$ref`,s=e(t,r,a,u,c,d,p,n,m);if(s.valid||el.push({instanceLocation:p,keyword:"$ref",keywordLocation:n,error:"A subschema had errors."},...s.errors),"4"===a||"7"===a)return{valid:0===el.length,errors:el}}if(Array.isArray(w)){let e=w.length,r=!1;for(let a=0;a<e;a++)if(f===w[a]||"integer"===w[a]&&"number"===f&&t%1==0&&t==t){r=!0;break}r||el.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${f}" is invalid. Expected "${w.join('", "')}".`})}else"integer"===w?("number"!==f||t%1||t!=t)&&el.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${f}" is invalid. Expected "${w}".`}):void 0!==w&&f!==w&&el.push({instanceLocation:p,keyword:"type",keywordLocation:`${h}/type`,error:`Instance type "${f}" is invalid. Expected "${w}".`});if(void 0===_||("object"===f||"array"===f?(0,n.deepCompareStrict)(t,_)||el.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(_)}.`}):t!==_&&el.push({instanceLocation:p,keyword:"const",keywordLocation:`${h}/const`,error:`Instance does not match ${JSON.stringify(_)}.`})),void 0===j||("object"===f||"array"===f?j.some(e=>(0,n.deepCompareStrict)(t,e))||el.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(j)}.`}):j.some(e=>t===e)||el.push({instanceLocation:p,keyword:"enum",keywordLocation:`${h}/enum`,error:`Instance does not match any of ${JSON.stringify(j)}.`})),void 0!==P){let r=`${h}/not`;e(t,P,a,u,c,d,p,r).valid&&el.push({instanceLocation:p,keyword:"not",keywordLocation:r,error:'Instance matched "not" schema.'})}let eu=[];if(void 0!==C){let r=`${h}/anyOf`,n=el.length,s=!1;for(let n=0;n<C.length;n++){let i=C[n],o=Object.create(m),l=e(t,i,a,u,c,!0===v?d:null,p,`${r}/${n}`,o);el.push(...l.errors),s=s||l.valid,l.valid&&eu.push(o)}s?el.length=n:el.splice(n,0,{instanceLocation:p,keyword:"anyOf",keywordLocation:r,error:"Instance does not match any subschemas."})}if(void 0!==O){let r=`${h}/allOf`,n=el.length,s=!0;for(let n=0;n<O.length;n++){let i=O[n],o=Object.create(m),l=e(t,i,a,u,c,!0===v?d:null,p,`${r}/${n}`,o);el.push(...l.errors),s=s&&l.valid,l.valid&&eu.push(o)}s?el.length=n:el.splice(n,0,{instanceLocation:p,keyword:"allOf",keywordLocation:r,error:"Instance does not match every subschema."})}if(void 0!==T){let r=`${h}/oneOf`,n=el.length,s=T.filter((n,s)=>{let i=Object.create(m),o=e(t,n,a,u,c,!0===v?d:null,p,`${r}/${s}`,i);return el.push(...o.errors),o.valid&&eu.push(i),o.valid}).length;1===s?el.length=n:el.splice(n,0,{instanceLocation:p,keyword:"oneOf",keywordLocation:r,error:`Instance does not match exactly one subschema (${s} matches).`})}if(("object"===f||"array"===f)&&Object.assign(m,...eu),void 0!==S){let r=`${h}/if`;if(e(t,S,a,u,c,d,p,r,m).valid){if(void 0!==k){let n=e(t,k,a,u,c,d,p,`${h}/then`,m);n.valid||el.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "then" schema.'},...n.errors)}}else if(void 0!==R){let n=e(t,R,a,u,c,d,p,`${h}/else`,m);n.valid||el.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "else" schema.'},...n.errors)}}if("object"===f){if(void 0!==x)for(let e of x)e in t||el.push({instanceLocation:p,keyword:"required",keywordLocation:`${h}/required`,error:`Instance does not have required property "${e}".`});let r=Object.keys(t);if(void 0!==N&&r.length<N&&el.push({instanceLocation:p,keyword:"minProperties",keywordLocation:`${h}/minProperties`,error:`Instance does not have at least ${N} properties.`}),void 0!==L&&r.length>L&&el.push({instanceLocation:p,keyword:"maxProperties",keywordLocation:`${h}/maxProperties`,error:`Instance does not have at least ${L} properties.`}),void 0!==F){let r=`${h}/propertyNames`;for(let n in t){let t=`${p}/${(0,o.encodePointer)(n)}`,s=e(n,F,a,u,c,d,t,r);s.valid||el.push({instanceLocation:p,keyword:"propertyNames",keywordLocation:r,error:`Property name "${n}" does not match schema.`},...s.errors)}}if(void 0!==B){let e=`${h}/dependantRequired`;for(let r in B)if(r in t)for(let a of B[r])a in t||el.push({instanceLocation:p,keyword:"dependentRequired",keywordLocation:e,error:`Instance has "${r}" but does not have "${a}".`})}if(void 0!==D)for(let r in D){let n=`${h}/dependentSchemas`;if(r in t){let s=e(t,D[r],a,u,c,d,p,`${n}/${(0,o.encodePointer)(r)}`,m);s.valid||el.push({instanceLocation:p,keyword:"dependentSchemas",keywordLocation:n,error:`Instance has "${r}" but does not match dependant schema.`},...s.errors)}}if(void 0!==z){let r=`${h}/dependencies`;for(let n in z)if(n in t){let s=z[n];if(Array.isArray(s))for(let e of s)e in t||el.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not have "${e}".`});else{let i=e(t,s,a,u,c,d,p,`${r}/${(0,o.encodePointer)(n)}`);i.valid||el.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${n}" but does not match dependant schema.`},...i.errors)}}}let n=Object.create(null),s=!1;if(void 0!==I){let r=`${h}/properties`;for(let i in I){if(!(i in t))continue;let l=`${p}/${(0,o.encodePointer)(i)}`,h=e(t[i],I[i],a,u,c,d,l,`${r}/${(0,o.encodePointer)(i)}`);if(h.valid)m[i]=n[i]=!0;else if(s=c,el.push({instanceLocation:p,keyword:"properties",keywordLocation:r,error:`Property "${i}" does not match schema.`},...h.errors),s)break}}if(!s&&void 0!==A){let r=`${h}/patternProperties`;for(let i in A){let l=new RegExp(i),h=A[i];for(let f in t){if(!l.test(f))continue;let g=`${p}/${(0,o.encodePointer)(f)}`,b=e(t[f],h,a,u,c,d,g,`${r}/${(0,o.encodePointer)(i)}`);b.valid?m[f]=n[f]=!0:(s=c,el.push({instanceLocation:p,keyword:"patternProperties",keywordLocation:r,error:`Property "${f}" matches pattern "${i}" but does not match associated schema.`},...b.errors))}}}if(s||void 0===M){if(!s&&void 0!==$){let r=`${h}/unevaluatedProperties`;for(let n in t)if(!m[n]){let s=`${p}/${(0,o.encodePointer)(n)}`,i=e(t[n],$,a,u,c,d,s,r);i.valid?m[n]=!0:el.push({instanceLocation:p,keyword:"unevaluatedProperties",keywordLocation:r,error:`Property "${n}" does not match unevaluated properties schema.`},...i.errors)}}}else{let r=`${h}/additionalProperties`;for(let i in t){if(n[i])continue;let l=`${p}/${(0,o.encodePointer)(i)}`,h=e(t[i],M,a,u,c,d,l,r);h.valid?m[i]=!0:(s=c,el.push({instanceLocation:p,keyword:"additionalProperties",keywordLocation:r,error:`Property "${i}" does not match additional properties schema.`},...h.errors))}}}else if("array"===f){void 0!==Q&&t.length>Q&&el.push({instanceLocation:p,keyword:"maxItems",keywordLocation:`${h}/maxItems`,error:`Array has too many items (${t.length} > ${Q}).`}),void 0!==W&&t.length<W&&el.push({instanceLocation:p,keyword:"minItems",keywordLocation:`${h}/minItems`,error:`Array has too few items (${t.length} < ${W}).`});let r=t.length,s=0,i=!1;if(void 0!==U){let n=`${h}/prefixItems`,o=Math.min(U.length,r);for(;s<o;s++){let r=e(t[s],U[s],a,u,c,d,`${p}/${s}`,`${n}/${s}`);if(m[s]=!0,!r.valid&&(i=c,el.push({instanceLocation:p,keyword:"prefixItems",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}}if(void 0!==V){let n=`${h}/items`;if(Array.isArray(V)){let o=Math.min(V.length,r);for(;s<o;s++){let r=e(t[s],V[s],a,u,c,d,`${p}/${s}`,`${n}/${s}`);if(m[s]=!0,!r.valid&&(i=c,el.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}}else for(;s<r;s++){let r=e(t[s],V,a,u,c,d,`${p}/${s}`,n);if(m[s]=!0,!r.valid&&(i=c,el.push({instanceLocation:p,keyword:"items",keywordLocation:n,error:"Items did not match schema."},...r.errors),i))break}if(!i&&void 0!==H){let n=`${h}/additionalItems`;for(;s<r;s++){let r=e(t[s],H,a,u,c,d,`${p}/${s}`,n);m[s]=!0,r.valid||(i=c,el.push({instanceLocation:p,keyword:"additionalItems",keywordLocation:n,error:"Items did not match additional items schema."},...r.errors))}}}if(void 0!==q){if(0===r&&void 0===G)el.push({instanceLocation:p,keyword:"contains",keywordLocation:`${h}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==G&&r<G)el.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array has less items (${r}) than minContains (${G}).`});else{let n=`${h}/contains`,s=el.length,i=0;for(let s=0;s<r;s++){let r=e(t[s],q,a,u,c,d,`${p}/${s}`,n);r.valid?(m[s]=!0,i++):el.push(...r.errors)}i>=(G||0)&&(el.length=s),void 0===G&&void 0===J&&0===i?el.splice(s,0,{instanceLocation:p,keyword:"contains",keywordLocation:n,error:"Array does not contain item matching schema."}):void 0!==G&&i<G?el.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${h}/minContains`,error:`Array must contain at least ${G} items matching schema. Only ${i} items were found.`}):void 0!==J&&i>J&&el.push({instanceLocation:p,keyword:"maxContains",keywordLocation:`${h}/maxContains`,error:`Array may contain at most ${J} items matching schema. ${i} items were found.`})}}if(!i&&void 0!==K){let n=`${h}/unevaluatedItems`;for(;s<r;s++){if(m[s])continue;let r=e(t[s],K,a,u,c,d,`${p}/${s}`,n);m[s]=!0,r.valid||el.push({instanceLocation:p,keyword:"unevaluatedItems",keywordLocation:n,error:"Items did not match unevaluated items schema."},...r.errors)}}if(Y)for(let e=0;e<r;e++){let a=t[e],s="object"==typeof a&&null!==a;for(let i=0;i<r;i++){if(e===i)continue;let r=t[i],o="object"==typeof r&&null!==r;(a===r||s&&o&&(0,n.deepCompareStrict)(a,r))&&(el.push({instanceLocation:p,keyword:"uniqueItems",keywordLocation:`${h}/uniqueItems`,error:`Duplicate items at indexes ${e} and ${i}.`}),e=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER)}}}else if("number"===f){if("4"===a?(void 0!==Z&&(!0===ee&&t<=Z||t<Z)&&el.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${ee?"or equal to ":""} ${Z}.`}),void 0!==X&&(!0===et&&t>=X||t>X)&&el.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${et?"or equal to ":""} ${X}.`})):(void 0!==Z&&t<Z&&el.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${h}/minimum`,error:`${t} is less than ${Z}.`}),void 0!==X&&t>X&&el.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${h}/maximum`,error:`${t} is greater than ${X}.`}),void 0!==ee&&t<=ee&&el.push({instanceLocation:p,keyword:"exclusiveMinimum",keywordLocation:`${h}/exclusiveMinimum`,error:`${t} is less than ${ee}.`}),void 0!==et&&t>=et&&el.push({instanceLocation:p,keyword:"exclusiveMaximum",keywordLocation:`${h}/exclusiveMaximum`,error:`${t} is greater than or equal to ${et}.`})),void 0!==er){let e=t%er;Math.abs(0-e)>=11920929e-14&&Math.abs(er-e)>=11920929e-14&&el.push({instanceLocation:p,keyword:"multipleOf",keywordLocation:`${h}/multipleOf`,error:`${t} is not a multiple of ${er}.`})}}else if("string"===f){let e=void 0===ea&&void 0===en?0:(0,l.ucs2length)(t);void 0!==ea&&e<ea&&el.push({instanceLocation:p,keyword:"minLength",keywordLocation:`${h}/minLength`,error:`String is too short (${e} < ${ea}).`}),void 0!==en&&e>en&&el.push({instanceLocation:p,keyword:"maxLength",keywordLocation:`${h}/maxLength`,error:`String is too long (${e} > ${en}).`}),void 0===es||new RegExp(es).test(t)||el.push({instanceLocation:p,keyword:"pattern",keywordLocation:`${h}/pattern`,error:"String does not match pattern."}),void 0!==E&&i.fastFormat[E]&&!(0,i.fastFormat)[E](t)&&el.push({instanceLocation:p,keyword:"format",keywordLocation:`${h}/format`,error:`String does not match format "${E}".`})}return{valid:0===el.length,errors:el}});var n=e("./deep-compare-strict.js"),s=e("./dereference.js"),i=e("./format.js"),o=e("./pointer.js"),l=e("./ucs2-length.js")},{"./deep-compare-strict.js":"cXbUU","./dereference.js":"bYI0J","./format.js":"erPEo","./pointer.js":"c8POP","./ucs2-length.js":"7ZTHb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],iBo0e:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Validator",()=>i);var n=e("./dereference.js"),s=e("./validate.js");class i{constructor(e,t="2019-09",r=!0){Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"draft",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"shortCircuit",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"lookup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lookup=(0,n.dereference)(e)}validate(e){return(0,s.validate)(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),(0,n.dereference)(e,this.lookup)}}},{"./dereference.js":"bYI0J","./validate.js":"8Qmxd","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6V3b3":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"ListOutputParser",()=>s),a.export(r,"CommaSeparatedListOutputParser",()=>i),a.export(r,"CustomListOutputParser",()=>o);var n=e("./base.js");class s extends n.BaseOutputParser{}class i extends s{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(e=>e.trim())}catch(t){throw new n.OutputParserException(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}}class o extends s{constructor({length:e,separator:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.length=e,this.separator=t||","}async parse(e){try{let t=e.trim().split(this.separator).map(e=>e.trim());if(void 0!==this.length&&t.length!==this.length)throw new n.OutputParserException(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){if(Object.getPrototypeOf(t)===n.OutputParserException.prototype)throw t;throw new n.OutputParserException(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${void 0===this.length?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}}},{"./base.js":"3zc8q","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6QMX2":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"StringOutputParser",()=>s);var n=e("./transform.js");class s extends n.BaseTransformOutputParser{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}}},{"./transform.js":"bTKRm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],o8TEz:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Runnable",()=>n.Runnable),a.export(r,"RunnableBinding",()=>n.RunnableBinding),a.export(r,"RunnableEach",()=>n.RunnableEach),a.export(r,"RunnableRetry",()=>n.RunnableRetry),a.export(r,"RunnableSequence",()=>n.RunnableSequence),a.export(r,"RunnableMap",()=>n.RunnableMap),a.export(r,"RunnableLambda",()=>n.RunnableLambda),a.export(r,"RunnableWithFallbacks",()=>n.RunnableWithFallbacks),a.export(r,"_coerceToRunnable",()=>n._coerceToRunnable);var n=e("@langchain/core/runnables")},{"@langchain/core/runnables":"3oXTe","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3oXTe":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/runnables/index.js");a.exportAll(n,r)},{"./dist/runnables/index.js":"5rS6H","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7jSxq":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"PromptTemplate",()=>n.PromptTemplate);var n=e("@langchain/core/prompts")},{"@langchain/core/prompts":"4KAkE","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}]},["d6V6d"],"d6V6d","parcelRequire3d47"),globalThis.define=t;