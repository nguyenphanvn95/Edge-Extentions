var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,r,a,n,i){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof s[n]&&s[n],l=o.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(e,r){if(!l[e]){if(!t[e]){var a="function"==typeof s[n]&&s[n];if(!r&&a)return a(e,!0);if(o)return o(e,!0);if(c&&"string"==typeof e)return c(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}d.resolve=function(r){var a=t[e][1][r];return null!=a?a:r},d.cache={};var h=l[e]=new u.Module(e);t[e][0].call(h.exports,d,h,h.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=t,u.cache=l,u.parent=o,u.register=function(e,r){t[e]=[function(e,t){t.exports=r},{}]},Object.defineProperty(u,"root",{get:function(){return s[n]}}),s[n]=u;for(var h=0;h<r.length;h++)u(r[h]);if(a){var d=u(a);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd&&e(function(){return d})}}({c5l0I:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"SequentialChain",()=>o),a.export(r,"SimpleSequentialChain",()=>l);var n=e("./base.js"),i=e("../util/set.js");function s(e){return Array.from(e).map(e=>`"${e}"`).join(", ")}class o extends n.BaseChain{static lc_name(){return"SequentialChain"}get inputKeys(){return this.inputVariables}get outputKeys(){return this.outputVariables}constructor(e){if(super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.inputVariables=e.inputVariables,this.outputVariables=e.outputVariables??[],this.outputVariables.length>0&&e.returnAll)throw Error("Either specify variables to return using `outputVariables` or use `returnAll` param. Cannot apply both conditions at the same time.");this.returnAll=e.returnAll??!1,this._validateChains()}_validateChains(){if(0===this.chains.length)throw Error("Sequential chain must have at least one chain.");let e=this.memory?.memoryKeys??[],t=new Set(this.inputKeys),r=new Set(e),a=(0,i.intersection)(t,r);if(a.size>0)throw Error(`The following keys: ${s(a)} are overlapping between memory and input keys of the chain variables. This can lead to unexpected behaviour. Please use input and memory keys that don't overlap.`);let n=(0,i.union)(t,r);for(let e of this.chains){let t=(0,i.difference)(new Set(e.inputKeys),n);if(e.memory&&(t=(0,i.difference)(t,new Set(e.memory.memoryKeys))),t.size>0)throw Error(`Missing variables for chain "${e._chainType()}": ${s(t)}. Only got the following variables: ${s(n)}.`);let r=new Set(e.outputKeys),a=(0,i.intersection)(n,r);if(a.size>0)throw Error(`The following output variables for chain "${e._chainType()}" are overlapping: ${s(a)}. This can lead to unexpected behaviour.`);for(let e of r)n.add(e)}if(0===this.outputVariables.length){if(this.returnAll){let e=(0,i.difference)(n,t);this.outputVariables=Array.from(e)}else this.outputVariables=this.chains[this.chains.length-1].outputKeys}else{let e=(0,i.difference)(new Set(this.outputVariables),new Set(n));if(e.size>0)throw Error(`The following output variables were expected to be in the final chain output but were not found: ${s(e)}.`)}}async _call(e,t){let r={},a=0;for(let n of this.chains)for(let i of(a+=1,Object.keys(r=await n.call(e,t?.getChild(`step_${a}`)))))e[i]=r[i];let n={};for(let t of this.outputVariables)n[t]=e[t];return n}_chainType(){return"sequential_chain"}static async deserialize(e){let t=[],r=e.input_variables,a=e.output_variables;for(let r of e.chains){let e=await (0,n.BaseChain).deserialize(r);t.push(e)}return new o({chains:t,inputVariables:r,outputVariables:a})}serialize(){let e=[];for(let t of this.chains)e.push(t.serialize());return{_type:this._chainType(),input_variables:this.inputVariables,output_variables:this.outputVariables,chains:e}}}class l extends n.BaseChain{static lc_name(){return"SimpleSequentialChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return[this.outputKey]}constructor(e){super(e),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output"}),Object.defineProperty(this,"trimOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chains=e.chains,this.trimOutputs=e.trimOutputs??!1,this._validateChains()}_validateChains(){for(let e of this.chains){if(1!==e.inputKeys.filter(t=>!e.memory?.memoryKeys.includes(t)??!0).length)throw Error(`Chains used in SimpleSequentialChain should all have one input, got ${e.inputKeys.length} for ${e._chainType()}.`);if(1!==e.outputKeys.length)throw Error(`Chains used in SimpleSequentialChain should all have one output, got ${e.outputKeys.length} for ${e._chainType()}.`)}}async _call(e,t){let r=e[this.inputKey],a=0;for(let n of this.chains)a+=1,r=(await n.call({[n.inputKeys[0]]:r,signal:e.signal},t?.getChild(`step_${a}`)))[n.outputKeys[0]],this.trimOutputs&&(r=r.trim()),await t?.handleText(r);return{[this.outputKey]:r}}_chainType(){return"simple_sequential_chain"}static async deserialize(e){let t=[];for(let r of e.chains){let e=await (0,n.BaseChain).deserialize(r);t.push(e)}return new l({chains:t})}serialize(){let e=[];for(let t of this.chains)e.push(t.serialize());return{_type:this._chainType(),chains:e}}}},{"./base.js":"frbpR","../util/set.js":"3XeUY","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],frbpR:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseChain",()=>o);var n=e("../schema/index.js"),i=e("../callbacks/manager.js"),s=e("../base_language/index.js");class o extends s.BaseLangChain{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(e,t,r){if(1!=arguments.length||"object"!=typeof e||"saveContext"in e)super({verbose:t,callbacks:r}),this.memory=e;else{let{memory:t,callbackManager:r,...a}=e;super({...a,callbacks:r??a.callbacks}),this.memory=t}}_selectMemoryInputs(e){let t={...e};return"signal"in t&&delete t.signal,"timeout"in t&&delete t.timeout,t}async invoke(e,t){return this.call(e,t)}_validateOutputs(e){let t=this.outputKeys.filter(t=>!(t in e));if(t.length)throw Error(`Missing output keys: ${t.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(e,t,r=!1){return(this._validateOutputs(t),this.memory&&await this.memory.saveContext(e,t),r)?t:{...e,...t}}serialize(){throw Error("Method not implemented.")}async run(e,t){let r=this.inputKeys.filter(e=>!this.memory?.memoryKeys.includes(e)??!0);if(!(r.length<=1))throw Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);let a=r.length?{[r[0]]:e}:{},n=await this.call(a,t),i=Object.keys(n);if(1===i.length)return n[i[0]];throw Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(e){let t={...e};if(t.timeout&&!t.signal&&(t.signal=AbortSignal.timeout(t.timeout),delete t.timeout),null!=this.memory)for(let[r,a]of Object.entries(await this.memory.loadMemoryVariables(this._selectMemoryInputs(e))))t[r]=a;return t}async call(e,t,r){let a;let s=await this._formatValues(e),o=(0,i.parseCallbackConfigArg)(t),l=await (0,i.CallbackManager).configure(o.callbacks,this.callbacks,o.tags||r,this.tags,o.metadata,this.metadata,{verbose:this.verbose}),c=await l?.handleChainStart(this.toJSON(),s,void 0,void 0,void 0,void 0,o.runName);try{a=await (e.signal?Promise.race([this._call(s,c),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this._call(s,c))}catch(e){throw await c?.handleChainError(e),e}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(e),a),await c?.handleChainEnd(a),Object.defineProperty(a,n.RUN_KEY,{value:c?{runId:c?.runId}:void 0,configurable:!0}),a}async apply(e,t){return Promise.all(e.map(async(e,r)=>this.call(e,t?.[r])))}static async deserialize(t,r={}){switch(t._type){case"llm_chain":{let{LLMChain:r}=await e("2d811e2b51cdeee3");return r.deserialize(t)}case"sequential_chain":{let{SequentialChain:r}=await e("35f78524e5fc8f7c");return r.deserialize(t)}case"simple_sequential_chain":{let{SimpleSequentialChain:r}=await e("35f78524e5fc8f7c");return r.deserialize(t)}case"stuff_documents_chain":{let{StuffDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"map_reduce_documents_chain":{let{MapReduceDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"refine_documents_chain":{let{RefineDocumentsChain:r}=await e("97a14159688e6a69");return r.deserialize(t)}case"vector_db_qa":{let{VectorDBQAChain:a}=await e("2c1a009b6d0f14cc");return a.deserialize(t,r)}case"api_chain":{let{APIChain:r}=await e("4a543ae243292fe");return r.deserialize(t)}default:throw Error(`Invalid prompt type in config: ${t._type}`)}}}},{"../schema/index.js":"gyLhg","../callbacks/manager.js":"4iEvs","../base_language/index.js":"is1pt","2d811e2b51cdeee3":"adwnu","35f78524e5fc8f7c":"d31f3","97a14159688e6a69":"c1KK9","2c1a009b6d0f14cc":"gm0US","4a543ae243292fe":"fl8bW","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],gyLhg:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RUN_KEY",()=>s.RUN_KEY),a.export(r,"BaseMessageChunk",()=>n.BaseMessageChunk),a.export(r,"HumanMessageChunk",()=>n.HumanMessageChunk),a.export(r,"AIMessageChunk",()=>n.AIMessageChunk),a.export(r,"SystemMessageChunk",()=>n.SystemMessageChunk),a.export(r,"FunctionMessage",()=>n.FunctionMessage),a.export(r,"FunctionMessageChunk",()=>n.FunctionMessageChunk),a.export(r,"ToolMessage",()=>n.ToolMessage),a.export(r,"ToolMessageChunk",()=>n.ToolMessageChunk),a.export(r,"ChatMessage",()=>n.ChatMessage),a.export(r,"mapStoredMessageToChatMessage",()=>n.mapStoredMessageToChatMessage),a.export(r,"ChatMessageChunk",()=>n.ChatMessageChunk),a.export(r,"coerceMessageLikeToMessage",()=>n.coerceMessageLikeToMessage),a.export(r,"isBaseMessage",()=>n.isBaseMessage),a.export(r,"isBaseMessageChunk",()=>n.isBaseMessageChunk),a.export(r,"GenerationChunk",()=>s.GenerationChunk),a.export(r,"ChatGenerationChunk",()=>s.ChatGenerationChunk),a.export(r,"BasePromptValue",()=>o.BasePromptValue),a.export(r,"BaseChatMessageHistory",()=>l.BaseChatMessageHistory),a.export(r,"BaseListChatMessageHistory",()=>l.BaseListChatMessageHistory),a.export(r,"BaseCache",()=>c.BaseCache),a.export(r,"BaseMessage",()=>n.BaseMessage),a.export(r,"HumanMessage",()=>n.HumanMessage),a.export(r,"AIMessage",()=>n.AIMessage),a.export(r,"SystemMessage",()=>n.SystemMessage),a.export(r,"BaseChatMessage",()=>u),a.export(r,"HumanChatMessage",()=>h),a.export(r,"AIChatMessage",()=>d),a.export(r,"SystemChatMessage",()=>p),a.export(r,"BaseFileStore",()=>f),a.export(r,"BaseEntityStore",()=>m),a.export(r,"Docstore",()=>g);var n=e("@langchain/core/messages"),i=e("../load/serializable.js"),s=e("@langchain/core/outputs"),o=e("@langchain/core/prompt_values"),l=e("@langchain/core/chat_history"),c=e("@langchain/core/caches");let u=n.BaseMessage,h=n.HumanMessage,d=n.AIMessage,p=n.SystemMessage;class f extends i.Serializable{}class m extends i.Serializable{}class g{}},{"@langchain/core/messages":"avKue","../load/serializable.js":"lzycS","@langchain/core/outputs":"fDkg5","@langchain/core/prompt_values":"5IYhT","@langchain/core/chat_history":"j998g","@langchain/core/caches":"lEHU3","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],avKue:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/messages/index.js");a.exportAll(n,r)},{"./dist/messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jMGwo:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseMessage",()=>s),a.export(r,"BaseMessageChunk",()=>l),a.export(r,"HumanMessage",()=>c),a.export(r,"HumanMessageChunk",()=>u),a.export(r,"AIMessage",()=>h),a.export(r,"AIMessageChunk",()=>d),a.export(r,"SystemMessage",()=>p),a.export(r,"SystemMessageChunk",()=>f),a.export(r,"FunctionMessage",()=>m),a.export(r,"FunctionMessageChunk",()=>g),a.export(r,"ToolMessage",()=>b),a.export(r,"ToolMessageChunk",()=>v),a.export(r,"ChatMessage",()=>y),a.export(r,"isBaseMessage",()=>_),a.export(r,"isBaseMessageChunk",()=>w),a.export(r,"coerceMessageLikeToMessage",()=>j),a.export(r,"ChatMessageChunk",()=>x),a.export(r,"getBufferString",()=>C),a.export(r,"mapStoredMessageToChatMessage",()=>E),a.export(r,"mapStoredMessagesToChatMessages",()=>T),a.export(r,"mapChatMessagesToStoredMessages",()=>O);var n=e("../load/serializable.js");function i(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}class s extends n.Serializable{get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t}),e.additional_kwargs||(e.additional_kwargs={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}toChunk(){let e=this._getType();if("human"===e)return new u({...this});if("ai"===e)return new d({...this});if("system"===e)return new f({...this});if("function"===e)return new g({...this});if(y.isInstance(this))return new x({...this});throw Error("Unknown message type.")}}function o(e){return Array.isArray(e)&&e.every(e=>"number"==typeof e.index)}class l extends s{static _mergeAdditionalKwargs(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(void 0===r[e])r[e]=a;else if(typeof r[e]!=typeof a)throw Error(`additional_kwargs[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if("tool_calls"===e&&o(r[e])&&o(a))for(let t of a)r[e]?.[t.index]!==void 0?r[e]=r[e]?.map((e,r)=>r!==t.index?e:{...e,...t,function:{name:t.function.name??e.function.name,arguments:(e.function.arguments??"")+(t.function.arguments??"")}}):r[e][t.index]=t;else throw Error(`additional_kwargs[${e}] already exists in this message chunk.`)}else r[e]=this._mergeAdditionalKwargs(r[e],a);return r}}class c extends s{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class u extends l{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new u({content:i(this.content,e.content),additional_kwargs:u._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class h extends s{static lc_name(){return"AIMessage"}_getType(){return"ai"}}class d extends l{static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){return new d({content:i(this.content,e.content),additional_kwargs:d._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class p extends s{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class f extends l{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new f({content:i(this.content,e.content),additional_kwargs:f._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs)})}}class m extends s{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class g extends l{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new g({content:i(this.content,e.content),additional_kwargs:g._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),name:this.name??""})}}class b extends s{static lc_name(){return"ToolMessage"}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}_getType(){return"tool"}}class v extends l{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new v({content:i(this.content,e.content),additional_kwargs:v._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),tool_call_id:this.tool_call_id})}}class y extends s{static lc_name(){return"ChatMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}}function _(e){return"function"==typeof e?._getType}function w(e){return _(e)&&"function"==typeof e.concat}function j(e){if("string"==typeof e)return new c(e);if(_(e))return e;let[t,r]=e;if("human"===t||"user"===t)return new c({content:r});if("ai"===t||"assistant"===t)return new h({content:r});if("system"===t)return new p({content:r});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}class x extends l{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new x({content:i(this.content,e.content),additional_kwargs:x._mergeAdditionalKwargs(this.additional_kwargs,e.additional_kwargs),role:this.role})}}function C(e,t="Human",r="AI"){let a=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let i=n.name?`${n.name}, `:"";a.push(`${e}: ${i}${n.content}`)}return a.join("\n")}function E(e){let t=void 0!==e.data?e:{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}};switch(t.type){case"human":return new c(t.data);case"ai":return new h(t.data);case"system":return new p(t.data);case"function":if(void 0===t.data.name)throw Error("Name must be defined for function messages");return new m(t.data);case"tool":if(void 0===t.data.tool_call_id)throw Error("Tool call ID must be defined for tool messages");return new b(t.data);case"chat":if(void 0===t.data.role)throw Error("Role must be defined for chat messages");return new y(t.data);default:throw Error(`Got unexpected type: ${t.type}`)}}function T(e){return e.map(E)}function O(e){return e.map(e=>e.toDict())}},{"../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ihLrn:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"get_lc_unique_name",()=>s),a.export(r,"Serializable",()=>o);var n=e("./map_keys.js");function i(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[n,...i]=e.split(".").reverse();for(let e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}n in t&&void 0!==t[n]&&(a[n]=a[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:(0,n.mapKeys)(Object.keys(t).length?function(e,t){let r=i(e);for(let[e,a]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),s=r;for(let e of n.reverse()){if(void 0===s[e])break;s[e]=i(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,n.keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},{"./map_keys.js":"icngQ","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],icngQ:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"keyToJson",()=>l),a.export(r,"keyFromJson",()=>c),a.export(r,"mapKeys",()=>u);var n=e("decamelize"),i=a.interopDefault(n),s=e("camelcase"),o=a.interopDefault(s);function l(e,t){return t?.[e]||(0,i.default)(e)}function c(e,t){return t?.[e]||(0,o.default)(e)}function u(e,t,r){let a={};for(let n in e)Object.hasOwn(e,n)&&(a[t(n,r)]=e[n]);return a}},{decamelize:"ilxwq",camelcase:"9qpt6","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ilxwq:[function(e,t,r){t.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},{}],"9qpt6":[function(e,t,r){let a=/[\p{Lu}]/u,n=/[\p{Ll}]/u,i=/^[\p{Lu}](?![\p{Lu}])/gu,s=/([\p{Alpha}\p{N}_]|$)/u,o=/[_.\- ]+/,l=RegExp("^"+o.source),c=RegExp(o.source+s.source,"gu"),u=RegExp("\\d+"+s.source,"gu"),h=(e,t,r)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let c=e[l];i&&a.test(c)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&n.test(c)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=t(c)===c&&r(c)!==c,o=s,s=r(c)===c&&t(c)!==c)}return e},d=(e,t)=>(i.lastIndex=0,e.replace(i,e=>t(e))),p=(e,t)=>(c.lastIndex=0,u.lastIndex=0,e.replace(c,(e,r)=>t(r)).replace(u,e=>t(e))),f=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?a(e):r(e):(e!==r(e)&&(e=h(e,r,a)),e=e.replace(l,""),e=t.preserveConsecutiveUppercase?d(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),p(e,a))};t.exports=f,t.exports.default=f},{}],"2SNmR":[function(e,t,r){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||t.hasOwnProperty(r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],lzycS:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("@langchain/core/load/serializable");a.exportAll(n,r)},{"@langchain/core/load/serializable":"5ijQI","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5ijQI":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/load/serializable.js");a.exportAll(n,r)},{"../dist/load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fDkg5:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/outputs.js");a.exportAll(n,r)},{"./dist/outputs.js":"l1AvI","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l1AvI:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RUN_KEY",()=>n),a.export(r,"GenerationChunk",()=>i),a.export(r,"ChatGenerationChunk",()=>s);let n="__run";class i{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class s extends i{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new s({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5IYhT":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/prompt_values.js");a.exportAll(n,r)},{"./dist/prompt_values.js":"lGT4D","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lGT4D:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BasePromptValue",()=>s),a.export(r,"StringPromptValue",()=>o),a.export(r,"ChatPromptValue",()=>l);var n=e("./load/serializable.js"),i=e("./messages/index.js");class s extends n.Serializable{}class o extends s{constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new i.HumanMessage(this.value)]}}class l extends s{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,i.getBufferString)(this.messages)}toChatMessages(){return this.messages}}},{"./load/serializable.js":"ihLrn","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],j998g:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/chat_history.js");a.exportAll(n,r)},{"./dist/chat_history.js":"3VCHZ","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3VCHZ":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseChatMessageHistory",()=>s),a.export(r,"BaseListChatMessageHistory",()=>o);var n=e("./load/serializable.js"),i=e("./messages/index.js");class s extends n.Serializable{}class o extends n.Serializable{addUserMessage(e){return this.addMessage(new i.HumanMessage(e))}addAIChatMessage(e){return this.addMessage(new i.AIMessage(e))}}},{"./load/serializable.js":"ihLrn","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],lEHU3:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/caches.js");a.exportAll(n,r)},{"./dist/caches.js":"etUzK","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],etUzK:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getCacheKey",()=>s),a.export(r,"deserializeStoredGeneration",()=>o),a.export(r,"serializeGeneration",()=>l),a.export(r,"BaseCache",()=>c),a.export(r,"InMemoryCache",()=>h);var n=e("./utils/hash.js"),i=e("./messages/index.js");let s=(...e)=>(0,n.insecureHash)(e.join("_"));function o(e){return void 0!==e.message?{text:e.text,message:(0,i.mapStoredMessageToChatMessage)(e.message)}:{text:e.text}}function l(e){let t={text:e.text};return void 0!==e.message&&(t.message=e.message.toDict()),t}class c{}let u=new Map;class h extends c{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(s(e,t))??null)}async update(e,t,r){this.cache.set(s(e,t),r)}static global(){return new h(u)}}},{"./utils/hash.js":"7B4Xv","./messages/index.js":"jMGwo","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7B4Xv":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"insecureHash",()=>n.insecureHash);var n=e("./js-sha1/hash.js")},{"./js-sha1/hash.js":"ee2G9","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],ee2G9:[function(e,t,r){/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"insecureHash",()=>u);var n="object"==typeof window?window:{},i="0123456789abcdef".split(""),s=[-2147483648,8388608,32768,128],o=[24,16,8,0],l=[];function c(e){e?(l[0]=l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0,this.blocks=l):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}c.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===n.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,i=0,s=e.length||0,l=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),t)for(a=this.start;i<s&&a<64;++i)l[a>>2]|=e[i]<<o[3&a++];else for(a=this.start;i<s&&a<64;++i)(r=e.charCodeAt(i))<128?l[a>>2]|=r<<o[3&a++]:(r<2048?l[a>>2]|=(192|r>>6)<<o[3&a++]:(r<55296||r>=57344?l[a>>2]|=(224|r>>12)<<o[3&a++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++i)),l[a>>2]|=(240|r>>18)<<o[3&a++],l[a>>2]|=(128|r>>12&63)<<o[3&a++]),l[a>>2]|=(128|r>>6&63)<<o[3&a++]),l[a>>2]|=(128|63&r)<<o[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=l[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},c.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=s[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},c.prototype.hash=function(){var e,t,r,a=this.h0,n=this.h1,i=this.h2,s=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=n&i|~n&s,o=(r=a<<5|a>>>27)+e+o+1518500249+l[t]<<0,e=a&(n=n<<30|n>>>2)|~a&i,s=(r=o<<5|o>>>27)+e+s+1518500249+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|~o&n,i=(r=s<<5|s>>>27)+e+i+1518500249+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|~s&a,n=(r=i<<5|i>>>27)+e+n+1518500249+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|~i&o,a=(r=n<<5|n>>>27)+e+a+1518500249+l[t+4]<<0,i=i<<30|i>>>2;for(;t<40;t+=5)e=n^i^s,o=(r=a<<5|a>>>27)+e+o+1859775393+l[t]<<0,e=a^(n=n<<30|n>>>2)^i,s=(r=o<<5|o>>>27)+e+s+1859775393+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,i=(r=s<<5|s>>>27)+e+i+1859775393+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,n=(r=i<<5|i>>>27)+e+n+1859775393+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,a=(r=n<<5|n>>>27)+e+a+1859775393+l[t+4]<<0,i=i<<30|i>>>2;for(;t<60;t+=5)e=n&i|n&s|i&s,o=(r=a<<5|a>>>27)+e+o-1894007588+l[t]<<0,e=a&(n=n<<30|n>>>2)|a&i|n&i,s=(r=o<<5|o>>>27)+e+s-1894007588+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|o&n|a&n,i=(r=s<<5|s>>>27)+e+i-1894007588+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|s&a|o&a,n=(r=i<<5|i>>>27)+e+n-1894007588+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|i&o|s&o,a=(r=n<<5|n>>>27)+e+a-1894007588+l[t+4]<<0,i=i<<30|i>>>2;for(;t<80;t+=5)e=n^i^s,o=(r=a<<5|a>>>27)+e+o-899497514+l[t]<<0,e=a^(n=n<<30|n>>>2)^i,s=(r=o<<5|o>>>27)+e+s-899497514+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,i=(r=s<<5|s>>>27)+e+i-899497514+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,n=(r=i<<5|i>>>27)+e+n-899497514+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,a=(r=n<<5|n>>>27)+e+a-899497514+l[t+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+n<<0,this.h2=this.h2+i<<0,this.h3=this.h3+s<<0,this.h4=this.h4+o<<0},c.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return i[e>>28&15]+i[e>>24&15]+i[e>>20&15]+i[e>>16&15]+i[e>>12&15]+i[e>>8&15]+i[e>>4&15]+i[15&e]+i[t>>28&15]+i[t>>24&15]+i[t>>20&15]+i[t>>16&15]+i[t>>12&15]+i[t>>8&15]+i[t>>4&15]+i[15&t]+i[r>>28&15]+i[r>>24&15]+i[r>>20&15]+i[r>>16&15]+i[r>>12&15]+i[r>>8&15]+i[r>>4&15]+i[15&r]+i[a>>28&15]+i[a>>24&15]+i[a>>20&15]+i[a>>16&15]+i[a>>12&15]+i[a>>8&15]+i[a>>4&15]+i[15&a]+i[n>>28&15]+i[n>>24&15]+i[n>>20&15]+i[n>>16&15]+i[n>>12&15]+i[n>>8&15]+i[n>>4&15]+i[15&n]},c.prototype.toString=c.prototype.hex,c.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n]},c.prototype.array=c.prototype.digest,c.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let u=e=>new c(!0).update(e).hex()},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4iEvs":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("@langchain/core/callbacks/manager");a.exportAll(n,r)},{"@langchain/core/callbacks/manager":"9q1Cx","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9q1Cx":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/callbacks/manager.js");a.exportAll(n,r)},{"../dist/callbacks/manager.js":"fZx9W","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fZx9W:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"parseCallbackConfigArg",()=>d),a.export(r,"BaseCallbackManager",()=>p),a.export(r,"CallbackManagerForRetrieverRun",()=>m),a.export(r,"CallbackManagerForLLMRun",()=>g),a.export(r,"CallbackManagerForChainRun",()=>b),a.export(r,"CallbackManagerForToolRun",()=>v),a.export(r,"CallbackManager",()=>y),a.export(r,"TraceGroup",()=>w),a.export(r,"traceAsGroup",()=>j);var n=e("uuid"),i=e("./base.js"),s=e("../tracers/console.js"),o=e("../tracers/initialize.js"),l=e("../messages/index.js"),c=e("../utils/env.js"),u=e("../tracers/tracer_langchain.js"),h=e("./promises.js");function d(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class p{setHandler(e){return this.setHandlers([e])}}class f{constructor(e,t,r,a,n,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}},t.awaitHandlers)))}}class m extends f{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}},t.awaitHandlers)))}}class g extends f{async handleLLMNewToken(e,t,r,a,n,i){await Promise.all(this.handlers.map(r=>(0,h.consumeCallback)(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}},t.awaitHandlers)))}}class b extends f{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,n){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,n){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}},t.awaitHandlers)))}}class v extends f{getChild(e){let t=new y(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>(0,h.consumeCallback)(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}},t.awaitHandlers)))}}class y extends p{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}async handleLLMStart(e,t,r,a,i,s,o,l){return Promise.all(t.map(async t=>{let r=(0,n.v4)();return await Promise.all(this.handlers.map(a=>(0,h.consumeCallback)(async()=>{if(!a.ignoreLLM)try{await a.handleLLMStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata,l)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,i,s,o,c){return Promise.all(t.map(async t=>{let r=(0,n.v4)();return await Promise.all(this.handlers.map(a=>(0,h.consumeCallback)(async()=>{if(!a.ignoreLLM)try{if(a.handleChatModelStart)await a.handleChatModelStart?.(e,[t],r,this._parentRunId,i,this.tags,this.metadata,c);else if(a.handleLLMStart){let n=(0,l.getBufferString)(t);await a.handleLLMStart?.(e,[n],r,this._parentRunId,i,this.tags,this.metadata,c)}}catch(e){console.error(`Error in handler ${a.constructor.name}, handleLLMStart: ${e}`)}},a.awaitHandlers))),new g(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,n.v4)(),a,i,s,o){return await Promise.all(this.handlers.map(n=>(0,h.consumeCallback)(async()=>{if(!n.ignoreChain)try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(e){console.error(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`)}},n.awaitHandlers))),new b(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.v4)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>(0,h.consumeCallback)(async()=>{if(!a.ignoreAgent)try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}},a.awaitHandlers))),new v(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.v4)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>(0,h.consumeCallback)(async()=>{if(!a.ignoreRetriever)try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}},a.awaitHandlers))),new m(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new y(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends i.BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.v4)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,n,i,l){let u;(e||t)&&(Array.isArray(e)||!e?(u=new y).setHandlers(e?.map(_)??[],!0):u=e,u=u.copy(Array.isArray(t)?t.map(_):t?.handlers,!1));let h="true"===(0,c.getEnvironmentVariable)("LANGCHAIN_VERBOSE")||l?.verbose,d="true"===(0,c.getEnvironmentVariable)("LANGCHAIN_TRACING_V2"),p=d||((0,c.getEnvironmentVariable)("LANGCHAIN_TRACING")??!1);if(h||p){if(u||(u=new y),h&&!u.handlers.some(e=>e.name===s.ConsoleCallbackHandler.prototype.name)){let e=new s.ConsoleCallbackHandler;u.addHandler(e,!0)}if(p&&!u.handlers.some(e=>"langchain_tracer"===e.name)){if(d)u.addHandler(await (0,o.getTracingV2CallbackHandler)(),!0);else{let e=(0,c.getEnvironmentVariable)("LANGCHAIN_PROJECT")&&(0,c.getEnvironmentVariable)("LANGCHAIN_SESSION");u.addHandler(await (0,o.getTracingCallbackHandler)(e),!0)}}}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(n||i)&&u&&(u.addMetadata(n??{}),u.addMetadata(i??{},!1)),u}}function _(e){return"name"in e?e:(0,i.BaseCallbackHandler).fromMethods(e)}class w{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){let a=new u.LangChainTracer(r),n=await y.configure([a]),i=await n?.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{});if(!i)throw Error("Failed to create run group callback manager.");return i}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}async function j(e,t,...r){let a=new w(e.name,e),n=await a.start({...r});try{let e=await t(n,...r);return await a.end(e&&!Array.isArray(e)&&"object"==typeof e?e:{output:e}),e}catch(e){throw await a.error(e),e}}},{uuid:"l36KR","./base.js":"f3sIf","../tracers/console.js":"fPFQ8","../tracers/initialize.js":"kuqFT","../messages/index.js":"jMGwo","../utils/env.js":"2Th20","../tracers/tracer_langchain.js":"dB0hq","./promises.js":"3BeNh","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l36KR:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"v1",()=>i.default),a.export(r,"v3",()=>o.default),a.export(r,"v4",()=>c.default),a.export(r,"v5",()=>h.default),a.export(r,"NIL",()=>p.default),a.export(r,"version",()=>m.default),a.export(r,"validate",()=>b.default),a.export(r,"stringify",()=>y.default),a.export(r,"parse",()=>w.default);var n=e("./v1.js"),i=a.interopDefault(n),s=e("./v3.js"),o=a.interopDefault(s),l=e("./v4.js"),c=a.interopDefault(l),u=e("./v5.js"),h=a.interopDefault(u),d=e("./nil.js"),p=a.interopDefault(d),f=e("./version.js"),m=a.interopDefault(f),g=e("./validate.js"),b=a.interopDefault(g),v=e("./stringify.js"),y=a.interopDefault(v),_=e("./parse.js"),w=a.interopDefault(_)},{"./v1.js":"3PHPC","./v3.js":"3Iz16","./v4.js":"fCvRE","./v5.js":"8bhSy","./nil.js":"8P8RR","./version.js":"amAFP","./validate.js":"dtbjp","./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3PHPC":[function(e,t,r){let a,n;var i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r);var s=e("./rng.js"),o=i.interopDefault(s),l=e("./stringify.js");let c=0,u=0;r.default=function(e,t,r){let i=t&&r||0,s=t||Array(16),h=(e=e||{}).node||a,d=void 0!==e.clockseq?e.clockseq:n;if(null==h||null==d){let t=e.random||(e.rng||(0,o.default))();null==h&&(h=a=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==d&&(d=n=(t[6]<<8|t[7])&16383)}let p=void 0!==e.msecs?e.msecs:Date.now(),f=void 0!==e.nsecs?e.nsecs:u+1,m=p-c+(f-u)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||p>c)&&void 0===e.nsecs&&(f=0),f>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,u=f,n=d;let g=((268435455&(p+=122192928e5))*1e4+f)%4294967296;s[i++]=g>>>24&255,s[i++]=g>>>16&255,s[i++]=g>>>8&255,s[i++]=255&g;let b=p/4294967296*1e4&268435455;s[i++]=b>>>8&255,s[i++]=255&b,s[i++]=b>>>24&15|16,s[i++]=b>>>16&255,s[i++]=d>>>8|128,s[i++]=255&d;for(let e=0;e<6;++e)s[i+e]=h[e];return t||(0,l.unsafeStringify)(s)}},{"./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"5NLI7":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"default",()=>s);let i=new Uint8Array(16);function s(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(i)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cQV7f:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unsafeStringify",()=>o);var n=e("./validate.js"),i=a.interopDefault(n);let s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function o(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}r.default=function(e,t=0){let r=o(e,t);if(!(0,i.default)(r))throw TypeError("Stringified UUID is invalid");return r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dtbjp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./regex.js"),i=a.interopDefault(n);r.default=function(e){return"string"==typeof e&&(0,i.default).test(e)}},{"./regex.js":"8c6XP","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8c6XP":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3Iz16":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./v35.js"),i=a.interopDefault(n),s=e("./md5.js"),o=a.interopDefault(s);let l=(0,i.default)("v3",48,o.default);r.default=l},{"./v35.js":"izhU4","./md5.js":"i4R3s","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],izhU4:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"DNS",()=>o),a.export(r,"URL",()=>l),a.export(r,"default",()=>c);var n=e("./stringify.js"),i=e("./parse.js"),s=a.interopDefault(i);let o="6ba7b810-9dad-11d1-80b4-00c04fd430c8",l="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function c(e,t,r){function a(e,a,i,o){var l;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof a&&(a=(0,s.default)(a)),(null===(l=a)||void 0===l?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(a),c.set(e,a.length),(c=r(c))[6]=15&c[6]|t,c[8]=63&c[8]|128,i){o=o||0;for(let e=0;e<16;++e)i[o+e]=c[e];return i}return(0,n.unsafeStringify)(c)}try{a.name=e}catch(e){}return a.DNS=o,a.URL=l,a}},{"./stringify.js":"cQV7f","./parse.js":"aFeXC","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],aFeXC:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./validate.js"),i=a.interopDefault(n);r.default=function(e){let t;if(!(0,i.default)(e))throw TypeError("Invalid UUID");let r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i4R3s:[function(e,t,r){function a(e){return(e+64>>>9<<4)+14+1}function n(e,t){let r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t,r,a,i,s){var o;return n((o=n(n(t,e),n(a,s)))<<i|o>>>32-i,r)}function s(e,t,r,a,n,s,o){return i(t&r|~t&a,e,t,n,s,o)}function o(e,t,r,a,n,s,o){return i(t&a|r&~a,e,t,n,s,o)}function l(e,t,r,a,n,s,o){return i(t^r^a,e,t,n,s,o)}function c(e,t,r,a,n,s,o){return i(r^(t|~a),e,t,n,s,o)}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){let t=[],r=32*e.length,a="0123456789abcdef";for(let n=0;n<r;n+=8){let r=e[n>>5]>>>n%32&255,i=parseInt(a.charAt(r>>>4&15)+a.charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[a(t)-1]=t;let r=1732584193,i=-271733879,u=-1732584194,h=271733878;for(let t=0;t<e.length;t+=16){let a=r,d=i,p=u,f=h;r=s(r,i,u,h,e[t],7,-680876936),h=s(h,r,i,u,e[t+1],12,-389564586),u=s(u,h,r,i,e[t+2],17,606105819),i=s(i,u,h,r,e[t+3],22,-1044525330),r=s(r,i,u,h,e[t+4],7,-176418897),h=s(h,r,i,u,e[t+5],12,1200080426),u=s(u,h,r,i,e[t+6],17,-1473231341),i=s(i,u,h,r,e[t+7],22,-45705983),r=s(r,i,u,h,e[t+8],7,1770035416),h=s(h,r,i,u,e[t+9],12,-1958414417),u=s(u,h,r,i,e[t+10],17,-42063),i=s(i,u,h,r,e[t+11],22,-1990404162),r=s(r,i,u,h,e[t+12],7,1804603682),h=s(h,r,i,u,e[t+13],12,-40341101),u=s(u,h,r,i,e[t+14],17,-1502002290),i=s(i,u,h,r,e[t+15],22,1236535329),r=o(r,i,u,h,e[t+1],5,-165796510),h=o(h,r,i,u,e[t+6],9,-1069501632),u=o(u,h,r,i,e[t+11],14,643717713),i=o(i,u,h,r,e[t],20,-373897302),r=o(r,i,u,h,e[t+5],5,-701558691),h=o(h,r,i,u,e[t+10],9,38016083),u=o(u,h,r,i,e[t+15],14,-660478335),i=o(i,u,h,r,e[t+4],20,-405537848),r=o(r,i,u,h,e[t+9],5,568446438),h=o(h,r,i,u,e[t+14],9,-1019803690),u=o(u,h,r,i,e[t+3],14,-187363961),i=o(i,u,h,r,e[t+8],20,1163531501),r=o(r,i,u,h,e[t+13],5,-1444681467),h=o(h,r,i,u,e[t+2],9,-51403784),u=o(u,h,r,i,e[t+7],14,1735328473),i=o(i,u,h,r,e[t+12],20,-1926607734),r=l(r,i,u,h,e[t+5],4,-378558),h=l(h,r,i,u,e[t+8],11,-2022574463),u=l(u,h,r,i,e[t+11],16,1839030562),i=l(i,u,h,r,e[t+14],23,-35309556),r=l(r,i,u,h,e[t+1],4,-1530992060),h=l(h,r,i,u,e[t+4],11,1272893353),u=l(u,h,r,i,e[t+7],16,-155497632),i=l(i,u,h,r,e[t+10],23,-1094730640),r=l(r,i,u,h,e[t+13],4,681279174),h=l(h,r,i,u,e[t],11,-358537222),u=l(u,h,r,i,e[t+3],16,-722521979),i=l(i,u,h,r,e[t+6],23,76029189),r=l(r,i,u,h,e[t+9],4,-640364487),h=l(h,r,i,u,e[t+12],11,-421815835),u=l(u,h,r,i,e[t+15],16,530742520),i=l(i,u,h,r,e[t+2],23,-995338651),r=c(r,i,u,h,e[t],6,-198630844),h=c(h,r,i,u,e[t+7],10,1126891415),u=c(u,h,r,i,e[t+14],15,-1416354905),i=c(i,u,h,r,e[t+5],21,-57434055),r=c(r,i,u,h,e[t+12],6,1700485571),h=c(h,r,i,u,e[t+3],10,-1894986606),u=c(u,h,r,i,e[t+10],15,-1051523),i=c(i,u,h,r,e[t+1],21,-2054922799),r=c(r,i,u,h,e[t+8],6,1873313359),h=c(h,r,i,u,e[t+15],10,-30611744),u=c(u,h,r,i,e[t+6],15,-1560198380),i=c(i,u,h,r,e[t+13],21,1309151649),r=c(r,i,u,h,e[t+4],6,-145523070),h=c(h,r,i,u,e[t+11],10,-1120210379),u=c(u,h,r,i,e[t+2],15,718787259),i=c(i,u,h,r,e[t+9],21,-343485551),r=n(r,a),i=n(i,d),u=n(u,p),h=n(h,f)}return[r,i,u,h]}(function(e){if(0===e.length)return[];let t=8*e.length,r=new Uint32Array(a(t));for(let a=0;a<t;a+=8)r[a>>5]|=(255&e[a/8])<<a%32;return r}(e),8*e.length))}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fCvRE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./native.js"),i=a.interopDefault(n),s=e("./rng.js"),o=a.interopDefault(s),l=e("./stringify.js");r.default=function(e,t,r){if(i.default.randomUUID&&!t&&!e)return(0,i.default).randomUUID();let a=(e=e||{}).random||(e.rng||(0,o.default))();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return(0,l.unsafeStringify)(a)}},{"./native.js":"36JDj","./rng.js":"5NLI7","./stringify.js":"cQV7f","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"36JDj":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r);let a="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);r.default={randomUUID:a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8bhSy":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./v35.js"),i=a.interopDefault(n),s=e("./sha1.js"),o=a.interopDefault(s);let l=(0,i.default)("v5",80,o.default);r.default=l},{"./v35.js":"izhU4","./sha1.js":"57fIB","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"57fIB":[function(e,t,r){function a(e,t){return e<<t|e>>>32-t}e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default=function(e){let t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){let t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);let n=Math.ceil((e.length/4+2)/16),i=Array(n);for(let t=0;t<n;++t){let r=new Uint32Array(16);for(let a=0;a<16;++a)r[a]=e[64*t+4*a]<<24|e[64*t+4*a+1]<<16|e[64*t+4*a+2]<<8|e[64*t+4*a+3];i[t]=r}i[n-1][14]=(e.length-1)*8/4294967296,i[n-1][14]=Math.floor(i[n-1][14]),i[n-1][15]=(e.length-1)*8&4294967295;for(let e=0;e<n;++e){let n=new Uint32Array(80);for(let t=0;t<16;++t)n[t]=i[e][t];for(let e=16;e<80;++e)n[e]=a(n[e-3]^n[e-8]^n[e-14]^n[e-16],1);let s=r[0],o=r[1],l=r[2],c=r[3],u=r[4];for(let e=0;e<80;++e){let r=Math.floor(e/20),i=a(s,5)+function(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}(r,o,l,c)+u+t[r]+n[e]>>>0;u=c,c=l,l=a(o,30)>>>0,o=s,s=i}r[0]=r[0]+s>>>0,r[1]=r[1]+o>>>0,r[2]=r[2]+l>>>0,r[3]=r[3]+c>>>0,r[4]=r[4]+u>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"8P8RR":[function(e,t,r){e("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(r),r.default="00000000-0000-0000-0000-000000000000"},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],amAFP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./validate.js"),i=a.interopDefault(n);r.default=function(e){if(!(0,i.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},{"./validate.js":"dtbjp","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],f3sIf:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseCallbackHandler",()=>l);var n=e("uuid"),i=e("../load/serializable.js"),s=e("19649504761b54db");class o{}class l extends o{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,i.get_lc_unique_name)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0===s||s.env?.LANGCHAIN_CALLBACKS_BACKGROUND!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever)}copy(){return new this.constructor(this)}toJSON(){return(0,i.Serializable).prototype.toJSON.call(this)}toJSONNotImplemented(){return(0,i.Serializable).prototype.toJSONNotImplemented.call(this)}static fromMethods(e){return new class extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n.v4()}),Object.assign(this,e)}}}}},{"19649504761b54db":"7XEqq",uuid:"l36KR","../load/serializable.js":"ihLrn","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"7XEqq":[function(e,t,r){let a,n,i,s;var o=Object.create,l=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u=Object.getOwnPropertyNames,h=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,p=(e,t,r,a)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of u(t))d.call(e,n)||n===r||l(e,n,{get:()=>t[n],enumerable:!(a=c(t,n))||a.enumerable});return e},f=(e,t,r)=>(r=null!=e?o(h(e)):{},p(!t&&e&&e.__esModule?r:l(r,"default",{value:e,enumerable:!0}),e)),m=(a=(e,t)=>{var r,a,n=t.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=o(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||u||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}},()=>(n||a((n={exports:{}}).exports,n),n.exports)),g={};((e,t)=>{for(var r in t)l(e,r,{get:t[r],enumerable:!0})})(g,{default:()=>v}),t.exports=p(l({},"__esModule",{value:!0}),g);var b=f(m());i=f(m()),s=t.exports,p(g,i,"default"),s&&p(s,i,"default");var v=b.default},{}],fPFQ8:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"ConsoleCallbackHandler",()=>h);var n=e("ansi-styles"),i=a.interopDefault(n),s=e("./base.js");function o(e,t){return`${e.open}${t}${e.close}`}function l(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function c(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:u}=i.default;class h extends s.BaseTracer{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?o(i.default.bold,a):a}).join(" > ");return o(u.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[chain/start]")} [${t}] Entering Chain run with input: ${l(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[chain/end]")} [${t}] [${c(e)}] Exiting Chain run with output: ${l(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[chain/error]")} [${t}] [${c(e)}] Chain run errored with error: ${l(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${o(u.green,"[llm/start]")} [${t}] Entering LLM run with input: ${l(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[llm/end]")} [${t}] [${c(e)}] Exiting LLM run with output: ${l(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[llm/error]")} [${t}] [${c(e)}] LLM run errored with error: ${l(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[tool/end]")} [${t}] [${c(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[tool/error]")} [${t}] [${c(e)}] Tool run errored with error: ${l(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${l(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.cyan,"[retriever/end]")} [${t}] [${c(e)}] Exiting Retriever run with output: ${l(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.red,"[retriever/error]")} [${t}] [${c(e)}] Retriever run errored with error: ${l(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${o(u.blue,"[agent/action]")} [${t}] Agent selected action: ${l(e.actions[e.actions.length-1],"[action]")}`)}}},{"ansi-styles":"26v5d","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"26v5d":[function(e,t,r){let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,n=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(t,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,n]of Object.entries(a))t[r]={open:`\u001B[${n[0]}m`,close:`\u001B[${n[1]}m`},a[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=n(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=n(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},{}],gsfZb:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseTracer",()=>s);var n=e("../callbacks/base.js");function i(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class s extends n.BaseCallbackHandler{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){if(void 0!==e.parent_run_id){let t=this.runMap.get(e.parent_run_id);t&&(this._addChildRun(t,e),t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order))}this.runMap.set(e.id,e),await this.onRunCreate?.(e)}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,h={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return await this._startTrace(h),await this.onLLMStart?.(h),h}async handleChatModelStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),c=Date.now(),u=s?{...n,metadata:s}:n,h={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:u??{},tags:i||[]};return await this._startTrace(h),await this.onLLMStart?.(h),h}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}async handleChainStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(u),await this.onChainStart?.(u),u}async handleChainEnd(e,t,r,a,n){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=i(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),n?.inputs!==void 0&&(s.inputs=i(n.inputs,"input")),await this.onChainEnd?.(s),await this._endTrace(s),s}async handleChainError(e,t,r,a,n){let s=this.runMap.get(t);if(!s)throw Error("No chain run to end.");return s.end_time=Date.now(),s.error=e.message,s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),n?.inputs!==void 0&&(s.inputs=i(n.inputs,"input")),await this.onChainError?.(s),await this._endTrace(s),s}async handleToolStart(e,t,r,a,n,i,s){let o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(c),await this.onToolStart?.(c),c}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}async handleRetrieverStart(e,t,r,a,n,i,s){let o=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(c),await this.onRetrieverStart?.(c),c}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=e.message,r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,n,i){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(s,e),s}}},{"../callbacks/base.js":"f3sIf","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kuqFT:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getTracingCallbackHandler",()=>s),a.export(r,"getTracingV2CallbackHandler",()=>o);var n=e("./tracer_langchain.js"),i=e("./tracer_langchain_v1.js");async function s(e){let t=new i.LangChainTracerV1;return e?await t.loadSession(e):await t.loadDefaultSession(),t}async function o(){return new n.LangChainTracer}},{"./tracer_langchain.js":"dB0hq","./tracer_langchain_v1.js":"Pa0ga","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],dB0hq:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracer",()=>o);var n=e("langsmith"),i=e("../utils/env.js"),s=e("./base.js");class o extends s.BaseTracer{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,i.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,i.getEnvironmentVariable)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new n.Client({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,i.getRuntimeEnvironment)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async _persistRunSingle(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async _updateRunSingle(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs};await this.client.updateRun(e.id,t)}async onRetrieverStart(e){await this._persistRunSingle(e)}async onRetrieverEnd(e){await this._updateRunSingle(e)}async onRetrieverError(e){await this._updateRunSingle(e)}async onLLMStart(e){await this._persistRunSingle(e)}async onLLMEnd(e){await this._updateRunSingle(e)}async onLLMError(e){await this._updateRunSingle(e)}async onChainStart(e){await this._persistRunSingle(e)}async onChainEnd(e){await this._updateRunSingle(e)}async onChainError(e){await this._updateRunSingle(e)}async onToolStart(e){await this._persistRunSingle(e)}async onToolEnd(e){await this._updateRunSingle(e)}async onToolError(e){await this._updateRunSingle(e)}}},{langsmith:"kvxIp","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],kvxIp:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("./dist/index.js");a.exportAll(n,r)},{"./dist/index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],cCB7g:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>n.Client),a.export(r,"RunTree",()=>i.RunTree),a.export(r,"__version__",()=>s);var n=e("./client.js"),i=e("./run_trees.js");let s="0.0.70"},{"./client.js":"2VxwW","./run_trees.js":"9zMS3","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2VxwW":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Client",()=>g);var n=e("uuid"),i=e("./utils/async_caller.js"),s=e("./utils/messages.js"),o=e("./utils/env.js"),l=e("./index.js");async function c(e){let t=await (0,o.getRuntimeEnvironment)(),r=(0,o.getLangChainEnvVarsMetadata)();return e.map(e=>{let a=e.extra??{},n=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...n}},e})}let u=()=>{let e=(0,o.getEnvironmentVariable)("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;let t=parseFloat(e);if(t<0||t>1)throw Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},h=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t},d=async(e,t)=>{let r=await e.text();if(!e.ok)throw Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};async function p(e){let t=[];for await(let r of e)t.push(r);return t}function f(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function m(e){if(!n.validate(e))throw Error(`Invalid UUID: ${e}`)}class g{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pendingAutoBatchedRuns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50});let t=g.getDefaultClientConfig();this.tracingSampleRate=u(),this.apiUrl=f(e.apiUrl??t.apiUrl)??"",this.apiKey=f(e.apiKey??t.apiKey),this.webUrl=f(e.webUrl??t.webUrl),this.validateApiKeyIfHosted(),this.timeout_ms=e.timeout_ms??12e3,this.caller=new i.AsyncCaller(e.callerOptions??{}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit}static getDefaultClientConfig(){let e=(0,o.getEnvironmentVariable)("LANGCHAIN_API_KEY");return{apiUrl:(0,o.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",apiKey:e,webUrl:void 0,hideInputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_INPUTS"),hideOutputs:"true"===(0,o.getEnvironmentVariable)("LANGCHAIN_HIDE_OUTPUTS")}}validateApiKeyIfHosted(){if(!h(this.apiUrl)&&!this.apiKey)throw Error("API key must be provided when using hosted LangSmith API")}getHostUrl(){return this.webUrl?this.webUrl:h(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${l.__version__}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs?{}:e}processOutputs(e){return this.hideOutputs?{}:e}prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,n=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let n=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!i.ok)throw Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);let s=await i.json();if(0===s.length||(yield s,s.length<a))break;r+=s.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let n=t?{...t}:{};for(;;){let t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),body:JSON.stringify(n)}),i=await t.json();if(!i||!i[a])break;yield i[a];let s=i.cursors;if(!s||!s.next)break;n.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.sampledPostUuids.has(r.id)&&(t.push(r),this.sampledPostUuids.delete(r.id));return t}{let t=[];for(let r of e)Math.random()<this.tracingSampleRate&&(t.push(r),this.sampledPostUuids.add(r.id));return t}}async triggerAutoBatchSend(e){let t=e;void 0===t&&(t=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit),this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit)),await this.batchIngestRuns({runCreates:t.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:t.filter(e=>"update"===e.action).map(e=>e.item)})}appendRunCreateToAutoBatchQueue(e){let t=this.autoBatchTimeout;for(clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,this.pendingAutoBatchedRuns.push(e);this.pendingAutoBatchedRuns.length>=this.pendingAutoBatchedRunLimit;){let e=this.pendingAutoBatchedRuns.slice(0,this.pendingAutoBatchedRunLimit);this.pendingAutoBatchedRuns=this.pendingAutoBatchedRuns.slice(this.pendingAutoBatchedRunLimit),this.triggerAutoBatchSend(e)}this.pendingAutoBatchedRuns.length>0&&(t?this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchAggregationDelayMs):this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.triggerAutoBatchSend()},this.autoBatchInitialDelayMs))}async batchEndpointIsSupported(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms)});return!!e.ok||(await e.text(),!1)}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"create",item:a});return}let n=await c([a]),i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(n[0]),signal:AbortSignal.timeout(this.timeout_ms)});await d(i,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[],a=t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[];if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}let n={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!n.post.length&&!n.patch.length)return;if(r=await c(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let e of(this.autoBatchTracing=!1,n.post))await this.createRun(e);for(let e of n.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}let i={...this.headers,"Content-Type":"application/json",Accept:"application/json"},s=await this.caller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:i,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms)});await d(s,"batch create run")}async updateRun(e,t){m(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){this.appendRunCreateToAutoBatchQueue({action:"update",item:r});return}let a={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});await d(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){m(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,o.getEnvironmentVariable)("LANGCHAIN_PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await p(this.listRuns({id:e.child_run_ids})),r={},a={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns({projectId:e,projectName:t,parentRunId:r,traceId:a,referenceExampleId:n,startTime:i,executionOrder:s,runType:o,error:l,id:c,query:u,filter:h,limit:d}){let p=[];if(e&&(p=Array.isArray(e)?e:[e]),t){let e=Array.isArray(t)?t:[t],r=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));p.push(...r)}let f={session:p.length?p:null,run_type:o,reference_example:n,query:u,filter:h,execution_order:s,parent_run:r?[r]:null,start_time:i?i.toISOString():null,error:l,id:c,limit:d,trace:a};for await(let e of this._getCursorPaginatedList("/runs/query",f))yield*e}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||n.v4()};m(e);let a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),i=await a.json();if(null===i||!("share_token"in i))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){m(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await d(t,"unshare run")}async readRunSharedLink(e){m(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);m(e);let a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),m(e);let r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};m(e);let a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms)}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){m(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await d(t,"unshare dataset")}async readSharedDataset(e){m(e);let t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});return await t.json()}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:n=null,referenceDatasetId:i=null}){let s=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==i&&(l.reference_dataset_id=i);let c=await this.caller.call(fetch,s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw Error(`Failed to create session ${e}: ${c.status} ${c.statusText}`);return u}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:n=null,endTime:i=null}){let s=`${this.apiUrl}/sessions/${e}`,o=n;a&&(o={...o||{},metadata:a});let l={name:t,extra:o,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)}),u=await c.json();if(!c.ok)throw Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return u}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)m(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(fetch,`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,n="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)m(e),n+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&i.append("include_stats",r.toString());let s=await this._get(n,i);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:n,referenceFree:i}={}){let s=new URLSearchParams;if(void 0!==e)for(let t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==r&&s.append("name_contains",r),void 0!==a)s.append("reference_dataset",a);else if(void 0!==n){let e=await this.readDataset({datasetName:n});s.append("reference_dataset",e.id)}for await(let e of(void 0!==i&&s.append("reference_free",i.toString()),this._getPaginated("/sessions",s)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");m(r=void 0===e?(await this.readProject({projectName:t})).id:e);let a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});await d(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:n,dataType:i,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),i&&l.append("data_type",i),s&&l.append("name",s);let c=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok){let e=await c.json();if(e.detail&&e.detail.includes("already exists"))throw Error(`Dataset ${t} already exists`);throw Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:t,dataType:r}={}){let a={name:e,description:t};r&&(a.data_type=r);let n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok){let t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw Error(`Dataset ${e} already exists`);throw Error(`Failed to create dataset ${n.status} ${n.statusText}`)}return await n.json()}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)m(e),a+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let i=await this._get(a,n);if(Array.isArray(i)){if(0===i.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=i[0]}else r=i;return r}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:n}={}){let i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)i.append("id",e);for await(let e of(void 0!==a&&i.append("name",a),void 0!==n&&i.append("name_contains",n),this._getPaginated("/datasets",i)))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0!==a)m(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!n.ok)throw Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:n,exampleId:i}){let s=r;if(void 0===s&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==s&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");void 0===s&&(s=(await this.readDataset({datasetName:a})).id);let o=n||new Date,l={dataset_id:s,inputs:e,outputs:t,created_at:o?.toISOString(),id:i},c=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw Error(`Failed to create example: ${c.status} ${c.statusText}`);return await c.json()}async createExamples(e){let{inputs:t,outputs:r,sourceRunIds:a,exampleIds:n,datasetId:i,datasetName:s}=e,o=i;if(void 0===o&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===o&&(o=(await this.readDataset({datasetName:s})).id);let l=t.map((e,t)=>({dataset_id:o,inputs:e,outputs:r?r[t]:void 0,id:n?n[t]:void 0,source_run_id:a?a[t]:void 0})),c=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms)});if(!c.ok)throw Error(`Failed to create examples: ${c.status} ${c.statusText}`);return await c.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>(0,s.isLangChainMessage)(e)?(0,s.convertLangChainMessageToExample)(e):e),n=(0,s.isLangChainMessage)(t)?(0,s.convertLangChainMessageToExample)(t):t;return this.createExample({input:a},{output:n},r)}async readExample(e){m(e);let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r}={}){let a;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)a=e;else if(void 0!==t)a=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let n=new URLSearchParams({dataset:a});if(void 0!==r)for(let e of r)n.append("id",e);for await(let e of this._getPaginated("/examples",n))yield*e}async deleteExample(e){m(e);let t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){m(e);let r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:n}={loadChildRuns:!1}){let i;if("string"==typeof e)i=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)i=e;else throw Error(`Invalid run type: ${typeof e}`);null!==i.reference_example_id&&void 0!==i.reference_example_id&&(n=await this.readExample(i.reference_example_id));let s=await t.evaluateRun(i,n),o=r??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});let l=s.targetRunId??i.id;return await this.createFeedback(l,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,eager:h=!1}){let p={type:l??"api",metadata:o??{}};void 0===c||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:c}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&m(p.metadata.__run.run_id);let f={id:u??n.v4(),run_id:e,key:t,score:r,value:a,correction:i,comment:s,feedback_source:p},g=`${this.apiUrl}/feedback`+(h?"/eager":""),b=await this.caller.call(fetch,g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms)});return await d(b,"create feedback"),f}async updateFeedback(e,{score:t,value:r,correction:a,comment:n}){let i={};null!=t&&(i.score=t),null!=r&&(i.value=r),null!=a&&(i.correction=a),null!=n&&(i.comment=n),m(e);let s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms)});await d(s,"update feedback")}async readFeedback(e){m(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){m(e);let t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms)});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}}},{uuid:"l36KR","./utils/async_caller.js":"bLfDs","./utils/messages.js":"lQU31","./utils/env.js":"6TaU5","./index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bLfDs:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>u);var n=e("p-retry"),i=a.interopDefault(n),s=e("p-queue"),o=a.interopDefault(s);let l=[400,401,403,404,405,406,407,408],c=[409];class u{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,i.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status;if(t){if(l.includes(+t))throw e;if(c.includes(+t))return}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hDMvm:[function(e,t,r){let a=e("67f41b35420203c"),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},o=e=>n.includes(e),l=(e,t)=>new Promise((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=a.operation(t);l.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){n(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof i)l.stop(),n(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),n(e);else{s(e,a,t);try{await t.onFailedAttempt(e)}catch(e){n(e);return}l.retry(e)||n(l.mainError())}}})});t.exports=l,t.exports.default=l,t.exports.AbortError=i},{"67f41b35420203c":"6LrBF"}],"6LrBF":[function(e,t,r){t.exports=e("4f22b206be44b97e")},{"4f22b206be44b97e":"bgrBC"}],bgrBC:[function(e,t,r){var a=e("a628df618ac3d4");r.operation=function(e){return new a(r.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},r.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort(function(e,t){return e-t}),a},r.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},r.wrap=function(e,t,a){if(t instanceof Array&&(a=t,t=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=(function(a){var n=r.operation(t),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))}),n.attempt(function(){a.apply(e,i)})}).bind(e,o),e[s].options=t}}},{a628df618ac3d4:"6sDq5"}],"6sDq5":[function(e,t,r){function a(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=a,a.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},a.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},a.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},a.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},a.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},a.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},a.prototype.start=a.prototype.try,a.prototype.errors=function(){return this._errors},a.prototype.attempts=function(){return this._attempts},a.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},{}],kO9Cj:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("a178093eea54aebd"),n=e("d219d890bb7e8882"),i=e("4a792a8cd58e20a7"),s=()=>{},o=new n.TimeoutError;r.default=class extends a{constructor(e){var t,r,a,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let i=async()=>{this._pendingCount++,this._intervalCount++;try{let i=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await i)}catch(e){a(e)}this._next()};this._queue.enqueue(i,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},{a178093eea54aebd:"18IC9",d219d890bb7e8882:"1SPZv","4a792a8cd58e20a7":"6J1Cc"}],"18IC9":[function(e,t,r){var a=Object.prototype.hasOwnProperty,n="~";function i(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,r,a,i){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new s(r,a||e,i),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function c(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1)),c.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)a.call(e,t)&&r.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,i=r.length,s=Array(i);a<i;a++)s[a]=r[a].fn;return s},c.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},c.prototype.emit=function(e,t,r,a,i,s){var o=n?n+e:e;if(!this._events[o])return!1;var l,c,u=this._events[o],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,i),!0;case 6:return u.fn.call(u.context,t,r,a,i,s),!0}for(c=1,l=Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,a);break;default:if(!l)for(d=1,l=Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},c.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},c.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},c.prototype.removeListener=function(e,t,r,a){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return l(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||a&&!s.once||r&&s.context!==r||l(this,i);else{for(var o=0,c=[],u=s.length;o<u;o++)(s[o].fn!==t||a&&!s[o].once||r&&s[o].context!==r)&&c.push(s[o]);c.length?this._events[i]=1===c.length?c[0]:c:l(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&l(this,t)):(this._events=new i,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c},{}],"1SPZv":[function(e,t,r){let a=e("ed36938359c1cb6b");class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}let i=(e,t,r)=>new Promise((i,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){i(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{i(r())}catch(e){s(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new n(a);"function"==typeof e.cancel&&e.cancel(),s(o)},t);a(e.then(i,s),()=>{clearTimeout(o)})});t.exports=i,t.exports.default=i,t.exports.TimeoutError=n},{ed36938359c1cb6b:"bvvkH"}],bvvkH:[function(e,t,r){t.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},{}],"6J1Cc":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});let a=e("9ebe1cec8dfae466");r.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let n=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},{"9ebe1cec8dfae466":"2Nr9E"}],"2Nr9E":[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t,r){let a=0,n=e.length;for(;n>0;){let i=n/2|0,s=a+i;0>=r(e[s],t)?(a=++s,n-=i+1):n=i}return a}},{}],lQU31:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){return"function"==typeof e?._getType}function i(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}a.defineInteropFlag(r),a.export(r,"isLangChainMessage",()=>n),a.export(r,"convertLangChainMessageToExample",()=>i)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6TaU5":[function(e,t,r){let a,n,i;var s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"isBrowser",()=>c),s.export(r,"isWebWorker",()=>u),s.export(r,"isJsDom",()=>h),s.export(r,"isDeno",()=>d),s.export(r,"isNode",()=>p),s.export(r,"getEnv",()=>f),s.export(r,"getRuntimeEnvironment",()=>m),s.export(r,"getLangChainEnvVars",()=>g),s.export(r,"getLangChainEnvVarsMetadata",()=>b),s.export(r,"getEnvironmentVariables",()=>v),s.export(r,"getEnvironmentVariable",()=>y),s.export(r,"setEnvironmentVariable",()=>_),s.export(r,"getShas",()=>w);var o=e("../index.js"),l=e("6a932e963f932781");let c=()=>"undefined"!=typeof window&&void 0!==window.document,u=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,h=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),d=()=>"undefined"!=typeof Deno,p=()=>void 0!==l&&void 0!==l.versions&&void 0!==l.versions.node&&!d(),f=()=>a||(a=c()?"browser":p()?"node":u()?"webworker":h()?"jsdom":d()?"deno":"other");async function m(){if(void 0===n){let e=f(),t=w();n={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:o.__version__,...t}}return n}function g(){let e=v()||{},t={};for(let[r,a]of Object.entries(e))r.startsWith("LANGCHAIN_")&&"string"==typeof a&&(t[r]=a);for(let e in t)if((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&"string"==typeof t[e]){let r=t[e];t[e]=r.slice(0,2)+"*".repeat(r.length-4)+r.slice(-2)}return t}function b(){let e=v()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[a,n]of Object.entries(e))!a.startsWith("LANGCHAIN_")||"string"!=typeof n||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=n:t[a]=n);return t}function v(){try{if(void 0!==l&&l.env)return Object.entries(l.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}function y(e){try{return void 0!==l?l.env?.[e]:void 0}catch(e){return}}function _(e,t){}function w(){if(void 0!==i)return i;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=y(t);void 0!==r&&(e[t]=r)}return i=e,e}},{"6a932e963f932781":"7XEqq","../index.js":"cCB7g","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9zMS3":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"convertToDottedOrderFormat",()=>l),a.export(r,"RunTree",()=>c);var n=e("uuid"),i=e("./utils/env.js"),s=e("./client.js");let o={};function l(e,t){return`${new Date(e).toISOString().slice(0,-1)}000Z`.replace(/[-:.]/g,"")+t}class c{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,{...c.getDefaultConfig(),...e}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id:this.trace_id=this.id),!this.dotted_order){let e=l(this.start_time,this.id);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}static getDefaultConfig(){return{id:n.v4(),run_type:"chain",project_name:(0,i.getEnvironmentVariable)("LANGCHAIN_PROJECT")??(0,i.getEnvironmentVariable)("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:(0,i.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,i.getEnvironmentVariable)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{},client:new s.Client({})}}async createChild(e){let t=new c({...e,parent_run:this,project_name:this.project_name,client:this.client});return this.child_runs.push(t),t}async end(e,t,r=Date.now()){this.outputs=e,this.error=t,this.end_time=r}async _convertToCreate(e,t=!0){let r,a;let n=e.extra??{};for(let[e,t]of(n.runtime||(n.runtime={}),Object.entries(await (0,i.getRuntimeEnvironment)())))n.runtime[e]||(n.runtime[e]=t);return t?(a=e.parent_run?.id,r=[]):(r=await Promise.all(e.child_runs.map(e=>this._convertToCreate(e,t))),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:r,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order}}async postRun(e=!0){let t=await this._convertToCreate(this,!0);if(await this.client.createRun(t),!e){var r;for(let e of(o[r="Posting with excludeChildRuns=false is deprecated and will be removed in a future version."]||(console.warn(r),o[r]=!0),this.child_runs))await e.postRun(!1)}}async patchRun(){let e={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id};await this.client.updateRun(this.id,e)}}},{uuid:"l36KR","./utils/env.js":"6TaU5","./client.js":"2VxwW","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"2Th20":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"isBrowser",()=>s),n.export(r,"isWebWorker",()=>o),n.export(r,"isJsDom",()=>l),n.export(r,"isDeno",()=>c),n.export(r,"isNode",()=>u),n.export(r,"getEnv",()=>h),n.export(r,"getRuntimeEnvironment",()=>d),n.export(r,"getEnvironmentVariable",()=>p);var i=e("d7d668f88b40f2c1");let s=()=>"undefined"!=typeof window&&void 0!==window.document,o=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,l=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),c=()=>"undefined"!=typeof Deno,u=()=>void 0!==i&&void 0!==i.versions&&void 0!==i.versions.node&&!c(),h=()=>s()?"browser":u()?"node":o()?"webworker":l()?"jsdom":c()?"deno":"other";async function d(){return void 0===a&&(a={library:"langchain-js",runtime:h()}),a}function p(e){try{return void 0!==i?i.env?.[e]:void 0}catch(e){return}}},{d7d668f88b40f2c1:"7XEqq","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],Pa0ga:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"LangChainTracerV1",()=>o);var n=e("../messages/index.js"),i=e("../utils/env.js"),s=e("./base.js");class o extends s.BaseTracer{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.getEnvironmentVariable)("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let e=(0,i.getEnvironmentVariable)("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){let t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){let t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){let e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){let t;let r=this.session??await this.loadDefaultSession(),a=e.serialized;if("llm"===e.run_type){let i=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(e=>(0,n.getBufferString)(e));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,prompts:i,response:e.outputs}}else if("chain"===e.run_type){let n=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:n.filter(e=>"llm"===e.type),child_chain_runs:n.filter(e=>"chain"===e.type),child_tool_runs:n.filter(e=>"tool"===e.type)}}else if("tool"===e.run_type){let n=await Promise.all(e.child_runs.map(e=>this.convertV2RunToRun(e)));t={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:a,type:e.run_type,session_id:r.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(a),child_llm_runs:n.filter(e=>"llm"===e.type),child_chain_runs:n.filter(e=>"chain"===e.type),child_tool_runs:n.filter(e=>"tool"===e.type)}}else throw Error(`Unknown run type: ${e.run_type}`);return t}async persistRun(e){let t,r;t="llm"===(r=void 0!==e.run_type?await this.convertV2RunToRun(e):e).type?`${this.endpoint}/llm-runs`:"chain"===r.type?`${this.endpoint}/chain-runs`:`${this.endpoint}/tool-runs`;let a=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});a.ok||console.error(`Failed to persist run: ${a.status} ${a.statusText}`)}async persistSession(e){let t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){let t;let r=await fetch(e,{method:"GET",headers:this.headers});if(!r.ok)return console.error(`Failed to load session: ${r.status} ${r.statusText}`),t={id:1,start_time:Date.now()},this.session=t,t;let a=await r.json();return 0===a.length?t={id:1,start_time:Date.now()}:[t]=a,this.session=t,t}}},{"../messages/index.js":"jMGwo","../utils/env.js":"2Th20","./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"3BeNh":[function(e,t,r){let a;var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"consumeCallback",()=>o),n.export(r,"awaitAllCallbacks",()=>l);var i=e("p-queue"),s=n.interopDefault(i);async function o(e,t){!0===t?await e():(void 0===a&&(a=new("default"in s.default?s.default.default:s.default)({autoStart:!0,concurrency:1})),a.add(e))}function l(){return void 0!==a?a.onIdle():Promise.resolve()}},{"p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],is1pt:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"BaseLangChain",()=>n.BaseLangChain),a.export(r,"BaseLanguageModel",()=>n.BaseLanguageModel),a.export(r,"calculateMaxTokens",()=>i.calculateMaxTokens),a.export(r,"getModelContextSize",()=>i.getModelContextSize);var n=e("@langchain/core/language_models/base"),i=e("./count_tokens.js")},{"@langchain/core/language_models/base":"jTFIS","./count_tokens.js":"edBJe","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jTFIS:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r);var n=e("../dist/language_models/base.js");a.exportAll(n,r)},{"../dist/language_models/base.js":"fQYj8","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],fQYj8:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getModelNameForTiktoken",()=>u),a.export(r,"getEmbeddingContextSize",()=>h),a.export(r,"getModelContextSize",()=>d),a.export(r,"calculateMaxTokens",()=>p),a.export(r,"BaseLangChain",()=>m),a.export(r,"BaseLanguageModel",()=>g);var n=e("../caches.js"),i=e("../prompt_values.js"),s=e("../messages/index.js"),o=e("../utils/async_caller.js"),l=e("../utils/tiktoken.js"),c=e("../runnables/base.js");let u=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,h=e=>"text-embedding-ada-002"===e?8191:2046,d=e=>{switch(u(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}},p=async({prompt:e,modelName:t})=>{let r;try{r=(await (0,l.encodingForModel)(u(t))).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return d(t)-r},f=()=>!1;class m extends c.Runnable{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??f(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class g extends m{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=(0,n.InMemoryCache).global():this.cache=void 0,this.caller=new o.AsyncCaller(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await (0,l.encodingForModel)("modelName"in this?u(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new i.StringPromptValue(e):Array.isArray(e)?new i.ChatPromptValue(e.map(s.coerceMessageLikeToMessage)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){return Object.entries({...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}},{"../caches.js":"etUzK","../prompt_values.js":"lGT4D","../messages/index.js":"jMGwo","../utils/async_caller.js":"l8CrB","../utils/tiktoken.js":"gODKI","../runnables/base.js":"1qQoT","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],l8CrB:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AsyncCaller",()=>u);var n=e("p-retry"),i=a.interopDefault(n),s=e("p-queue"),o=a.interopDefault(s);let l=[400,401,402,403,404,405,406,407,408,409],c=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&l.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class u{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??c;let t="default"in o.default?o.default.default:o.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,i.default)(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},{"p-retry":"hDMvm","p-queue":"kO9Cj","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],gODKI:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getEncoding",()=>l),a.export(r,"encodingForModel",()=>c);var n=e("js-tiktoken/lite"),i=e("./async_caller.js");let s={},o=new i.AsyncCaller({});async function l(e){return e in s||(s[e]=o.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new n.Tiktoken(e)).catch(t=>{throw delete s[e],t})),await s[e]}async function c(e){return l((0,n.getEncodingNameForModel)(e))}},{"js-tiktoken/lite":"hrZLc","./async_caller.js":"l8CrB","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hrZLc:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Tiktoken",()=>n.Tiktoken),a.export(r,"getEncodingNameForModel",()=>n.getEncodingNameForModel);var n=e("./chunk-YVJR5WRT.js")},{"./chunk-YVJR5WRT.js":"4sh0B","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"4sh0B":[function(e,t,r){let a,n;var i,s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"Tiktoken",()=>d),s.export(r,"getEncodingNameForModel",()=>p),s.export(r,"never",()=>u);var o=e("base64-js"),l=s.interopDefault(o),c=Object.defineProperty;function u(e){}var h=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...n]=t.split(" "),i=Number.parseInt(a,10);return n.forEach((t,r)=>e[t]=i+r),e},{})))){let e=(0,l.default).toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),n=h.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=h.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){i.push(r);continue}i.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let n=0;n<r.length-1;n++){let i=e.slice(r[n].start,r[n+1].end),s=t.get(i.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,n])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let c=this.specialTokens[t[0]];i.push(c),l=t.index+t[0].length}return i}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let n=e[a],i=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=i&&(t.push(i),r+=i.length)}let a=new Uint8Array(r),n=0;for(let e of t)a.set(e,n),n+=e.length;return this.textDecoder.decode(a)}},d=h;function p(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw Error("Unknown model")}}a="symbol"!=typeof(i="specialTokenRegex")?i+"":i,n=e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"),a in d?c(d,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[a]=n},{"base64-js":"jri1H","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jri1H:[function(e,t,r){r.byteLength=function(e){var t=c(e),r=t[0],a=t[1];return(r+a)*3/4-a},r.toByteArray=function(e){var t,r,a=c(e),s=a[0],o=a[1],l=new i((s+o)*3/4-o),u=0,h=o>0?s-4:s;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],s=0,o=r-n;s<o;s+=16383)i.push(function(e,t,r){for(var n,i=[],s=t;s<r;s+=3)i.push(a[(n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+a[n>>12&63]+a[n>>6&63]+a[63&n]);return i.join("")}(e,s,s+16383>o?o:s+16383));return 1===n?i.push(a[(t=e[r-1])>>2]+a[t<<4&63]+"=="):2===n&&i.push(a[(t=(e[r-2]<<8)+e[r-1])>>10]+a[t>>4&63]+a[t<<2&63]+"="),i.join("")};for(var a=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=s.length;o<l;++o)a[o]=s[o],n[s.charCodeAt(o)]=o;function c(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var a=r===t?0:4-r%4;return[r,a]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},{}],"1qQoT":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Runnable",()=>f),a.export(r,"RunnableBinding",()=>m),a.export(r,"RunnableEach",()=>g),a.export(r,"RunnableRetry",()=>b),a.export(r,"RunnableSequence",()=>v),a.export(r,"RunnableMap",()=>y),a.export(r,"RunnableLambda",()=>_),a.export(r,"RunnableParallel",()=>w),a.export(r,"RunnableWithFallbacks",()=>j),a.export(r,"_coerceToRunnable",()=>x);var n=e("p-retry"),i=a.interopDefault(n),s=e("../callbacks/manager.js"),o=e("../tracers/log_stream.js"),l=e("../load/serializable.js"),c=e("../utils/stream.js"),u=e("./config.js"),h=e("../utils/async_caller.js"),d=e("../tracers/root_listener.js");function p(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}class f extends l.Serializable{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}bind(e){return new m({bound:this,kwargs:e,config:{}})}map(){return new g({bound:this})}withRetry(e){return new b({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new m({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new j({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)){if(e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);return e}return Array.from({length:t},()=>e)}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),n=new h.AsyncCaller({maxConcurrency:r?.maxConcurrency,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){return(0,c.IterableReadableStream).fromAsyncGenerator(this._streamIterator(e,t))}_separateRunnableConfigFromCallOptions(e={}){let t={callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName},r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,[t,r]}async _callWithConfig(e,t,r){let a;let n=await (0,u.getCallbackMangerForConfig)(r),i=await n?.handleChainStart(this.toJSON(),p(t,"input"),void 0,r?.runType,void 0,void 0,r?.runName);try{a=await e.bind(this)(t,r,i)}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(p(a,"output")),a}async _batchWithConfig(e,t,r,a){let n;let i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(u.getCallbackMangerForConfig)),o=await Promise.all(s.map((e,r)=>e?.handleChainStart(this.toJSON(),p(t[r],"input"),void 0,i[r].runType,void 0,void 0,i[r].runName)));try{n=await e(t,i,o,a)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(p(n,"output")))),n}async *_transformStreamWithConfig(e,t,r){let a,n,i;let s=!0,o=!0,l=await (0,u.getCallbackMangerForConfig)(r),c=this.toJSON(),h=async function*(){for await(let t of e){if(i||(i=await l?.handleChainStart(c,{input:""},void 0,r?.runType,void 0,void 0,r?.runName)),s){if(void 0===a)a=t;else try{a=a.concat(t)}catch{a=void 0,s=!1}}yield t}}();try{for await(let e of t(h,i,r))if(yield e,o){if(void 0===n)n=e;else try{n=n.concat(e)}catch{n=void 0,o=!1}}}catch(e){throw await i?.handleChainError(e,void 0,void 0,void 0,{inputs:p(a,"input")}),e}await i?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:p(a,"input")})}_patchConfig(e={},t){let r={...e};return void 0!==t?(delete r.runName,{...r,callbacks:t}):r}pipe(e){return new v({first:this,last:x(e)})}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:r.concat(t);yield*this._streamIterator(r,t)}async *streamLog(e,t,r){let a=new o.LogStreamCallbackHandler({...r,autoClose:!1}),n=t??{},{callbacks:i}=n;if(void 0===i)n.callbacks=[a];else if(Array.isArray(i))n.callbacks=i.concat([a]);else{let e=i.copy();e.inheritableHandlers.push(a),n.callbacks=e}let s=await this.stream(e,n),l=async function(){try{for await(let e of s){let t=new o.RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await a.writer.write(t)}}finally{await a.writer.close()}}();try{for await(let e of a)yield e}finally{await l}}static isRunnable(e){return!!e&&e.lc_runnable}withListeners({onStart:e,onEnd:t,onError:r}){return new m({bound:this,config:{},configFactories:[a=>({callbacks:[new d.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class m extends f{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}async _mergeConfig(e){let t=(0,u.mergeConfigs)(this.config,e);return(0,u.mergeConfigs)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig({...t,...this.kwargs}))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig({...e,...this.kwargs}))):await this._mergeConfig({...t,...this.kwargs});return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig({...t,...this.kwargs}))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig({...t,...this.kwargs}))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig({...t,...this.kwargs}))}static isRunnableBinding(e){return e.bound&&f.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new m({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new d.RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class g extends f{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new g({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,this._patchConfig(t,r?.getChild()))}withListeners({onStart:e,onEnd:t,onError:r}){return new g({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class b extends m{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return this._patchConfig(t,r?.getChild(a))}async _invoke(e,t,r){return(0,i.default)(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let n={};try{await (0,i.default)(async i=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),c=o.map(e=>this._patchConfigForRetry(i,t?.[e],r?.[e])),u=await super.batch(l,c,{...a,returnExceptions:!0});for(let e=0;e<u.length;e+=1){let t=u[e],r=o[e];t instanceof Error&&void 0===s&&(s=t),n[r.toString()]=t}if(s)throw s;return u},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class v extends f{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=await (0,u.getCallbackMangerForConfig)(t),n=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName),i=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let a=e[r];i=await a.invoke(i,this._patchConfig(t,n?.getChild(`seq:step:${r+1}`)))}r=await this.last.invoke(i,this._patchConfig(t,n?.getChild(`seq:step:${this.steps.length}`)))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(p(r,"output")),r}async batch(e,t,r){let a;let n=this._getOptionsList(t??{},e.length),i=await Promise.all(n.map(u.getCallbackMangerForConfig)),s=await Promise.all(i.map((t,r)=>t?.handleChainStart(this.toJSON(),p(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName))),o=e;try{let e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){let a=e[t];o=await a.batch(o,s.map((e,r)=>this._patchConfig(n[r],e?.getChild(`seq:step:${t+1}`))),r)}a=await this.last.batch(o,s.map(e=>this._patchConfig(n[this.steps.length-1],e?.getChild(`seq:step:${this.steps.length}`))),r)}catch(e){throw await Promise.all(s.map(t=>t?.handleChainError(e))),e}return await Promise.all(s.map((e,t)=>e?.handleChainEnd(p(a[t],"output")))),a}async *_streamIterator(e,t){let r;let a=await (0,u.getCallbackMangerForConfig)(t),n=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName),i=[this.first,...this.middle,this.last],s=!0;async function*o(){yield e}try{let e=i[0].transform(o(),this._patchConfig(t,n?.getChild("seq:step:1")));for(let r=1;r<i.length;r+=1){let a=i[r];e=await a.transform(e,this._patchConfig(t,n?.getChild(`seq:step:${r+1}`)))}for await(let t of e)if(yield t,s){if(void 0===r)r=t;else try{r=r.concat(t)}catch(e){r=void 0,s=!1}}}catch(e){throw await n?.handleChainError(e),e}await n?.handleChainEnd(p(r,"output"))}pipe(e){return new v(v.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last}:{first:this.first,middle:[...this.middle,this.last],last:x(e)})}static isRunnableSequence(e){return Array.isArray(e.middle)&&f.isRunnable(e)}static from([e,...t]){return new v({first:x(e),middle:t.slice(0,-1).map(x),last:x(t[t.length-1])})}}class y extends f{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=x(r)}static from(e){return new y({steps:e})}async invoke(e,t){let r=await (0,u.getCallbackMangerForConfig)(t),a=await r?.handleChainStart(this.toJSON(),{input:e},void 0,void 0,void 0,void 0,t?.runName),n={};try{await Promise.all(Object.entries(this.steps).map(async([r,i])=>{n[r]=await i.invoke(e,this._patchConfig(t,a?.getChild(r)))}))}catch(e){throw await a?.handleChainError(e),e}return await a?.handleChainEnd(n),n}}class _ extends f{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new _({func:e})}async _invoke(e,t,r){let a=await this.func(e,{config:t});return a&&f.isRunnable(a)&&(a=await a.invoke(e,this._patchConfig(t,r?.getChild()))),a}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}}class w extends y{}class j extends f{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let a=await (0,s.CallbackManager).configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),n=await a?.handleChainStart(this.toJSON(),p(e,"input"),void 0,void 0,void 0,void 0,t?.runName);for(let a of this.runnables())try{let r=await a.invoke(e,this._patchConfig(t,n?.getChild()));return await n?.handleChainEnd(p(r,"output")),r}catch(e){void 0===r&&(r=e)}if(void 0===r)throw Error("No error stored at end of fallback.");throw await n?.handleChainError(r),r}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),i=await Promise.all(n.map(e=>(0,s.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata))),o=await Promise.all(i.map((t,r)=>t?.handleChainStart(this.toJSON(),p(e[r],"input"),void 0,void 0,void 0,void 0,n[r].runName)));for(let t of this.runnables())try{let a=await t.batch(e,o.map((e,t)=>this._patchConfig(n[t],e?.getChild())),r);return await Promise.all(o.map((e,t)=>e?.handleChainEnd(p(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(o.map(e=>e?.handleChainError(a))),a}}function x(e){if("function"==typeof e)return new _({func:e});if(f.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=x(a);return new y({steps:t})}}},{"p-retry":"hDMvm","../callbacks/manager.js":"fZx9W","../tracers/log_stream.js":"jD00e","../load/serializable.js":"ihLrn","../utils/stream.js":"faNJA","./config.js":"bd9nP","../utils/async_caller.js":"l8CrB","../tracers/root_listener.js":"i5MBm","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],jD00e:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RunLogPatch",()=>o),a.export(r,"RunLog",()=>l),a.export(r,"LogStreamCallbackHandler",()=>c);var n=e("../utils/fast-json-patch/index.js"),i=e("./base.js"),s=e("../utils/stream.js");class o{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops}concat(e){let t=this.ops.concat(e.ops),r=(0,n.applyPatch)({},t);return new l({ops:t,state:r[r.length-1].newDocument})}}class l extends o{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,n.applyPatch)(this.state,e.ops);return new l({ops:t,state:r[r.length-1].newDocument})}}class c extends i.BaseTracer{constructor(e){super(e),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=(0,s.IterableReadableStream).fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(void 0===e.parent_run_id)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async onRunCreate(e){if(void 0===e.parent_run_id&&await this.writer.write(new o({ops:[{op:"replace",path:"",value:{id:e.id,streamed_output:[],final_output:void 0,logs:{}}}]})),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output_str:[],final_output:void 0,end_time:void 0};await this.writer.write(new o({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[{op:"add",path:`/logs/${t}/final_output`,value:e.outputs}];void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new o({ops:r});await this.writer.write(a)}finally{if(void 0===e.parent_run_id){let t=new o({ops:[{op:"replace",path:"/final_output",value:e.outputs}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t){let r=this.keyMapByRunId[e.id];if(void 0===r)return;let a=new o({ops:[{op:"add",path:`/logs/${r}/streamed_output_str/-`,value:t}]});await this.writer.write(a)}}},{"../utils/fast-json-patch/index.js":"hrFKE","./base.js":"gsfZb","../utils/stream.js":"faNJA","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],hrFKE:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>s.PatchError),a.export(r,"deepClone",()=>s._deepClone),a.export(r,"escapePathComponent",()=>s.escapePathComponent),a.export(r,"unescapePathComponent",()=>s.unescapePathComponent);var n=e("./src/core.js");a.exportAll(n,r);var i=e("./src/duplex.js");a.exportAll(i,r);var s=e("./src/helpers.js");r.default={...n,JsonPatchError:s.PatchError,deepClone:s._deepClone,escapePathComponent:s.escapePathComponent,unescapePathComponent:s.unescapePathComponent}},{"./src/core.js":"27Wvc","./src/duplex.js":"9JAeY","./src/helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"27Wvc":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"JsonPatchError",()=>i),a.export(r,"deepClone",()=>s),a.export(r,"getValueByPointer",()=>c),a.export(r,"applyOperation",()=>u),a.export(r,"applyPatch",()=>h),a.export(r,"applyReducer",()=>d),a.export(r,"validator",()=>p),a.export(r,"validate",()=>f),a.export(r,"_areEquals",()=>m);var n=e("./helpers.js");let i=n.PatchError,s=n._deepClone,o={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=c(r,this.path);a&&(a=(0,n._deepClone)(a));let i=u(r,{op:"remove",path:this.from}).removed;return u(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=c(r,this.from);return u(r,{op:"add",path:this.path,value:(0,n._deepClone)(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:m(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var l={add:function(e,t,r){return(0,n.isInteger)(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:o.move,copy:o.copy,test:o.test,_get:o._get};function c(e,t){if(""==t)return e;var r={op:"_get",path:t};return u(e,r),r.value}function u(e,t,r=!1,a=!0,s=!0,u=0){if(r&&("function"==typeof r?r(t,0,e,t.path):p(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=c(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=m(e,t.value),!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new i("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",u,t,e)}}{let c,h,d;a||(e=(0,n._deepClone)(e));let f=(t.path||"").split("/"),m=e,g=1,b=f.length;for(h="function"==typeof r?r:p;;){if((c=f[g])&&-1!=c.indexOf("~")&&(c=(0,n.unescapePathComponent)(c)),s&&("__proto__"==c||"prototype"==c&&g>0&&"constructor"==f[g-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===d&&(void 0===m[c]?d=f.slice(0,g).join("/"):g==b-1&&(d=t.path),void 0!==d&&h(t,0,e,d)),g++,Array.isArray(m)){if("-"===c)c=m.length;else{if(r&&!(0,n.isInteger)(c))throw new i("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",u,t,e);(0,n.isInteger)(c)&&(c=~~c)}if(g>=b){if(r&&"add"===t.op&&c>m.length)throw new i("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",u,t,e);let a=l[t.op].call(t,m,c,e);if(!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return a}}else if(g>=b){let r=o[t.op].call(t,m,c,e);if(!1===r.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",u,t,e);return r}if(m=m[c],r&&g<b&&(!m||"object"!=typeof m))throw new i("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",u,t,e)}}}function h(e,t,r,a=!0,s=!0){if(r&&!Array.isArray(t))throw new i("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=(0,n._deepClone)(e));let o=Array(t.length);for(let a=0,n=t.length;a<n;a++)o[a]=u(e,t[a],r,!0,s,a),e=o[a].newDocument;return o.newDocument=e,o}function d(e,t,r){let a=u(e,t);if(!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function p(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new i("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(o[e.op]){if("string"!=typeof e.path)throw new i("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new i('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new i("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new i("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&(0,n.hasUndefined)(e.value))throw new i("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var s=e.path.split("/").length,l=a.split("/").length;if(s!==l+1&&s!==l)throw new i("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new i("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var c=f([{op:"_get",path:e.from,value:void 0}],r);if(c&&"OPERATION_PATH_UNRESOLVABLE"===c.name)throw new i("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new i("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function f(e,t,r){try{if(!Array.isArray(e))throw new i("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)h((0,n._deepClone)(t),(0,n._deepClone)(e),r||!0);else{r=r||p;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof i)return e;throw e}}function m(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,n,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!m(e[r],t[r]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!m(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}},{"./helpers.js":"6VGjv","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"6VGjv":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"hasOwnProperty",()=>i),a.export(r,"_objectKeys",()=>s),a.export(r,"_deepClone",()=>o),a.export(r,"isInteger",()=>l),a.export(r,"escapePathComponent",()=>c),a.export(r,"unescapePathComponent",()=>u),a.export(r,"_getPathRecursive",()=>h),a.export(r,"getPath",()=>d),a.export(r,"hasUndefined",()=>function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=s(t),n=a.length;for(var r=0;r<n;r++)if(e(t[a[r]]))return!0}}return!1}),a.export(r,"PatchError",()=>f);let n=Object.prototype.hasOwnProperty;function i(e,t){return n.call(e,t)}function s(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)i(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function c(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function u(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function h(e,t){let r;for(let a in e)if(i(e,a)){if(e[a]===t)return c(a)+"/";if("object"==typeof e[a]&&""!=(r=h(e[a],t)))return c(a)+"/"+r}return""}function d(e,t){if(e===t)return"/";let r=h(e,t);if(""===r)throw Error("Object not found in root");return`/${r}`}function p(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class f extends Error{constructor(e,t,r,a,n){super(p(e,{name:t,index:r,operation:a,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=p(e,{name:t,index:r,operation:a,tree:n})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],"9JAeY":[function(e,t,r){/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"unobserve",()=>c),a.export(r,"observe",()=>u),a.export(r,"generate",()=>h),a.export(r,"compare",()=>p);var n=e("./helpers.js"),i=e("./core.js"),s=new WeakMap;class o{constructor(e){Object.defineProperty(this,"obj",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.obj=e}}class l{constructor(e,t){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=e,this.observer=t}}function c(e,t){t.unobserve()}function u(e,t){var r,a=s.get(e);if(a){let e=a.observers.get(t);r=e&&e.observer}else a=new o(e),s.set(e,a);if(r)return r;if(r={},a.value=(0,n._deepClone)(e),t){r.callback=t,r.next=null;var i=()=>{h(r)},c=()=>{clearTimeout(r.next),r.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener("mouseup",c),window.addEventListener("keyup",c),window.addEventListener("mousedown",c),window.addEventListener("keydown",c),window.addEventListener("change",c))}return r.patches=[],r.object=e,r.unobserve=()=>{h(r),clearTimeout(r.next),function(e,t){e.observers.delete(t.callback)}(a,r),"undefined"!=typeof window&&(window.removeEventListener("mouseup",c),window.removeEventListener("keyup",c),window.removeEventListener("mousedown",c),window.removeEventListener("keydown",c),window.removeEventListener("change",c))},a.observers.set(t,new l(t,r)),r}function h(e,t=!1){var r=s.get(e.object);d(r.value,e.object,e.patches,"",t),e.patches.length&&(0,i.applyPatch)(r.value,e.patches);var a=e.patches;return a.length>0&&(e.patches=[],e.callback&&e.callback(a)),a}function d(e,t,r,a,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var s=(0,n._objectKeys)(t),o=(0,n._objectKeys)(e),l=!1,c=o.length-1;c>=0;c--){var u=o[c],h=e[u];if((0,n.hasOwnProperty)(t,u)&&!(void 0===t[u]&&void 0!==h&&!1===Array.isArray(t))){var p=t[u];"object"==typeof h&&null!=h&&"object"==typeof p&&null!=p&&Array.isArray(h)===Array.isArray(p)?d(h,p,r,a+"/"+(0,n.escapePathComponent)(u),i):h!==p&&(i&&r.push({op:"test",path:a+"/"+(0,n.escapePathComponent)(u),value:(0,n._deepClone)(h)}),r.push({op:"replace",path:a+"/"+(0,n.escapePathComponent)(u),value:(0,n._deepClone)(p)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:a+"/"+(0,n.escapePathComponent)(u),value:(0,n._deepClone)(h)}),r.push({op:"remove",path:a+"/"+(0,n.escapePathComponent)(u)}),l=!0):(i&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}))}if(l||s.length!=o.length)for(var c=0;c<s.length;c++){var u=s[c];(0,n.hasOwnProperty)(e,u)||void 0===t[u]||r.push({op:"add",path:a+"/"+(0,n.escapePathComponent)(u),value:(0,n._deepClone)(t[u])})}}}function p(e,t,r=!1){var a=[];return d(e,t,a,"",r),a}},{"./helpers.js":"6VGjv","./core.js":"27Wvc","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],faNJA:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"IterableReadableStream",()=>n);class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done&&this.reader.releaseLock(),{done:e.done,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new n({start:e=>(function r(){return t.read().then(({done:t,value:a})=>{if(t){e.close();return}return e.enqueue(a),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)}})}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],bd9nP:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getCallbackMangerForConfig",()=>i),a.export(r,"mergeConfigs",()=>s);var n=e("../callbacks/manager.js");async function i(e){return(0,n.CallbackManager).configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function s(e,t){let r={...e};if(t)for(let a of Object.keys(t))if("metadata"===a)r[a]={...r[a],...t[a]};else if("tags"===a)r[a]=(r[a]??[]).concat(t[a]??[]);else if("callbacks"===a){let a=r.callbacks,i=t.callbacks??e.callbacks;if(Array.isArray(i)){if(a){if(Array.isArray(a))r.callbacks=a.concat(i);else{let e=a.copy();for(let t of i)e.addHandler(t,!0);r.callbacks=e}}else r.callbacks=i}else if(i){if(a){if(Array.isArray(a)){let e=i.copy();for(let t of a)e.addHandler(t,!0);r.callbacks=e}else r.callbacks=new n.CallbackManager(i.parentRunId,{handlers:a.handlers.concat(i.handlers),inheritableHandlers:a.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(i.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(i.inheritableTags))),metadata:{...a.metadata,...i.metadata}})}else r.callbacks=i}}else r[a]=t[a]??r[a];return r}},{"../callbacks/manager.js":"fZx9W","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],i5MBm:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RootListenersTracer",()=>i);var n=e("./base.js");class i extends n.BaseTracer{constructor({config:e,onStart:t,onEnd:r,onError:a}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}}},{"./base.js":"gsfZb","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],edBJe:[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"calculateMaxTokens",()=>n.calculateMaxTokens),a.export(r,"getModelContextSize",()=>n.getModelContextSize),a.export(r,"getEmbeddingContextSize",()=>n.getEmbeddingContextSize);var n=e("@langchain/core/language_models/base")},{"@langchain/core/language_models/base":"jTFIS","@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}],adwnu:[function(e,t,r){t.exports=e("6969a9d7e11ebae1")(e("562514661d94ec8").getBundleURL("dQ0EI")+e("3da62dd727540faf").resolve("2qOg2")).then(()=>t.bundle.root("h9Hbj"))},{"6969a9d7e11ebae1":"jawFo","562514661d94ec8":"e3Ctf","3da62dd727540faf":"fcUCD"}],jawFo:[function(e,t,r){var a=e("e18e0f4b8102d3ab");t.exports=a(function(e){return new Promise(function(t,r){try{importScripts(e),t()}catch(e){r(e)}})})},{e18e0f4b8102d3ab:"4mYIR"}],"4mYIR":[function(e,t,r){var a={},n={},i={};t.exports=function(e,t){return function(r){var s=function(e){switch(e){case"preload":return n;case"prefetch":return i;default:return a}}(t);return s[r]?s[r]:s[r]=e.apply(null,arguments).catch(function(e){throw delete s[r],e})}}},{}],e3Ctf:[function(e,t,r){var a={};function n(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}r.getBundleURL=function(e){var t=a[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return n(e[2])}return"/"}(),a[e]=t),t},r.getBaseURL=n,r.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}},{}],fcUCD:[function(e,t,r){var a={};t.exports.register=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},t.exports.resolve=function(e){var t=a[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}},{}],d31f3:[function(e,t,r){t.exports=e("1a48df7881a9fb27")(e("c0e507394f1a3783").getBundleURL("dQ0EI")+e("712fe4059b0a28b1").resolve("dQ0EI")).then(()=>t.bundle.root("c5l0I"))},{"1a48df7881a9fb27":"jawFo",c0e507394f1a3783:"e3Ctf","712fe4059b0a28b1":"fcUCD"}],c1KK9:[function(e,t,r){t.exports=e("32d8914ffe2c81cb")(e("ef9aa5f85edffd41").getBundleURL("dQ0EI")+e("455a8bbd4ef62284").resolve("2AzJW")).then(()=>t.bundle.root("d6V6d"))},{"32d8914ffe2c81cb":"jawFo",ef9aa5f85edffd41:"e3Ctf","455a8bbd4ef62284":"fcUCD"}],gm0US:[function(e,t,r){t.exports=e("66ce9760c3134965")(e("135815d1997ed7ce").getBundleURL("dQ0EI")+e("38e55013343011ea").resolve("gLhAl")).then(()=>t.bundle.root("aELaP"))},{"66ce9760c3134965":"jawFo","135815d1997ed7ce":"e3Ctf","38e55013343011ea":"fcUCD"}],fl8bW:[function(e,t,r){t.exports=e("df724c6ebba00c93")(e("6701f191e3bd5cbc").getBundleURL("dQ0EI")+e("72da9dc529c6e1").resolve("1KVcI")).then(()=>t.bundle.root("je5T8"))},{df724c6ebba00c93:"jawFo","6701f191e3bd5cbc":"e3Ctf","72da9dc529c6e1":"fcUCD"}],"3XeUY":[function(e,t,r){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e,t){let r=new Set;for(let a of t)e.has(a)&&r.add(a);return r}function i(e,t){let r=new Set(e);for(let e of t)r.add(e);return r}function s(e,t){let r=new Set(e);for(let e of t)r.delete(e);return r}a.defineInteropFlag(r),a.export(r,"intersection",()=>n),a.export(r,"union",()=>i),a.export(r,"difference",()=>s)},{"@parcel/transformer-js/src/esmodule-helpers.js":"2SNmR"}]},["c5l0I"],"c5l0I","parcelRequire3d47"),globalThis.define=t;