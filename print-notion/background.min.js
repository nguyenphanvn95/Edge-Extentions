"use strict";function Config(){this.AppType="PRNO",this.URLMain="https://www.printnotion.com/",this.URLNotionOauth="https://api.printnotion.com/notion/oauth",this.URLNotionConnection="https://api.notion.com/v1/oauth/authorize?owner=user&client_id=127d872b-594c-8040-a33f-0037372c486b&redirect_uri=https%3A%2F%2Fwww.printnotion.com%2Fnotion%2Fredirect.html&response_type=code",this.URLUseCase="https://www.printnotion.com/use-case.html"}var config=new Config;new function(){this.log=function(message){},this.log=function(level,message){},this.log=function(level,feature,message){}};var localStorageHelper=new function(){this.set=function(key,value){return new Promise(((resolve,reject)=>{chrome.storage.sync.set({[key]:value},(function(res){resolve({[key]:value})}))}))},this.get=function(key){return new Promise(((resolve,reject)=>{chrome.storage.sync.get({[key]:null},(function(res){resolve(res)}))}))},this.remove=function(key){return new Promise(((resolve,reject)=>{chrome.storage.sync.remove(key,(function(res){resolve({[key]:null})}))}))},this.clear=function(){return new Promise(((resolve,reject)=>{chrome.storage.sync.clear((function(res){resolve(1)}))}))},this.set=function(key,value,path){return new Promise(((resolve,reject)=>{"LOCAL"===path?chrome.storage.local.set({[key]:value},(function(res){resolve({[key]:value})})):chrome.storage.sync.set({[key]:value},(function(res){resolve({[key]:value})}))}))},this.get=function(key,path){return new Promise(((resolve,reject)=>{"LOCAL"===path?chrome.storage.local.get({[key]:null},(function(res){resolve(res)})):chrome.storage.sync.get({[key]:null},(function(res){resolve(res)}))}))},this.remove=function(key,path){return new Promise(((resolve,reject)=>{"LOCAL"===path?chrome.storage.local.remove(key,(function(res){resolve({[key]:null})})):chrome.storage.sync.remove(key,(function(res){resolve({[key]:null])}))}))},this.clear=async function(path){return new Promise(((resolve,reject)=>{"LOCAL"===path?chrome.storage.local.clear((function(res){resolve({})})):chrome.storage.sync.clear((function(res){resolve({})}))}))}};config=new Config;chrome.runtime.onStartup.addListener((async function(){}));chrome.runtime.onInstalled.addListener((async function(details){const{reason:reason,previousVersion:previousVersion}=details;}));chrome.runtime.onMessage.addListener((function(request,sender,sendResponse){return sender.tab&&sender.tab.url,request.greeting,"getSpaces"===request.message?(new Promise(((resolve,reject)=>{fetch("https://www.notion.so/api/v3/getSpaces",{method:"POST",headers:{pragma:"no-cache","cache-control":"no-cache"}}).then((response=>response.json())).then((data=>{resolve(data)})).catch((error=>{resolve("")}))})).then((function(response){sendResponse({farewell:"OK"})})),!0):"getDatabasesFromPublicAPI"===request.message&&(async function(request,sendResponse){try{let collectionViewData=request.data?.collectionViewData,databaseId=collectionViewData?.value?.parent_id,userId=request.data?.user_id,workspace_id=collectionViewData?.value?.space_id;var response=await function(databaseId,userId,workspace_id){return new Promise((async(resolve,reject)=>{let notionTokensResult=await localStorageHelper.get("notionTokens"),notionTokens=notionTokensResult?.notionTokens?notionTokensResult?.notionTokens:{},notionToken=notionTokens?notionTokens[`${userId}|${workspace_id}`]:{},access_token=notionToken?.access_token||"";if(""==access_token)return void resolve("access_token not found");let newDatabaseId=databaseId.replace(/-/g,"");fetch(`https://api.notion.com/v1/databases/${newDatabaseId}/query`,{method:"POST",headers:{Authorization:`Bearer ${access_token}`,"Notion-Version":"2022-06-28","Content-Type":"application/json"},body:"{}"}).then((response=>response.json())).then((data=>{resolve(data)})).catch((error=>{resolve("")}))}))}(databaseId,userId,workspace_id);sendResponse({code:0,msg:"success",result:response})}catch(error){sendResponse({code:-1,msg:error.toString()})}}(request,sendResponse),!0)}));
