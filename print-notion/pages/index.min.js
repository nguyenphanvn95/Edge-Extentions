!function(){"use strict";function e(){this.AppType="PRNO",this.URLGetExtensionIdAsync="https://api.printnotion.com/extension/getExtensionId",this.URLMain="https://www.printnotion.com/",this.URLgetInfo="https://api.printnotion.com/extension/getInfo",this.URLgetNewVersion="https://www.printnotion.com/extension/NewVersion.html",this.URLgetNews="https://www.printnotion.com/extension/PopupNotes.html",this.UninstallURL="https://www.printnotion.com/uninstalled.html",this.URLCountMeIn="https://www.printnotion.com/count-me-in.html",this.URLPayment="https://www.printnotion.com/payment/products.html",this.URLgetBuyInfo="https://api.printnotion.com/extension/getBuyInfo",this.URLrateChrome="https://chromewebstore.google.com/detail/print-notion/ijaopicbldggjdgbnfdlkljeggibmcha/reviews?from=rate",this.URLrateEdge="https://microsoftedge.microsoft.com/addons/detail/dkejjajekpajnhlmkoboicbifhdafpid?from=rate",this.URLDownloadChrome="https://chromewebstore.google.com/detail/print-notion/ijaopicbldggjdgbnfdlkljeggibmcha",this.URLDownloadEdge="https://microsoftedge.microsoft.com/addons/detail/dkejjajekpajnhlmkoboicbifhdafpid",this.URLPaymentActivationLicense="https://www.printnotion.com/payment/activationLicense.html",this.URLNotionOauth="https://api.printnotion.com/notion/oauth",this.URLNotionConnection="https://api.notion.com/v1/oauth/authorize?owner=user&client_id=127d872b-594c-8040-a33f-0037372c486b&redirect_uri=https%3A%2F%2Fwww.printnotion.com%2Fnotion%2Fredirect.html&response_type=code",this.URLUseCase="https://www.printnotion.com/use-case.html"}var t=new e;function n(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")}function o(e,o,i,r,a){return new Promise(((c,s)=>{var l=chrome.runtime.getManifest().version,d="id="+n(e)+"&type1="+n(o+" "+l)+"&type2="+n(i)+"&type3="+n(r)+"&type4="+n(a);fetch(t.URLgetInfo,{method:"POST",headers:{"content-Type":"application/x-www-form-urlencoded"},body:d}).then((e=>e.json())).then((e=>{c(e)})).catch((e=>{s(e)}))}))}async function i(e,n,o){try{if(await new Promise((e=>{try{chrome.storage.local.get(["analyticsDisabled"],(t=>{e(!!t.analyticsDisabled)}))}catch(t){e(!1)}})))return;const i=function(){try{return new URL(t.URLgetInfo||t.URLGetExtensionIdAsync).origin}catch(e){return"https://testapi.printnotion.com"}}(),r={event_name:e,event_id:([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),params:Object.assign({},o||{}),user:{user_pseudo_id:n},traffic:{source:"chrome_web_store",medium:"organic",campaign:"listing"},context:{page_location:"chrome-extension://background",platform:"extension",locale:chrome.i18n.getUILanguage()||"en",extension_version:chrome.runtime.getManifest().version},session:{session_id:Math.floor(Date.now()/1e3)}};await fetch(`${i}/analytics/collect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}catch(e){}}t=new e,new function(){this.log=function(e){},this.log=function(e,t){},this.log=function(e,t,n){}};var r=new function(){this.set=function(e,t){return new Promise(((n,o)=>{chrome.storage.sync.set({[e]:t},(function(o){n({[e]:t})}))}))},this.get=function(e){return new Promise(((t,n)=>{chrome.storage.sync.get({[e]:null},(function(e){t(e)}))}))},this.remove=function(e){return new Promise(((t,n)=>{chrome.storage.sync.remove(e,(function(n){t({[e]:null})}))}))},this.clear=function(){return new Promise(((e,t)=>{chrome.storage.sync.clear((function(t){e(1)}))}))},this.set=function(e,t,n){return new Promise(((o,i)=>{"LOCAL"===n?chrome.storage.local.set({[e]:t},(function(n){o({[e]:t})})):chrome.storage.sync.set({[e]:t},(function(n){o({[e]:t})}))}))},this.get=function(e,t){return new Promise(((n,o)=>{"LOCAL"===t?chrome.storage.local.get({[e]:null},(function(e){n(e)})):chrome.storage.sync.get({[e]:null},(function(e){n(e)}))}))},this.remove=function(e,t){return new Promise(((n,o)=>{"LOCAL"===t?chrome.storage.local.remove(e,(function(t){n({[e]:null})})):chrome.storage.sync.remove(e,(function(t){n({[e]:null})}))}))},this.clear=async function(e){return new Promise(((t,n)=>{"LOCAL"===e?chrome.storage.local.clear((function(e){t({})})):chrome.storage.sync.clear((function(e){t({})}))}))}},a=new function(){this.getExtensionId=async function(){var e=await r.get("extensionId");if(e.extensionId&&null!=e.extensionId)return e.extensionId;try{var n=await function(e){return new Promise(((n,o)=>{t.URLGetExtensionIdAsync,fetch(t.URLGetExtensionIdAsync,{method:"POST",headers:{"content-Type":"application/x-www-form-urlencoded"},body:"id="+e}).then((e=>e.json())).then((e=>{0===e.code?n(e.result.deviceId):n(null)})).catch((e=>{o(e)}))}))}("PRNO");return await r.set("extensionId",n),n}catch(e){return null}},this.getNewVersion=async function(){try{var e=await new Promise(((e,n)=>{fetch(t.URLgetNewVersion,{method:"GET",headers:{pragma:"no-cache","cache-control":"no-cache"}}).then((e=>e.text())).then((t=>{e(t)})).catch((t=>{var n=chrome.runtime.getManifest().version;e(n)}))}));return await r.set("newVersion",e),e}catch(e){return null}},this.getInstallMarket=function(){try{let e=chrome.runtime.getManifest(),t="unknown";if(e.update_url){let n=e.update_url;n.includes("edge.microsoft")?t="edge":n.includes("clients2.google")&&(t="google")}return t}catch(e){return"google"}},this.getRateUrl=function(){try{let e=this.getInstallMarket(),n=t.URLrateChrome;return"edge"==e?n=t.URLrateEdge:"google"==e&&(n=t.URLrateChrome),n}catch(e){return t.URLrateChrome}}};var c={};async function s(){var e=(await r.get("buyInfo")).buyInfo;return e&&e.result?e.result:null}function l(e){let t=[],n=e.recordMap.collection_view,o=Object.keys(n);for(let e in o){let i=n[o[e]],r=[];if(void 0!==i.value.format){let e=i.value.format.table_properties;void 0!==e&&(r=r.concat(e));let t=i.value.format.list_properties;void 0!==t&&(r=r.concat(t))}let a={id:i.value.id,name:i.value.hasOwnProperty("name")?i.value.name:i.value.type,type:i.value.type,properties:r,collectionViewData:i};t.push(a)}return t}function d(e){return window.btoa(unescape(encodeURIComponent(e)))}function u(e){return decodeURIComponent(escape(window.atob(e)))}function g(){let e=$("#selectCollection").val();return e=u(e),JSON.parse(e)}function h(){let e=$("#selectSpace").val();return e=u(e),JSON.parse(e)}async function p(){let e=$("#selectCollectionView").val();e=u(e);let t=JSON.parse(e),n=t.id,o=await async function(e){let t=g(),n=t.spaceId,o=t.collectionId;let i=await w("queryCollection",{spaceId:n,collectionId:o,collectionViewId:e}),r=await async function(e,t){let n=e.recordMap.collection;if(!n)return null;let o=Object.keys(n);for(let e in o){let i="",r=n[o[e]].value.parent_id;await w("getloadCachedPageChunk",{spaceId:i,pageId:r});let a=l(await w("getloadCachedPageChunk",{spaceId:i,pageId:r}));for(let e in a)if(a[e].id==t)return a[e];return{}}}(i,e);return r}(n);return null!=o&&(t=o),t}async function m(){let e=g(),t=e.spaceId,n=e.collectionId,o=e.collectionViewIds[0],i=await w("queryCollection",{spaceId:t,collectionId:n,collectionViewId:o});if(!i.recordMap.collection){let r=e.pageId,a=await w("getloadCachedPageChunk",{spaceId:t,pageId:r}),c={};if(a.recordMap.collection_view)for(let e in a.recordMap.collection_view){let t=a.recordMap.collection_view[e];if(t.value&&t.value.hasOwnProperty("format")&&t.value.format.hasOwnProperty("property_filters")){c=t;break}}i=await w("queryCollection",{spaceId:t,collectionId:n,collectionViewId:o,collectionViewData:c})}await async function(e){let t=e.recordMap.collection,n=Object.keys(t);$("#selectCollectionView").empty();for(let e in n){let o="",i=t[n[e]].value.parent_id,r=l(await w("getloadCachedPageChunk",{spaceId:o,pageId:i}));for(let e in r){JSON.stringify(r[e]);let t=document.createElement("option");t.value=d(JSON.stringify(r[e])),t.text=r[e].name,$("#selectCollectionView").append(t)}return r.length<=1?($("#rowCollectionView").hide(),await w("ChangeWindowHeight","HideCollectionView")):(await w("ChangeWindowHeight","ShowCollectionView"),$("#rowCollectionView").show()),r}}(i)}async function f(e,t,n,o){try{!function(e){let t=$(e),n=t.find(".spinner-border-sm:first"),o=t.find(".button-text:first");n.show(),o.hide(),t.prop("disabled",!0)}(e),t(),await n()}catch(e){}finally{o(),function(e){let t=$(e),n=t.find(".spinner-border-sm:first"),o=t.find(".button-text:first");n.hide(),o.show(),t.prop("disabled",!1)}(e)}}function w(e,t){return new Promise(((n,o)=>{chrome.tabs.query({url:"https://www.notion.so/*",active:!0,currentWindow:!0},(i=>{let r={message:e,data:t};null!=i&&i.length>0&&chrome.tabs.sendMessage(i[0].id,r,(e=>{chrome.runtime.lastError?(chrome.runtime.lastError.message,o(chrome.runtime.lastError.message)):n(e)}))}))}))}$((async function(){!function(){for(var e=document.getElementsByTagName("html"),t=0;t<e.length;t++){var n=e[t],o=n.innerHTML.toString(),i=o.replace(/__MSG_(\w+)__/g,(function(e,t){let n=chrome.i18n.getMessage(t);return t?""!=n?n:e:""}));i!=o&&(n.innerHTML=i)}}();chrome.runtime.id;a.getExtensionId().then((e=>{o(e,"PRNO","POP","","")}));var e=window.location.search,n="true"==new URLSearchParams(e).get("isSidePeek");function l(e,t,n=!1){return new Promise((o=>{var i=document.getElementById("customModal");i.querySelector(".modal-title").textContent=e,i.querySelector(".modal-body").textContent=t;var r=i.querySelector("#customModalConfirm"),a=i.querySelector("#customModalCancel"),c=i.querySelector("#customModalClose");n?(c.style.display="none",r.style.display="inline-block",a.style.display="inline-block",r.onclick=function(){s.hide(),o(!0)},a.onclick=function(){s.hide(),o(!1)}):(r.style.display="none",a.style.display="none",c.style.display="inline-block",c.onclick=function(){s.hide(),o(!1)});var s=new bootstrap.Modal(i);s.show()}))}(c=await s())?($(".ProFlag").hide(),$("#rowsRadiosGroup1").hide(),$("input[name='rowsRadios'][value='all']").prop("checked",!0)):($(".ProFlag").show(),$("#rowsRadiosGroup1").show()),$("#rangeBegin").prop("disabled",!0),$("#rangeEnd").prop("disabled",!0),$("#buttonRefreshSpace").click((function(e){f("#buttonRefreshSpace",(function(){$("#selectSpace").prop("disabled",!0),$("#buttonPrint").prop("disabled",!0),$("#buttonDataPreview").prop("disabled",!0),$("#buttonCheckParameters").prop("disabled",!0)}),(async function(){await async function(){let e=await w("getSpacesAsync",{});var t=Object.keys(e);for(var n in $("#selectSpace").empty(),t){t[n];let i=e[t[n]].spaceName,r=e[t[n]];var o="<option value ='"+d(JSON.stringify(r))+"'>"+i+"</option>";$("#selectSpace").append(o)}}()}),(function(){$("#selectSpace").prop("disabled",!1),$("#buttonPrint").prop("disabled",!1),$("#buttonDataPreview").prop("disabled",!1),$("#buttonCheckParameters").prop("disabled",!1),$("#selectSpace").trigger("change")}))})),$("#buttonRefreshCollectionView").click((function(e){f("#buttonRefreshCollectionView",(function(){$("#selectCollectionView").prop("disabled",!0),$("#buttonPrint").prop("disabled",!0),$("#buttonDataPreview").prop("disabled",!0),$("#buttonCheckParameters").prop("disabled",!0)}),(async function(){await m()}),(function(){$("#selectCollectionView").prop("disabled",!1),$("#buttonPrint").prop("disabled",!1),$("#buttonDataPreview").prop("disabled",!1),$("#buttonCheckParameters").prop("disabled",!1)}))})),$("#buttonMenu").click((async function(e){var t=$("#buttonMenu"),n=$("#menu"),o=t.offset(),i=(n.outerWidth(),$(window).width()),r=i-(o.left+t.outerWidth());n.css({top:o.top+t.outerHeight(),right:r,position:"fixed"}),n.toggle()})),$(document).click((function(e){var t=$("#menu"),n=$("#buttonMenu"),o=$("#buttonMenuIcon");$(e.target).is(t)||$(e.target).is(n)||$(e.target).is(o)||t.hide()})),$("#buttonRefreshCollection").click((async function(e){f("#buttonRefreshCollection",(function(){$("#selectCollection").prop("disabled",!0),$("#buttonPrint").prop("disabled",!0),$("#buttonDataPreview").prop("disabled",!0),$("#buttonCheckParameters").prop("disabled",!0)}),(async function(){let e=h();await async function(e){let t=e.id;var n={type:"BlocksInSpace",query:"",spaceId:t,limit:1e3,filters:{isDeletedOnly:!1,excludeTemplates:!1,isNavigableOnly:!1,includePublicPagesWithoutExplicitAccess:!1,navigableBlockContentOnly:!1,requireEditPermissions:!1,ancestors:[],createdBy:[],editedBy:[],lastEditedTime:{},createdTime:{},inTeams:[]},sort:{field:"relevance"},source:"quick_find_input_change",searchExperimentOverrides:{},searchSessionFlowNumber:1,recentPagesForBoosting:[]};let o=await w("getSearchAsync",n);$("#selectCollection").empty();var i=o.recordMap.collection;for(var r in i){let e=i[r],n=(e.value.id,e.value.name),a=e.value.parent_id,c=o.recordMap.block[a].value.view_ids,s=o.recordMap.block[a].value.collection_id,l="<option value ='"+d(JSON.stringify({spaceId:t,collectionId:s,collectionViewIds:c,pageId:a}))+"'>"+n+"</option>";$("#selectCollection").append(l)}}(e)}),(function(){$("#selectCollection").prop("disabled",!1),$("#buttonPrint").prop("disabled",!1),$("#buttonDataPreview").prop("disabled",!1),$("#buttonCheckParameters").prop("disabled",!1),$("#selectCollection").trigger("change")}))})),$("#buttonCheckParameters").click((async function(e){try{const e=await a.getExtensionId();await i("button_parameter_checking_click",e,{})}catch(e){}f("#buttonCheckParameters",(function(){}),(async function(){let e=g();await w("buttonCheckParameters",{spaceId:e.spaceId,collectionId:e.collectionId,collectionViewId:e.collectionViewIds[0]})}),(function(){}))})),$("#buttonDataPreview").click((async function(e){try{const e=await a.getExtensionId();await i("button_data_preview_click",e,{})}catch(e){}f("#buttonDataPreview",(function(){}),(async function(){c=await s();let e=g();var t=$('input[name="rowsRadios"]:checked').val();$('input[name="formatRadios"]:checked').val();let o=1,i=3;if("all"===t)o=-1,i=-1;else if("range"===t){var r=$("#rangeBegin").val(),a=$("#rangeEnd").val();if(r<1)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginMustBeGreaterThan0"),!1);if(!/^[1-9]\d*$/.test(r))return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginMustBePositiveInteger"),!1);if(!/^[1-9]\d*$/.test(a))return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeEndMustBePositiveInteger"),!1);if(a>1e5)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeEndExceeds100000"),!1);if(a<r)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginGreaterThanEnd"),!1);o=r,i=a}else o=1,i=3;let d=await p(),u=$("#checkBoxGetDataFromConnection").is(":checked");await w("buttonDataPreview",{spaceId:e.spaceId,collectionId:e.collectionId,collectionViewId:e.collectionViewIds[0],collectionViewInfo:d,rangeBegin:o,rangeEnd:i,isSidePeek:n,isGetDataFromConnection:u})}),(function(){}))})),$("#buttonPrint").click((async function(e){try{const e=await a.getExtensionId();await i("button_print_click",e,{})}catch(e){}f("#buttonPrint",(function(){}),(async function(){c=await s();let e=g();var i=$('input[name="rowsRadios"]:checked').val(),r=$('input[name="formatRadios"]:checked').val();let d="single"===r,u=1,h=3;if("all"===i){if(!c){return void(await l(chrome.i18n.getMessage("js_index_ConfirmTitle"),chrome.i18n.getMessage("js_index_ConfirmContent_ProVersion"),!0)&&a.getExtensionId().then((e=>{o(e,"PRNO","buttonPage","EnterPage",""),window.open(t.URLPayment+"?id="+e,"_blank")})))}u=-1,h=-1}else if("range"===i){if(!c){return void(await l(chrome.i18n.getMessage("js_index_ConfirmTitle"),chrome.i18n.getMessage("js_index_ConfirmContent_ProVersion"),!0)&&a.getExtensionId().then((e=>{o(e,"PRNO","buttonPage","EnterPage",""),window.open(t.URLPayment+"?id="+e,"_blank")})))}var m=$("#rangeBegin").val(),f=$("#rangeEnd").val();if(m<1)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginMustBeGreaterThan0"),!1);if(!/^[1-9]\d*$/.test(m))return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginMustBePositiveInteger"),!1);if(!/^[1-9]\d*$/.test(f))return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeEndMustBePositiveInteger"),!1);if(f>1e5)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeEndExceeds100000"),!1);if(f<m)return void l(chrome.i18n.getMessage("js_index_ErrorTitle"),chrome.i18n.getMessage("js_index_ErrorContent_RangeBeginGreaterThanEnd"),!1);if(f-m+1>1e3){if(!await l(chrome.i18n.getMessage("js_index_ConfirmTitle"),chrome.i18n.getMessage("js_index_ConfirmContent_PrintWarning"),!0))return}if(!d&&f-m+1>100){if(!await l(chrome.i18n.getMessage("js_index_ConfirmTitle"),chrome.i18n.getMessage("js_index_ConfirmContent_SeparateFiles"),!0))return}u=m,h=f}else u=1,h=3;let y=await p(),b=$("#checkBoxGetDataFromConnection").is(":checked");await w("printButton",{isSinglePage:d,spaceId:e.spaceId,collectionId:e.collectionId,collectionViewId:e.collectionViewIds[0],rangeBegin:u,rangeEnd:h,isSidePeek:n,collectionViewInfo:y,isGetDataFromConnection:b})}),(function(){}))})),$('input[name="rowsRadios"]').change((function(){var e=$('input[name="rowsRadios"]:checked').val();$("#rangeBegin").prop("disabled","range"!=e),$("#rangeEnd").prop("disabled","range"!=e)})),$("#buttonTest").click((async function(e){alert("ok")})),$("#buttonRefreshSpace").trigger("click"),$("#selectSpace").on("change",(function(){var e=$(this).val();void 0!==e&&$("#buttonRefreshCollection").trigger("click")})),$("#selectCollection").on("change",(function(){var e=$(this).val();void 0!==e&&$("#buttonRefreshCollectionView").trigger("click")})),$("#checkBoxGetDataFromConnection").on("change",(async function(){$("#checkBoxGetDataFromConnection").is(":checked")&&f("#buttonCheckParameters",(function(){}),(async function(){let e=h(),t=e.id,n=e.userId,o=await async function(e,t){let n=await r.get("notionTokens"),o=n?.notionTokens?n?.notionTokens:{},i=o?o[`${e}|${t}`]:{};return i?.access_token||null}(n,t);if(!o){await l(chrome.i18n.getMessage("js_index_AuthorizeReminder"),chrome.i18n.getMessage("js_index_AuthorizeReminderContent"),!1)}}),(function(){}))})),$("#buttonGetAuthorize").on("click",(function(){window.open(t.URLNotionConnection,"_blank")})),chrome.runtime.onMessage.addListener(((e,t,n)=>(e.message,"showDialogModal"===e.message&&l(e.data.title,e.data.content,e.data.isConfirm).then((e=>{n({code:0,msg:"success",result:e})})),e.message,e.data,!0)))}))}("undefined"==typeof w?w={}:w);